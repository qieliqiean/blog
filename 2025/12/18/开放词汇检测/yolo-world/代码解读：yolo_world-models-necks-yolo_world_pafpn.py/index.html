<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ä»£ç è§£è¯»ï¼šyolo_world-models-necks-yolo_world_pafpn.py | ä¸”ç¦»ä¸”å®‰çš„ç¢ç¢å¿µ</title><meta name="author" content="lian"><meta name="copyright" content="lian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#fdfcf8"><meta name="description" content="ç³»åˆ—æ–‡ç«    &#x2F;   å¼€æ”¾è¯æ±‡æ£€æµ‹ &#x2F; yolo-world  ğŸ”—class YOLOWorldPAFPN(YOLOv8PAFPN) ğŸ”—def init 1234567891011121314151617@MODELS.register_module()def __init__(self,             in_channels: List[int],             o">
<meta property="og:type" content="article">
<meta property="og:title" content="ä»£ç è§£è¯»ï¼šyolo_world-models-necks-yolo_world_pafpn.py">
<meta property="og:url" content="https://qieliqiean.github.io/blog/2025/12/18/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-necks-yolo_world_pafpn.py/index.html">
<meta property="og:site_name" content="ä¸”ç¦»ä¸”å®‰çš„ç¢ç¢å¿µ">
<meta property="og:description" content="ç³»åˆ—æ–‡ç«    &#x2F;   å¼€æ”¾è¯æ±‡æ£€æµ‹ &#x2F; yolo-world  ğŸ”—class YOLOWorldPAFPN(YOLOv8PAFPN) ğŸ”—def init 1234567891011121314151617@MODELS.register_module()def __init__(self,             in_channels: List[int],             o">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://qieliqiean.github.io/blog/image/A1-2.jpg">
<meta property="article:published_time" content="2025-12-18T02:04:06.000Z">
<meta property="article:modified_time" content="2026-02-18T11:58:50.441Z">
<meta property="article:author" content="lian">
<meta property="article:tag" content="Yolo-World">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qieliqiean.github.io/blog/image/A1-2.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ä»£ç è§£è¯»ï¼šyolo_world-models-necks-yolo_world_pafpn.py",
  "url": "https://qieliqiean.github.io/blog/2025/12/18/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-necks-yolo_world_pafpn.py/",
  "image": "https://qieliqiean.github.io/blog/image/A1-2.jpg",
  "datePublished": "2025-12-18T02:04:06.000Z",
  "dateModified": "2026-02-18T11:58:50.441Z",
  "author": [
    {
      "@type": "Person",
      "name": "lian",
      "url": "https://qieliqiean.github.io/blog/"
    }
  ]
}</script><link rel="shortcut icon" href="/blog/image/1.jpg"><link rel="canonical" href="https://qieliqiean.github.io/blog/2025/12/18/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-necks-yolo_world_pafpn.py/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="stylesheet" href="/blog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0f172a')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fdfcf8')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6b5d1303d19816191830cd73eccfdb1e";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
btf.addGlobalFn('pjaxComplete', () => {
  _hmt.push(['_trackPageview',window.location.pathname])
}, 'baidu_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/blog/',
  algolia: undefined,
  localSearch: {"path":"/blog/search.xml","preload":false,"top_n_per_article":3,"unescape":false,"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ä»£ç è§£è¯»ï¼šyolo_world-models-necks-yolo_world_pafpn.py',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=LXGW+WenKai:wght@400;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/blog/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/blog/image/IMG_20250131_155849.jpg" onerror="this.onerror=null;this.src='/blog/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/blog/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">43</div></a><a href="/blog/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">21</div></a><a href="/blog/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/blog/easter-egg/"><i class="fa-fw fas fa-egg"></i><span> å½©è›‹</span></a></div><div class="menus_item"><a class="site-page" href="/blog/about/"><i class="fa-fw fas fa-user"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/image/A1-2.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/blog/"><img class="site-icon" src="/blog/image/background1.png" alt="Logo"><span class="site-name">ä¸”ç¦»ä¸”å®‰çš„ç¢ç¢å¿µ</span></a><a class="nav-page-title" href="/blog/"><span class="site-name">ä»£ç è§£è¯»ï¼šyolo_world-models-necks-yolo_world_pafpn.py</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/blog/easter-egg/"><i class="fa-fw fas fa-egg"></i><span> å½©è›‹</span></a></div><div class="menus_item"><a class="site-page" href="/blog/about/"><i class="fa-fw fas fa-user"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ä»£ç è§£è¯»ï¼šyolo_world-models-necks-yolo_world_pafpn.py</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-12-18T02:04:06.000Z" title="å‘è¡¨äº 2025-12-18 10:04:06">2025-12-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2026-02-18T11:58:50.441Z" title="æ›´æ–°äº 2026-02-18 19:58:50">2026-02-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/blog/categories/%E5%AD%A6%E4%B9%A0/">å­¦ä¹ </a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">9.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>38åˆ†é’Ÿ</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><nav class="series-breadcrumb" aria-label="ç³»åˆ—å¯¼èˆª">
  <a href="/blog/series/">ç³»åˆ—æ–‡ç« </a>
  <span class="series-breadcrumb__sep">/</span>
  <a href="/blog/series/5byA5pS-6K-N5rGH5qOA5rWLIC8geW9sby13b3JsZA/">å¼€æ”¾è¯æ±‡æ£€æµ‹ / yolo-world</a>
</nav>
<h1 id="class-YOLOWorldPAFPN-YOLOv8PAFPN"><a class="header-anchor" href="#class-YOLOWorldPAFPN-YOLOv8PAFPN">ğŸ”—</a>class YOLOWorldPAFPN(YOLOv8PAFPN)</h1>
<h2 id="def-init"><a class="header-anchor" href="#def-init">ğŸ”—</a>def <strong>init</strong></h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MODELS.register_module()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,</span></span><br><span class="line"><span class="params">             in_channels: <span class="type">List</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             out_channels: <span class="type">Union</span>[<span class="type">List</span>[<span class="built_in">int</span>], <span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             guide_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">             embed_channels: <span class="type">List</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             num_heads: <span class="type">List</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             deepen_factor: <span class="built_in">float</span> = <span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">             widen_factor: <span class="built_in">float</span> = <span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">             num_csp_blocks: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">             freeze_all: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">             block_cfg: ConfigType = <span class="built_in">dict</span>(<span class="params"><span class="built_in">type</span>=<span class="string">&#x27;CSPLayerWithTwoConv&#x27;</span></span>),</span></span><br><span class="line"><span class="params">             norm_cfg: ConfigType = <span class="built_in">dict</span>(<span class="params"><span class="built_in">type</span>=<span class="string">&#x27;BN&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                                         momentum=<span class="number">0.03</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                                         eps=<span class="number">0.001</span></span>),</span></span><br><span class="line"><span class="params">             act_cfg: ConfigType = <span class="built_in">dict</span>(<span class="params"><span class="built_in">type</span>=<span class="string">&#x27;SiLU&#x27;</span>, inplace=<span class="literal">True</span></span>),</span></span><br><span class="line"><span class="params">             init_cfg: OptMultiConfig = <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MODELS.register_module()</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YOLOWorldPAFPN</span>(<span class="title class_ inherited__">YOLOv8PAFPN</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Path Aggregation Network used in YOLO World</span></span><br><span class="line"><span class="string">    Following YOLOv8 PAFPN, including text to image fusion</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>ç¬¬ 1 è¡Œ</strong>ï¼š<code>@MODELS.register_module()</code> æ˜¯ MMEngine çš„è£…é¥°å™¨ï¼Œå°†è¿™ä¸ªç±»æ³¨å†Œåˆ° <code>MODELS</code> æ³¨å†Œè¡¨ä¸­ï¼Œæ–¹ä¾¿é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œå®ä¾‹åŒ–ã€‚</p>
</li>
<li>
<p><strong>ç¬¬ 2 è¡Œ</strong>ï¼š<code>YOLOWorldPAFPN</code> ç»§æ‰¿è‡ª <code>YOLOv8PAFPN</code>ã€‚è¿™æ„å‘³ç€å®ƒä¿ç•™äº† YOLOv8 ç»å…¸çš„åŒå‘ç‰¹å¾èåˆç»“æ„ï¼ˆTop-down + Bottom-upï¼‰ï¼Œä½†åœ¨å…¶åŸºç¡€ä¸Šå¢åŠ äº†â€œæ–‡æœ¬åˆ°å›¾åƒèåˆâ€çš„åŠŸèƒ½ã€‚</p>
</li>
</ul>
<p><img src="/blog/2025/12/18/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-necks-yolo_world_pafpn.py/yw1.png" alt=""></p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,</span></span><br><span class="line"><span class="params">             in_channels: <span class="type">List</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             out_channels: <span class="type">Union</span>[<span class="type">List</span>[<span class="built_in">int</span>], <span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             guide_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">             embed_channels: <span class="type">List</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             num_heads: <span class="type">List</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             deepen_factor: <span class="built_in">float</span> = <span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">             widen_factor: <span class="built_in">float</span> = <span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">             num_csp_blocks: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">             freeze_all: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">             block_cfg: ConfigType = <span class="built_in">dict</span>(<span class="params"><span class="built_in">type</span>=<span class="string">&#x27;CSPLayerWithTwoConv&#x27;</span></span>),</span></span><br><span class="line"><span class="params">             norm_cfg: ConfigType = <span class="built_in">dict</span>(<span class="params"><span class="built_in">type</span>=<span class="string">&#x27;BN&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                                         momentum=<span class="number">0.03</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                                         eps=<span class="number">0.001</span></span>),</span></span><br><span class="line"><span class="params">             act_cfg: ConfigType = <span class="built_in">dict</span>(<span class="params"><span class="built_in">type</span>=<span class="string">&#x27;SiLU&#x27;</span>, inplace=<span class="literal">True</span></span>),</span></span><br><span class="line"><span class="params">             init_cfg: OptMultiConfig = <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æ˜¯å‚æ•°åˆ—è¡¨ï¼Œæ³¨æ„çœ‹æ–°å‡ºç°çš„â€œé¢å­”â€ï¼š</p>
<ul>
<li>
<p><strong><code>in_channels: List[int]</code></strong></p>
<p>è¡¨ç¤ºæ¥è‡ª backbone çš„å¤šå°ºåº¦ç‰¹å¾é€šé“æ•°åˆ—è¡¨ï¼Œæ¯”å¦‚ <code>[256, 512, 1024]</code>ï¼ˆæœ‰å‡ å±‚ FPN/PAFPN å°±ç»™å‡ é¡¹ï¼‰ã€‚</p>
</li>
<li>
<p><strong><code>out_channels: Union[List[int], int]</code></strong></p>
<p>PAFPN æœ€ç»ˆè¾“å‡ºæ¯ä¸ªå°ºåº¦çš„é€šé“æ•°ã€‚æ—¢æ”¯æŒä¼ ä¸€ä¸ª <code>int</code>ï¼ˆé€šå¸¸è¡¨ç¤ºæ¯å±‚è¾“å‡ºåŒä¸€é€šé“æ•°ï¼‰ï¼Œä¹Ÿæ”¯æŒä¼ ä¸€ä¸ªåˆ—è¡¨ï¼ˆæ¯å±‚ä¸åŒï¼‰ã€‚</p>
</li>
<li>
<p><strong><code>guide_channels</code> (å…³é”®)</strong>ï¼š<strong>å¼•å¯¼ç‰¹å¾ï¼ˆguideï¼‰</strong> çš„é€šé“æ•°ã€‚YOLO-World é‡Œé€šå¸¸å°±æ˜¯æ–‡æœ¬ç‰¹å¾ <code>txt_feats</code> çš„ç»´åº¦ï¼ˆæˆ–ç»è¿‡æŸå±‚æŠ•å½±åçš„ç»´åº¦ï¼‰ã€‚è¿™ä¸ªå‚æ•°æ˜¯â€œå›¾æ–‡èåˆâ€ä¼šç”¨åˆ°çš„å…³é”®è¾“å…¥ç»´åº¦ã€‚</p>
</li>
<li>
<p><code>embed_channels: List[int]</code></p>
<p>åœ¨èåˆæ¨¡å—é‡Œä¼šæŠŠå›¾åƒç‰¹å¾æŠ•å½±åˆ°ä¸€ä¸ªç”¨äºæ³¨æ„åŠ›/ç›¸ä¼¼åº¦è®¡ç®—çš„embedding ç»´åº¦ã€‚è¿™é‡Œæ˜¯æŒ‰å±‚ç»™ä¸€ä¸ªåˆ—è¡¨ï¼ˆæ¯ä¸ªå°ºåº¦ä¸€ä¸ªï¼‰ã€‚</p>
</li>
<li>
<p><strong><code>num_heads</code></strong>ï¼šå¦‚æœäº¤äº’å±‚ä½¿ç”¨äº†æ³¨æ„åŠ›æœºåˆ¶ï¼Œè¿™é‡ŒæŒ‡å®šäº†å¤šå¤´æ³¨æ„åŠ›çš„å¤´æ•°ã€‚</p>
</li>
<li>
<p><code>deepen_factor / widen_factor</code></p>
<p>YOLO ç³»åˆ—å¸¸ç”¨çš„â€œæ·±åº¦/å®½åº¦ç¼©æ”¾ç³»æ•°â€ï¼š</p>
<ul>
<li>
<p><code>widen_factor</code> ä¼šå½±å“é€šé“æ•°ï¼ˆå¦‚ <code>make_divisible</code> åçš„é€šé“ï¼‰</p>
</li>
<li>
<p><code>deepen_factor</code> ä¼šå½±å“ block çš„é‡å¤æ¬¡æ•°ï¼ˆå¦‚ <code>make_round</code> åçš„ <code>num_blocks</code>ï¼‰</p>
</li>
</ul>
</li>
<li>
<p><code>num_csp_blocks</code></p>
<p>CSP/CSPLayer ç±» block å†…éƒ¨å †å çš„åŸºæœ¬å—æ•°é‡ï¼ˆéšåä¼šè¢« <code>deepen_factor</code> ç¼©æ”¾ï¼‰ã€‚</p>
</li>
<li>
<p><code>freeze_all</code></p>
<p>äº¤ç»™çˆ¶ç±»ï¼ˆYOLOv8PAFPNï¼‰å»åšâ€œå†»ç»“æ‰€æœ‰å‚æ•°/BNâ€ç­‰é€»è¾‘ï¼ˆå…·ä½“å†»ç»“ç»†èŠ‚åœ¨çˆ¶ç±»é‡Œå®ç°ï¼‰ã€‚</p>
</li>
<li>
<p><code>block_cfg / norm_cfg / act_cfg / init_cfg</code></p>
<p>å…¸å‹ MMEngine/MMYOLO çš„æ¨¡å—é…ç½®ï¼š</p>
<ul>
<li>
<p><code>block_cfg</code>ï¼štop-down / bottom-up ç”¨çš„å—ç±»å‹ï¼ˆé»˜è®¤ <code>CSPLayerWithTwoConv</code>ï¼‰</p>
</li>
<li>
<p><code>norm_cfg</code>ï¼šBN çš„é…ç½®ï¼ˆmomentum/epsï¼‰</p>
</li>
<li>
<p><code>act_cfg</code>ï¼šæ¿€æ´»å‡½æ•°é…ç½®ï¼ˆSiLUï¼‰</p>
</li>
<li>
<p><code>init_cfg</code>ï¼šåˆå§‹åŒ–ç­–ç•¥ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰</p>
</li>
</ul>
</li>
</ul>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">self</span>.guide_channels = guide_channels</span><br><span class="line"><span class="variable language_">self</span>.embed_channels = embed_channels</span><br><span class="line"><span class="variable language_">self</span>.num_heads = num_heads</span><br><span class="line"><span class="variable language_">self</span>.block_cfg = block_cfg</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>è¿™å››è¡Œ</strong>ï¼šå°† YOLO-World ç‰¹æœ‰çš„è·¨æ¨¡æ€å‚æ•°ä¿å­˜ä¸ºç±»å®ä¾‹å˜é‡ã€‚è¿™éå¸¸é‡è¦ï¼Œå› ä¸ºåç»­åœ¨ <code>build_top_down_layer</code>ï¼ˆæ„å»ºè‡ªé¡¶å‘ä¸‹å±‚ï¼‰å’Œ <code>build_bottom_up_layer</code>ï¼ˆæ„å»ºè‡ªåº•å‘ä¸Šå±‚ï¼‰ä¸­ï¼Œè¿™äº›å‚æ•°ä¼šè¢«ç”¨æ¥åŠ¨æ€åˆ›å»ºæ”¯æŒæ–‡æœ¬äº¤äº’çš„å·ç§¯å—ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">self.guide_channelsï¼šå‘Šè¯‰èåˆå±‚â€œå¤–éƒ¨ guideï¼ˆæ–‡æœ¬ï¼‰ç‰¹å¾æ˜¯å¤šå°‘ç»´â€</span><br><span class="line">self.embed_channelsï¼šæ¯ä¸ªå°ºåº¦èåˆæ—¶çš„ embedding ç»´åº¦</span><br><span class="line">self.num_headsï¼šæ¯ä¸ªå°ºåº¦èåˆæ—¶çš„ head æ•°</span><br><span class="line">self.block_cfgï¼šåé¢ build_top_down_layer() / build_bottom_up_layer() ä¼š copy.deepcopy è¿™ä¸ªé…ç½®å¹¶è¡¥é½å‚æ•°ï¼Œç„¶å MODELS.build(...) æ„å»ºå…·ä½“æ¨¡å—</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">super</span>().__init__(in_channels=in_channels,</span><br><span class="line">                 out_channels=out_channels,</span><br><span class="line">                 deepen_factor=deepen_factor,</span><br><span class="line">                 widen_factor=widen_factor,</span><br><span class="line">                 num_csp_blocks=num_csp_blocks,</span><br><span class="line">                 freeze_all=freeze_all,</span><br><span class="line">                 norm_cfg=norm_cfg,</span><br><span class="line">                 act_cfg=act_cfg,</span><br><span class="line">                 init_cfg=init_cfg)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>è¿™å¥éå¸¸å…³é”®ï¼š<strong>YOLOWorldPAFPN ç»§æ‰¿è‡ª YOLOv8PAFPN</strong>ï¼Œå¤§éƒ¨åˆ† PAFPN çš„éª¨æ¶ç»“æ„ï¼ˆreduce_layersã€upsample_layersã€downsample_layersã€out_layers ç­‰ï¼‰éƒ½æ˜¯åœ¨çˆ¶ç±»é‡Œç»Ÿä¸€æ­å¥½çš„ã€‚</p>
<p>è¿™é‡Œä¼ è¿›å»çš„å‚æ•°ä¸»è¦ä½œç”¨ï¼š</p>
<ul>
<li>
<p>æŠŠé€šé“ã€æ·±å®½ç¼©æ”¾ã€CSP block æ•°ã€freezeã€norm/act/init ç­‰â€œé€šç”¨ FPN/PAFPN æ„å»ºå‚æ•°â€äº¤ç»™çˆ¶ç±»å¤„ç†</p>
</li>
<li>
<p>è€Œ YOLOWorldPAFPN çš„â€œå·®å¼‚ç‚¹â€åœ¨äºï¼šçˆ¶ç±»åœ¨æ„å»º top-down/bottom-up çš„å…·ä½“ block æ—¶ï¼Œä¼šè°ƒç”¨å­ç±»è¦†å†™çš„ <code>build_top_down_layer()</code> å’Œ <code>build_bottom_up_layer()</code>ï¼Œè¿™æ ·å°±èƒ½æŠŠ <strong>txt_feats å¼•å…¥èåˆ block</strong>ï¼ˆä½ åœ¨åé¢çš„ <code>forward()</code> ä¹Ÿèƒ½çœ‹åˆ° top_down_layers/bottom_up_layers çš„è°ƒç”¨å¤šäº† <code>txt_feats</code> å‚æ•°ï¼‰ã€‚</p>
</li>
</ul>
</li>
</ul>
<h2 id="def-build-top-down-layer"><a class="header-anchor" href="#def-build-top-down-layer">ğŸ”—</a>def build_top_down_layer</h2>
<p>å®ƒè´Ÿè´£<strong>æ„å»º PAFPN çš„ top-down èåˆå—</strong>ï¼šæŠŠä¸Šé‡‡æ ·åçš„é«˜å±‚ç‰¹å¾å’Œå½“å‰å±‚ç‰¹å¾ concat åï¼Œå†è¿‡ä¸€ä¸ª CSP/èåˆæ¨¡å—ï¼›YOLO-World ç‰ˆæœ¬è¿˜ä¼šæŠŠ <code>txt_feats</code> çš„ç»´åº¦é…ç½®å¡è¿›å»ã€‚</p>
<hr>
<h3 id="ä»£ç åŸæ–‡"><a class="header-anchor" href="#ä»£ç åŸæ–‡">ğŸ”—</a>ä»£ç åŸæ–‡</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">build_top_down_layer</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; nn.Module:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;build top down layer.</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        idx (int): layer idx.</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        nn.Module: The top down layer.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    block_cfg = copy.deepcopy(<span class="variable language_">self</span>.block_cfg)</span><br><span class="line">    block_cfg.update(</span><br><span class="line">        <span class="built_in">dict</span>(in_channels=make_divisible(</span><br><span class="line">            (<span class="variable language_">self</span>.in_channels[idx - <span class="number">1</span>] + <span class="variable language_">self</span>.in_channels[idx]),</span><br><span class="line">            <span class="variable language_">self</span>.widen_factor),</span><br><span class="line">             out_channels=make_divisible(<span class="variable language_">self</span>.out_channels[idx - <span class="number">1</span>],</span><br><span class="line">                                         <span class="variable language_">self</span>.widen_factor),</span><br><span class="line">             guide_channels=<span class="variable language_">self</span>.guide_channels,</span><br><span class="line">             embed_channels=make_round(<span class="variable language_">self</span>.embed_channels[idx - <span class="number">1</span>],</span><br><span class="line">                                       <span class="variable language_">self</span>.widen_factor),</span><br><span class="line">             num_heads=make_round(<span class="variable language_">self</span>.num_heads[idx - <span class="number">1</span>],</span><br><span class="line">                                  <span class="variable language_">self</span>.widen_factor),</span><br><span class="line">             num_blocks=make_round(<span class="variable language_">self</span>.num_csp_blocks,</span><br><span class="line">                                   <span class="variable language_">self</span>.deepen_factor),</span><br><span class="line">             add_identity=<span class="literal">False</span>,</span><br><span class="line">             norm_cfg=<span class="variable language_">self</span>.norm_cfg,</span><br><span class="line">             act_cfg=<span class="variable language_">self</span>.act_cfg))</span><br><span class="line">    <span class="keyword">return</span> MODELS.build(block_cfg)</span><br></pre></td></tr></table></figure>
<h3 id="1-å‡½æ•°å¤´"><a class="header-anchor" href="#1-å‡½æ•°å¤´">ğŸ”—</a>1) å‡½æ•°å¤´</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">build_top_down_layer</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; nn.Module:</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>idx</code> æ˜¯â€œå½“å‰è¦æ„å»ºå“ªä¸€å±‚ top-down æ¨¡å—â€çš„ç´¢å¼•ï¼ˆé€šå¸¸å¯¹åº” FPN çš„æŸä¸ªå°ºåº¦ä½ç½®ï¼‰ã€‚</p>
</li>
<li>
<p>top-down çš„å…¸å‹æ•°æ®æµï¼šæ›´é«˜å±‚ç‰¹å¾ï¼ˆè¯­ä¹‰å¼ºã€åˆ†è¾¨ç‡ä½ï¼‰<strong>ä¸Šé‡‡æ ·</strong> â†’ ä¸ <code>idx-1</code> è¿™ä¸€å±‚ç‰¹å¾ <strong>concat</strong> â†’ è¿‡ä¸€ä¸ªèåˆ blockã€‚</p>
</li>
<li>
<p>è¿”å›å€¼æ˜¯ä¸€ä¸ª <code>nn.Module</code>ï¼šå°±æ˜¯è¿™ä¸€å±‚è¦ç”¨çš„èåˆæ¨¡å—ï¼ˆåœ¨ YOLO-World é‡Œé€šå¸¸æ˜¯å¸¦â€œæ–‡æœ¬å¼•å¯¼/æ³¨æ„åŠ›â€çš„ CSP å˜ä½“ï¼‰ã€‚</p>
</li>
</ul>
<hr>
<h3 id="2-æ·±æ‹·è´-block-é…ç½®ï¼Œé¿å…æ±¡æŸ“å…¨å±€é…ç½®"><a class="header-anchor" href="#2-æ·±æ‹·è´-block-é…ç½®ï¼Œé¿å…æ±¡æŸ“å…¨å±€é…ç½®">ğŸ”—</a>2) æ·±æ‹·è´ block é…ç½®ï¼Œé¿å…æ±¡æŸ“å…¨å±€é…ç½®</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">block_cfg = copy.deepcopy(<span class="variable language_">self</span>.block_cfg)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>self.block_cfg</code> åœ¨ <code>__init__</code> é‡Œé»˜è®¤æ˜¯ <code>dict(type='CSPLayerWithTwoConv')</code>ï¼ˆæˆ–ä½ é…ç½®çš„åˆ«çš„ block ç±»å‹ï¼‰ã€‚</p>
</li>
<li>
<p><code>deepcopy</code> çš„æ„ä¹‰ï¼š<strong>æ¯ä¸€å±‚éƒ½ä¼šåŸºäºåŒä¸€ä¸ªæ¨¡æ¿æ”¹å‚æ•°</strong>ï¼Œä½†ä¸èƒ½äº’ç›¸å½±å“ï¼›æ·±æ‹·è´èƒ½é¿å…æŸå±‚ <code>update()</code> åæŠŠåˆ«å±‚ä¹Ÿæ”¹äº†ã€‚</p>
</li>
</ul>
<hr>
<h3 id="3-ç”¨-update-æŠŠâ€œè¿™ä¸€å±‚â€éœ€è¦çš„å…³é”®è¶…å‚æ•°è¡¥é½"><a class="header-anchor" href="#3-ç”¨-update-æŠŠâ€œè¿™ä¸€å±‚â€éœ€è¦çš„å…³é”®è¶…å‚æ•°è¡¥é½">ğŸ”—</a>3) ç”¨ update() æŠŠâ€œè¿™ä¸€å±‚â€éœ€è¦çš„å…³é”®è¶…å‚æ•°è¡¥é½</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">block_cfg.update(<span class="built_in">dict</span>(...))</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯æ ¸å¿ƒï¼šæŠŠ block çš„è¾“å…¥è¾“å‡ºé€šé“ã€æ–‡æœ¬å¼•å¯¼ç»´åº¦ã€embedding/head æ•°ã€block æ•°ã€norm/act ç­‰ä¸€æ¬¡æ€§å†™å…¥é…ç½®ã€‚</p>
<hr>
<h4 id="3-1-è®¡ç®—-in-channelsï¼šæ¥è‡ª-concat-çš„é€šé“æ•°"><a class="header-anchor" href="#3-1-è®¡ç®—-in-channelsï¼šæ¥è‡ª-concat-çš„é€šé“æ•°">ğŸ”—</a>3.1 è®¡ç®— in_channelsï¼šæ¥è‡ª concat çš„é€šé“æ•°</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">in_channels=make_divisible(</span><br><span class="line">    (<span class="variable language_">self</span>.in_channels[idx - <span class="number">1</span>] + <span class="variable language_">self</span>.in_channels[idx]),</span><br><span class="line">    <span class="variable language_">self</span>.widen_factor),</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>top-down èåˆå‰é€šå¸¸ä¼šåš concatï¼š</p>
<p><strong>(æ¥è‡ª idx çš„ä¸Šé‡‡æ ·ç‰¹å¾) + (æ¥è‡ª idx-1 çš„æ¨ªå‘ç‰¹å¾)</strong></p>
<p>æ‰€ä»¥è¾“å…¥é€šé“æ•°æ˜¯ä¸¤è€…é€šé“ç›¸åŠ ï¼š<code>self.in_channels[idx-1] + self.in_channels[idx]</code></p>
</li>
<li>
<p><code>make_divisible(..., self.widen_factor)</code>ï¼š</p>
<p>å…ˆæŒ‰ <code>widen_factor</code> åšå®½åº¦ç¼©æ”¾ï¼Œå¹¶æŠŠé€šé“æ•°è°ƒæ•´åˆ°æŸä¸ªâ€œå¯æ•´é™¤/ç¡¬ä»¶å‹å¥½â€çš„æ•°ï¼ˆå¸¸è§æ˜¯ 8 çš„å€æ•°ä¹‹ç±»ï¼‰ï¼Œä¿è¯æ¨¡å‹ç»“æ„è§„æ•´ã€æ¨ç†æ›´å‹å¥½ã€‚</p>
</li>
</ul>
<blockquote>
<p>ä¾‹å¦‚</p>
</blockquote>
<blockquote></blockquote>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.in_channels = [<span class="number">256</span>, <span class="number">512</span>, <span class="number">1024</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å½“ idx = 2 æ—¶ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.in_channels[idx - <span class="number">1</span>] = <span class="variable language_">self</span>.in_channels[<span class="number">1</span>] = <span class="number">512</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.in_channels[idx] = <span class="variable language_">self</span>.in_channels[<span class="number">2</span>] = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.in_channels[idx - <span class="number">1</span>] + <span class="variable language_">self</span>.in_channels[idx] = <span class="number">1536</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote></blockquote>
<blockquote>
<p><code>make_divisible(..., self.widen_factor)</code></p>
</blockquote>
<blockquote></blockquote>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">widen_factor = <span class="number">1.0</span>   <span class="comment"># é»˜è®¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ§åˆ¶æ¨¡å‹å®½åº¦ç¼©æ”¾,YOLO ç³»åˆ—ç»å…¸è¶…å‚ï¼ˆn / s / m / l / xï¼‰</span></span><br><span class="line"></span><br><span class="line">make_divisible(x, factor)</span><br><span class="line"></span><br><span class="line">â‰ˆ <span class="built_in">round</span>(x * factor) å¹¶å¯¹é½åˆ° <span class="number">8</span> æˆ– <span class="number">16</span> çš„å€æ•°</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote></blockquote>
<blockquote>
<p>ç›®çš„æœ‰ä¸‰ï¼š</p>
</blockquote>
<blockquote></blockquote>
<blockquote>
<ol>
<li><strong>æŒ‰æ¨¡å‹è§„æ¨¡ç¼©æ”¾é€šé“æ•°</strong></li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li><strong>é¿å…å¥‡æ€ªçš„é€šé“æ•°</strong></li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li><strong>å¯¹ GPU / NPU æ›´å‹å¥½ï¼ˆSIMD å¯¹é½ï¼‰</strong></li>
</ol>
</blockquote>
<blockquote></blockquote>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.in_channels = [<span class="number">256</span>, <span class="number">512</span>, <span class="number">1024</span>]</span><br><span class="line"></span><br><span class="line">idx = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">widen_factor = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">in_channels=make_divisible(</span><br><span class="line"></span><br><span class="line">    (<span class="variable language_">self</span>.in_channels[idx - <span class="number">1</span>] + <span class="variable language_">self</span>.in_channels[idx]),</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.widen_factor)</span><br><span class="line"></span><br><span class="line"><span class="comment">#in_channels : (512 + 1024)x0.5=768 â†’ 768ï¼ˆå·²æ˜¯ 16 çš„å€æ•°ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#in_channels = 768</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote></blockquote>
<blockquote></blockquote>
<hr>
<h4 id="3-2-è®¡ç®—-out-channelsï¼šè¾“å‡ºåˆ°-idx-1-å°ºåº¦çš„é€šé“"><a class="header-anchor" href="#3-2-è®¡ç®—-out-channelsï¼šè¾“å‡ºåˆ°-idx-1-å°ºåº¦çš„é€šé“">ğŸ”—</a>3.2 è®¡ç®— out_channelsï¼šè¾“å‡ºåˆ° idx-1 å°ºåº¦çš„é€šé“</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">out_channels=make_divisible(<span class="variable language_">self</span>.out_channels[idx - <span class="number">1</span>], <span class="variable language_">self</span>.widen_factor),</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>top-down èåˆå®Œçš„ç»“æœï¼Œæ˜¯ç»™æ›´é«˜åˆ†è¾¨ç‡é‚£ä¸€å±‚ï¼ˆ<code>idx-1</code>ï¼‰ç”¨çš„ï¼Œæ‰€ä»¥è¾“å‡ºé€šé“å¯¹é½ <code>self.out_channels[idx-1]</code>ã€‚</p>
</li>
<li>
<p>åŒæ ·ç»è¿‡ <code>widen_factor + make_divisible</code> å¤„ç†ã€‚</p>
</li>
</ul>
<hr>
<h4 id="3-3-YOLO-World-ç‰¹æœ‰ï¼šguide-channelsï¼ˆæ–‡æœ¬-å¼•å¯¼ç‰¹å¾ç»´åº¦ï¼‰"><a class="header-anchor" href="#3-3-YOLO-World-ç‰¹æœ‰ï¼šguide-channelsï¼ˆæ–‡æœ¬-å¼•å¯¼ç‰¹å¾ç»´åº¦ï¼‰">ğŸ”—</a>3.3 YOLO-World ç‰¹æœ‰ï¼šguide_channelsï¼ˆæ–‡æœ¬/å¼•å¯¼ç‰¹å¾ç»´åº¦ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">guide_channels=<span class="variable language_">self</span>.guide_channels,</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>è¿™å°±æ˜¯ YOLO-World ç›¸æ¯”æ™®é€š YOLOv8 PAFPN çš„å…³é”®æ‰©å±•ï¼š</p>
<p><strong>èåˆå—å†…éƒ¨ä¼šæ¥æ”¶ <code>txt_feats</code></strong>ï¼ˆæˆ–æŸç§ guide ç‰¹å¾ï¼‰ï¼Œè¿™é‡ŒæŠŠå®ƒçš„é€šé“ç»´åº¦å‘Šè¯‰æ¨¡å—ï¼Œç”¨äºæ„å»ºæŠ•å½±å±‚/æ³¨æ„åŠ›å±‚ã€‚</p>
</li>
</ul>
<hr>
<h4 id="3-4-embedding-ç»´åº¦ï¼šæ¯ä¸ªå°ºåº¦ä¸€ä¸ª"><a class="header-anchor" href="#3-4-embedding-ç»´åº¦ï¼šæ¯ä¸ªå°ºåº¦ä¸€ä¸ª">ğŸ”—</a>3.4 embedding ç»´åº¦ï¼šæ¯ä¸ªå°ºåº¦ä¸€ä¸ª</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">embed_channels=make_round(<span class="variable language_">self</span>.embed_channels[idx - <span class="number">1</span>], <span class="variable language_">self</span>.widen_factor),</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>è¡¨ç¤ºåœ¨è¯¥å°ºåº¦èåˆæ—¶ä½¿ç”¨çš„ embedding ç»´åº¦ï¼ˆæ¯”å¦‚åšå¤šå¤´æ³¨æ„åŠ›å‰çš„æŠ•å½±ç»´åº¦ï¼‰ã€‚</p>
</li>
<li>
<p><code>make_round(..., widen_factor)</code>ï¼šæŒ‰å®½åº¦ç³»æ•°ç¼©æ”¾åå–æ•´ï¼ˆå’Œ <code>make_divisible</code> ç±»ä¼¼ï¼Œä½†è¯­ä¹‰åâ€œç¼©æ”¾åå–æ•´â€ï¼Œä¸å¼ºè°ƒæ•´é™¤çº¦æŸï¼‰ã€‚</p>
</li>
</ul>
<hr>
<h4 id="3-5-å¤šå¤´æ•°ï¼šæ¯ä¸ªå°ºåº¦ä¸€ä¸ª"><a class="header-anchor" href="#3-5-å¤šå¤´æ•°ï¼šæ¯ä¸ªå°ºåº¦ä¸€ä¸ª">ğŸ”—</a>3.5 å¤šå¤´æ•°ï¼šæ¯ä¸ªå°ºåº¦ä¸€ä¸ª</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num_heads=make_round(<span class="variable language_">self</span>.num_heads[idx - <span class="number">1</span>], <span class="variable language_">self</span>.widen_factor),</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>è¡¨ç¤ºè¯¥å°ºåº¦èåˆæ¨¡å—é‡Œå¤šå¤´ç»“æ„çš„ head æ•°ï¼ˆæ³¨æ„è¿™é‡Œä¹ŸæŒ‰ widen_factor ç¼©æ”¾å–æ•´ï¼‰ã€‚</p>
</li>
<li>
<p>è¿™æ„å‘³ç€ï¼šå½“ä½ ç”¨æ›´å¤§æ¨¡å‹ï¼ˆæ›´å®½ï¼‰æ—¶ï¼Œå¯èƒ½ head æ•°ä¹Ÿéšä¹‹å¢å¤§ã€‚</p>
</li>
</ul>
<hr>
<h4 id="3-6-CSP-å†…éƒ¨å †å æ¬¡æ•°ï¼šå—-deepen-factor-å½±å“"><a class="header-anchor" href="#3-6-CSP-å†…éƒ¨å †å æ¬¡æ•°ï¼šå—-deepen-factor-å½±å“">ğŸ”—</a>3.6 CSP å†…éƒ¨å †å æ¬¡æ•°ï¼šå— deepen_factor å½±å“</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num_blocks=make_round(<span class="variable language_">self</span>.num_csp_blocks, <span class="variable language_">self</span>.deepen_factor),</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>self.num_csp_blocks</code> æ˜¯åŸºç¡€å€¼ï¼ˆé»˜è®¤ 3ï¼‰ã€‚</p>
</li>
<li>
<p><code>deepen_factor</code> æ§åˆ¶â€œæ·±åº¦ç¼©æ”¾â€ï¼šè¶Šå¤§ä»£è¡¨ block å†…é‡å¤æ¬¡æ•°è¶Šå¤šï¼ˆæ›´æ·±ï¼‰ã€‚</p>
</li>
</ul>
<hr>
<h4 id="3-7-add-identity-Falseï¼šå…³é—­æ®‹å·®æ·å¾„"><a class="header-anchor" href="#3-7-add-identity-Falseï¼šå…³é—­æ®‹å·®æ·å¾„">ğŸ”—</a>3.7 add_identity=Falseï¼šå…³é—­æ®‹å·®æ·å¾„</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_identity=<span class="literal">False</span>,</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>è¿™é€šå¸¸æ˜¯å¯¹ CSP/æ®‹å·®ç»“æ„çš„ä¸€ä¸ªå¼€å…³ã€‚</p>
</li>
<li>
<p>è¿™é‡Œæ˜¾å¼å…³æ‰ï¼Œä»£è¡¨è¯¥ block ä¸ä½¿ç”¨ identity shortcutï¼ˆå…·ä½“å½±å“å–å†³äº block ç±»å‹çš„å®ç°ï¼‰ã€‚</p>
</li>
</ul>
<hr>
<h4 id="3-8-norm-actï¼šæŠŠè§„èŒƒåŒ–å’Œæ¿€æ´»é…ç½®ä¼ è¿›å»"><a class="header-anchor" href="#3-8-norm-actï¼šæŠŠè§„èŒƒåŒ–å’Œæ¿€æ´»é…ç½®ä¼ è¿›å»">ğŸ”—</a>3.8 norm/actï¼šæŠŠè§„èŒƒåŒ–å’Œæ¿€æ´»é…ç½®ä¼ è¿›å»</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">norm_cfg=<span class="variable language_">self</span>.norm_cfg,</span><br><span class="line">act_cfg=<span class="variable language_">self</span>.act_cfg</span><br></pre></td></tr></table></figure>
<ul>
<li>è®© block ä½¿ç”¨å’Œæ•´ä¸ªç½‘ç»œä¸€è‡´çš„ BN/æ¿€æ´»é…ç½®ï¼ˆ<code>BN(momentum=0.03, eps=0.001)</code> + <code>SiLU</code>ï¼‰ã€‚</li>
</ul>
<hr>
<h3 id="4-ç”±æ³¨å†Œè¡¨æ„å»ºæ¨¡å—å®ä¾‹"><a class="header-anchor" href="#4-ç”±æ³¨å†Œè¡¨æ„å»ºæ¨¡å—å®ä¾‹">ğŸ”—</a>4) ç”±æ³¨å†Œè¡¨æ„å»ºæ¨¡å—å®ä¾‹</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> MODELS.build(block_cfg)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>MMEngine/MMYOLO çš„å…¸å‹å†™æ³•ï¼šæŠŠ <code>block_cfg</code>ï¼ˆåŒ…å« <code>type</code> å’Œå„ç§å‚æ•°ï¼‰äº¤ç»™æ³¨å†Œè¡¨å·¥å‚ï¼Œè¿”å›ä¸€ä¸ªçœŸæ­£çš„ <code>nn.Module</code>ã€‚</p>
</li>
<li>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š<strong>è¿™ä¸€å±‚ top-down ç”¨çš„åˆ°åº•æ˜¯å“ªä¸ªç±»</strong>ï¼Œç”± <code>block_cfg[&quot;type&quot;]</code> å†³å®šï¼ˆYOLO-World å¾€å¾€ä¼šç”¨â€œæ”¯æŒ txt_feats è¾“å…¥â€çš„ block å®ç°ï¼‰ã€‚</p>
</li>
</ul>
<hr>
<h2 id="def-build-bottom-up-layer"><a class="header-anchor" href="#def-build-bottom-up-layer">ğŸ”—</a>def build_bottom_up_layer</h2>
<p>å®ƒåšçš„äº‹å’Œ <code>build_top_down_layer</code> å¾ˆåƒï¼Œä½†<strong>æ–¹å‘ç›¸å</strong>ï¼šbottom-upï¼ˆPANï¼‰é˜¶æ®µæ˜¯â€œæ›´é«˜åˆ†è¾¨ç‡ â†’ ä¸‹é‡‡æ · â†’ ä¸æ›´ä½åˆ†è¾¨ç‡ç‰¹å¾ concat â†’ è¿‡èåˆå—â€ã€‚</p>
<hr>
<h3 id="ä»£ç åŸæ–‡-2"><a class="header-anchor" href="#ä»£ç åŸæ–‡-2">ğŸ”—</a>ä»£ç åŸæ–‡</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">build_bottom_up_layer</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; nn.Module:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;build bottom up layer.</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        idx (int): layer idx.</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        nn.Module: The bottom up layer.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    block_cfg = copy.deepcopy(<span class="variable language_">self</span>.block_cfg)</span><br><span class="line">    block_cfg.update(</span><br><span class="line">        <span class="built_in">dict</span>(in_channels=make_divisible(</span><br><span class="line">            (<span class="variable language_">self</span>.out_channels[idx] + <span class="variable language_">self</span>.out_channels[idx + <span class="number">1</span>]),</span><br><span class="line">            <span class="variable language_">self</span>.widen_factor),</span><br><span class="line">             out_channels=make_divisible(<span class="variable language_">self</span>.out_channels[idx + <span class="number">1</span>],</span><br><span class="line">                                         <span class="variable language_">self</span>.widen_factor),</span><br><span class="line">             guide_channels=<span class="variable language_">self</span>.guide_channels,</span><br><span class="line">             embed_channels=make_round(<span class="variable language_">self</span>.embed_channels[idx],</span><br><span class="line">                                       <span class="variable language_">self</span>.widen_factor),</span><br><span class="line">             num_heads=make_round(<span class="variable language_">self</span>.num_heads[idx], <span class="variable language_">self</span>.widen_factor),</span><br><span class="line">             num_blocks=make_round(<span class="variable language_">self</span>.num_csp_blocks,</span><br><span class="line">                                   <span class="variable language_">self</span>.deepen_factor),</span><br><span class="line">             add_identity=<span class="literal">False</span>,</span><br><span class="line">             norm_cfg=<span class="variable language_">self</span>.norm_cfg,</span><br><span class="line">             act_cfg=<span class="variable language_">self</span>.act_cfg))</span><br><span class="line">    <span class="keyword">return</span> MODELS.build(block_cfg)</span><br></pre></td></tr></table></figure>
<h3 id="1-å‡½æ•°å¤´-2"><a class="header-anchor" href="#1-å‡½æ•°å¤´-2">ğŸ”—</a>1) å‡½æ•°å¤´</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">build_bottom_up_layer</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; nn.Module:</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>idx</code> è¡¨ç¤ºå½“å‰è¦æ„å»ºå“ªä¸€å±‚ bottom-up èåˆå—ã€‚</p>
</li>
<li>
<p>bottom-up çš„å…¸å‹æ•°æ®æµï¼š</p>
<p><strong>ç¬¬ idx å±‚è¾“å‡ºï¼ˆé«˜åˆ†è¾¨ç‡ï¼‰</strong> â†’ å…ˆç»è¿‡ <code>downsample_layers[idx]</code> ä¸‹é‡‡æ · â†’ ä¸ <strong>ç¬¬ idx+1 å±‚è¾“å‡ºï¼ˆä½åˆ†è¾¨ç‡ï¼‰</strong> concat â†’ è¿‡ä¸€ä¸ªèåˆ blockã€‚</p>
</li>
<li>
<p>è¿”å›å€¼ï¼šè¿™ä¸€å±‚ bottom-up ç”¨çš„ <code>nn.Module</code>ã€‚</p>
</li>
</ul>
<hr>
<h3 id="2-æ·±æ‹·è´-block-æ¨¡æ¿é…ç½®"><a class="header-anchor" href="#2-æ·±æ‹·è´-block-æ¨¡æ¿é…ç½®">ğŸ”—</a>2) æ·±æ‹·è´ block æ¨¡æ¿é…ç½®</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">block_cfg = copy.deepcopy(<span class="variable language_">self</span>.block_cfg)</span><br></pre></td></tr></table></figure>
<p>å’Œ top-down ä¸€æ ·ï¼šæ¯ä¸€å±‚éƒ½ä»åŒä¸€ä¸ªæ¨¡æ¿å‡ºå‘è¡¥å‚æ•°ï¼Œæ·±æ‹·è´é¿å…äº’ç›¸æ±¡æŸ“ã€‚</p>
<hr>
<h3 id="3-å…³é”®ï¼šç»™è¿™ä¸€å±‚è¡¥é½æ„å»ºå‚æ•°"><a class="header-anchor" href="#3-å…³é”®ï¼šç»™è¿™ä¸€å±‚è¡¥é½æ„å»ºå‚æ•°">ğŸ”—</a>3) å…³é”®ï¼šç»™è¿™ä¸€å±‚è¡¥é½æ„å»ºå‚æ•°</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">block_cfg.update(<span class="built_in">dict</span>(...))</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå†³å®šäº† bottom-up èåˆå—çš„è¾“å…¥/è¾“å‡ºé€šé“ã€æ–‡æœ¬å¼•å¯¼ç»´åº¦ã€embedding/head æ•°ã€block æ·±åº¦ã€norm/act ç­‰ã€‚</p>
<hr>
<h4 id="3-1-bottom-up-çš„-in-channelsï¼šæ¥è‡ª-concatï¼ˆä¸¤ä¸ªéƒ½æ˜¯-out-channelsï¼‰"><a class="header-anchor" href="#3-1-bottom-up-çš„-in-channelsï¼šæ¥è‡ª-concatï¼ˆä¸¤ä¸ªéƒ½æ˜¯-out-channelsï¼‰">ğŸ”—</a>3.1 bottom-up çš„ in_channelsï¼šæ¥è‡ª concatï¼ˆä¸¤ä¸ªéƒ½æ˜¯ out_channelsï¼‰</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">in_channels=make_divisible(</span><br><span class="line">    (<span class="variable language_">self</span>.out_channels[idx] + <span class="variable language_">self</span>.out_channels[idx + <span class="number">1</span>]),</span><br><span class="line">    <span class="variable language_">self</span>.widen_factor),</span><br></pre></td></tr></table></figure>
<p>è¿™è¡Œæ˜¯ bottom-up ä¸ top-down æœ€å¤§çš„å·®å¼‚ç‚¹ä¹‹ä¸€ï¼š</p>
<ul>
<li>
<p><strong>top-down</strong>ï¼šconcat çš„ä¸¤è·¯æ¥æºé€šå¸¸è¿˜æ˜¯ backbone å¯¹åº”å±‚çš„ <code>in_channels[...]</code>ï¼ˆå†åŠ ä¸Šä¸Šé‡‡æ ·çš„é«˜å±‚ç‰¹å¾ï¼‰ã€‚</p>
</li>
<li>
<p><strong>bottom-up</strong>ï¼šconcat çš„ä¸¤è·¯æ¥æºé€šå¸¸æ˜¯<strong>å·²ç»ç»è¿‡ top-down èåˆåçš„è¾“å‡ºç‰¹å¾</strong>ï¼Œå› æ­¤ç”¨çš„æ˜¯ <code>self.out_channels[...]</code>ã€‚</p>
</li>
</ul>
<p>æ›´å…·ä½“ç‚¹ï¼š</p>
<ul>
<li>
<p>ä¸€è·¯æ˜¯ <code>idx</code> å°ºåº¦ï¼ˆæ›´é«˜åˆ†è¾¨ç‡ï¼‰çš„è¾“å‡ºï¼š<code>self.out_channels[idx]</code></p>
</li>
<li>
<p>å¦ä¸€è·¯æ˜¯ <code>idx+1</code> å°ºåº¦ï¼ˆæ›´ä½åˆ†è¾¨ç‡ï¼‰çš„è¾“å‡ºï¼š<code>self.out_channels[idx+1]</code></p>
</li>
<li>
<p>ä¸¤è·¯ concatï¼Œæ‰€ä»¥è¾“å…¥é€šé“ç›¸åŠ ã€‚</p>
</li>
<li>
<p><code>make_divisible(..., widen_factor)</code>ï¼šåšå®½åº¦ç¼©æ”¾å¹¶è§„æ•´é€šé“æ•°ã€‚</p>
</li>
</ul>
<hr>
<h4 id="3-2-out-channelsï¼šå¯¹é½åˆ°æ›´ä½åˆ†è¾¨ç‡é‚£å±‚ï¼ˆidx-1ï¼‰"><a class="header-anchor" href="#3-2-out-channelsï¼šå¯¹é½åˆ°æ›´ä½åˆ†è¾¨ç‡é‚£å±‚ï¼ˆidx-1ï¼‰">ğŸ”—</a>3.2 out_channelsï¼šå¯¹é½åˆ°æ›´ä½åˆ†è¾¨ç‡é‚£å±‚ï¼ˆidx+1ï¼‰</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">out_channels=make_divisible(<span class="variable language_">self</span>.out_channels[idx + <span class="number">1</span>], <span class="variable language_">self</span>.widen_factor),</span><br></pre></td></tr></table></figure>
<p>bottom-up èåˆåçš„ç»“æœï¼Œæ˜¯è¦è¾“å‡ºåˆ° <strong>æ›´ä½åˆ†è¾¨ç‡/æ›´é«˜è¯­ä¹‰å±‚</strong>ï¼ˆ<code>idx+1</code>ï¼‰é‚£ä¸€è·¯ä¸Šï¼Œæ‰€ä»¥è¾“å‡ºé€šé“å¯¹é½ <code>self.out_channels[idx+1]</code>ï¼Œå†åš <code>make_divisible</code>ã€‚</p>
<hr>
<h4 id="3-3-YOLO-World-ç‰¹æœ‰ï¼šæ–‡æœ¬å¼•å¯¼ç»´åº¦"><a class="header-anchor" href="#3-3-YOLO-World-ç‰¹æœ‰ï¼šæ–‡æœ¬å¼•å¯¼ç»´åº¦">ğŸ”—</a>3.3 YOLO-World ç‰¹æœ‰ï¼šæ–‡æœ¬å¼•å¯¼ç»´åº¦</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">guide_channels=<span class="variable language_">self</span>.guide_channels,</span><br></pre></td></tr></table></figure>
<p>å’Œ top-down ä¸€æ ·ï¼šå‘Šè¯‰èåˆæ¨¡å—ï¼Œå¤–éƒ¨ä¼ å…¥çš„ <code>txt_feats</code>ï¼ˆguide ç‰¹å¾ï¼‰æ˜¯å¤šå°‘ç»´ï¼Œä¾¿äºæ¨¡å—å†…éƒ¨åšæŠ•å½±/æ³¨æ„åŠ›ã€‚</p>
<hr>
<h4 id="3-4-embed-channelsï¼šæ³¨æ„è¿™é‡Œç”¨çš„æ˜¯-embed-channels-idx"><a class="header-anchor" href="#3-4-embed-channelsï¼šæ³¨æ„è¿™é‡Œç”¨çš„æ˜¯-embed-channels-idx">ğŸ”—</a>3.4 embed_channelsï¼šæ³¨æ„è¿™é‡Œç”¨çš„æ˜¯ embed_channels[idx]</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">embed_channels=make_round(<span class="variable language_">self</span>.embed_channels[idx], <span class="variable language_">self</span>.widen_factor),</span><br></pre></td></tr></table></figure>
<p>å¯¹æ¯”ä¸€ä¸‹ï¼š</p>
<ul>
<li>
<p>top-down ç”¨çš„æ˜¯ <code>embed_channels[idx - 1]</code></p>
</li>
<li>
<p>bottom-up ç”¨çš„æ˜¯ <code>embed_channels[idx]</code></p>
</li>
</ul>
<p>åŸå› ç›´è§‚ç†è§£ï¼šbottom-up è¿™ä¸€æ­¥çš„â€œä¸»å¹²å°ºåº¦â€æ˜¯ä» <code>idx</code> å¾€ <code>idx+1</code> æ¨è¿›ï¼Œå› æ­¤è¿™ä¸€å±‚èåˆå—çš„ embedding é…ç½®é€šå¸¸æŒ‰ <code>idx</code> å¯¹é½ï¼ˆå®ç°é‡Œå°±æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼‰ã€‚</p>
<p>åŒæ ·æŒ‰ <code>widen_factor</code> ç¼©æ”¾åå–æ•´ã€‚</p>
<hr>
<h4 id="3-5-num-headsï¼šåŒæ ·æŒ‰-idx-å–"><a class="header-anchor" href="#3-5-num-headsï¼šåŒæ ·æŒ‰-idx-å–">ğŸ”—</a>3.5 num_headsï¼šåŒæ ·æŒ‰ idx å–</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num_heads=make_round(<span class="variable language_">self</span>.num_heads[idx], <span class="variable language_">self</span>.widen_factor),</span><br></pre></td></tr></table></figure>
<p>åŒç†ï¼Œbottom-up çš„ head æ•°ä¹Ÿè·Ÿéš <code>idx</code> è¿™å±‚çš„é…ç½®ï¼Œå¹¶æŒ‰ <code>widen_factor</code> ç¼©æ”¾å–æ•´ã€‚</p>
<hr>
<h4 id="3-6-num-blocksï¼šCSP-å †å æ•°æŒ‰-deepen-factor-ç¼©æ”¾"><a class="header-anchor" href="#3-6-num-blocksï¼šCSP-å †å æ•°æŒ‰-deepen-factor-ç¼©æ”¾">ğŸ”—</a>3.6 num_blocksï¼šCSP å †å æ•°æŒ‰ deepen_factor ç¼©æ”¾</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num_blocks=make_round(<span class="variable language_">self</span>.num_csp_blocks, <span class="variable language_">self</span>.deepen_factor),</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>åŸºç¡€ <code>num_csp_blocks</code>ï¼ˆé»˜è®¤ 3ï¼‰</p>
</li>
<li>
<p><code>deepen_factor</code> å†³å®šâ€œå˜æ·±å¤šå°‘â€ï¼šæ›´å¤§æ¨¡å‹ä¼šå †æ›´å¤šå±‚ã€‚</p>
</li>
</ul>
<hr>
<h4 id="3-7-add-identity-False"><a class="header-anchor" href="#3-7-add-identity-False">ğŸ”—</a>3.7 add_identity=False</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_identity=<span class="literal">False</span>,</span><br></pre></td></tr></table></figure>
<p>å…³é—­ identity shortcutï¼ˆæ˜¯å¦æœ‰æ®‹å·®æ·å¾„å–å†³äºå…·ä½“ block å®ç°ï¼›è¿™é‡Œç»Ÿä¸€å…³æ‰ï¼‰ã€‚</p>
<hr>
<h4 id="3-8-è§„èŒƒåŒ–ä¸æ¿€æ´»é…ç½®"><a class="header-anchor" href="#3-8-è§„èŒƒåŒ–ä¸æ¿€æ´»é…ç½®">ğŸ”—</a>3.8 è§„èŒƒåŒ–ä¸æ¿€æ´»é…ç½®</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">norm_cfg=<span class="variable language_">self</span>.norm_cfg,</span><br><span class="line">act_cfg=<span class="variable language_">self</span>.act_cfg</span><br></pre></td></tr></table></figure>
<p>ä¿è¯ bottom-up èåˆå—ä½¿ç”¨åŒä¸€å¥— BN/æ¿€æ´»è®¾å®šã€‚</p>
<hr>
<h3 id="4-ç”¨æ³¨å†Œè¡¨çœŸæ­£å®ä¾‹åŒ–æ¨¡å—"><a class="header-anchor" href="#4-ç”¨æ³¨å†Œè¡¨çœŸæ­£å®ä¾‹åŒ–æ¨¡å—">ğŸ”—</a>4) ç”¨æ³¨å†Œè¡¨çœŸæ­£å®ä¾‹åŒ–æ¨¡å—</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> MODELS.build(block_cfg)</span><br></pre></td></tr></table></figure>
<p>æŠŠ <code>block_cfg</code> äº¤ç»™ MMEngine çš„æ³¨å†Œè¡¨å·¥å‚ï¼Œæ ¹æ® <code>block_cfg[&quot;type&quot;]</code> æ„å»ºæ¨¡å—å¹¶è¿”å›ã€‚</p>
<hr>
<h3 id="bottom-up-vs-top-down-çš„æ ¸å¿ƒå·®å¼‚"><a class="header-anchor" href="#bottom-up-vs-top-down-çš„æ ¸å¿ƒå·®å¼‚">ğŸ”—</a>bottom-up vs top-down çš„æ ¸å¿ƒå·®å¼‚</h3>
<ul>
<li>
<p><strong>top-down</strong>ï¼š<code>in_channels</code> ç”¨ <code>self.in_channels[...]</code> åšæ‹¼æ¥ï¼›<code>embed_channels/num_heads</code> ç”¨ <code>idx-1</code> å¯¹é½ã€‚</p>
</li>
<li>
<p><strong>bottom-up</strong>ï¼š<code>in_channels</code> ç”¨ <code>self.out_channels[...]</code> åšæ‹¼æ¥ï¼›<code>embed_channels/num_heads</code> ç”¨ <code>idx</code> å¯¹é½ï¼›è¾“å‡ºå¯¹é½ <code>idx+1</code>ã€‚</p>
</li>
</ul>
<hr>
<h2 id="def-forward"><a class="header-anchor" href="#def-forward">ğŸ”—</a>def forward</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, img_feats: <span class="type">List</span>[Tensor], txt_feats: Tensor = <span class="literal">None</span></span>) -&gt; <span class="built_in">tuple</span>:</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ®µå°±æ˜¯æŠŠ backbone çš„å¤šå°ºåº¦å›¾åƒç‰¹å¾ <code>img_feats</code>ï¼Œç»“åˆå¯é€‰çš„æ–‡æœ¬ç‰¹å¾ <code>txt_feats</code>ï¼Œèµ°ä¸€é <strong>reduce â†’ top-down â†’ bottom-up â†’ out_layers</strong>ï¼Œæœ€ç»ˆè¾“å‡ºå¤šå°ºåº¦ neck ç‰¹å¾ã€‚</p>
<hr>
<h3 id="1-å‡½æ•°å¤´ä¸æ³¨é‡Š"><a class="header-anchor" href="#1-å‡½æ•°å¤´ä¸æ³¨é‡Š">ğŸ”—</a>1) å‡½æ•°å¤´ä¸æ³¨é‡Š</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, img_feats: <span class="type">List</span>[Tensor], txt_feats: Tensor = <span class="literal">None</span></span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Forward function.</span></span><br><span class="line"><span class="string">    including multi-level image features, text features: BxLxD</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>img_feats</code>: backbone è¾“å‡ºçš„å¤šå°ºåº¦ç‰¹å¾åˆ—è¡¨ï¼Œä¾‹å¦‚ <code>[P3, P4, P5]</code>ï¼Œæ¯ä¸ªæ˜¯ <code>Tensor</code>ã€‚</p>
</li>
<li>
<p><code>txt_feats</code>: æ–‡æœ¬ç‰¹å¾ï¼ˆå¯é€‰ï¼‰ã€‚æ³¨é‡Šå†™äº† <code>BxLxD</code>ï¼š</p>
<ul>
<li>
<p><code>B</code>: batch size</p>
</li>
<li>
<p><code>L</code>: token æ•°</p>
</li>
<li>
<p><code>D</code>: token embedding ç»´åº¦ï¼ˆä¹Ÿå°±æ˜¯ä½ åœ¨ <code>guide_channels</code> é‡Œå£°æ˜çš„ç»´åº¦ï¼Œæˆ–å…¼å®¹çš„ç»´åº¦ï¼‰</p>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-åŸºæœ¬ä¸€è‡´æ€§æ£€æŸ¥"><a class="header-anchor" href="#2-åŸºæœ¬ä¸€è‡´æ€§æ£€æŸ¥">ğŸ”—</a>2) åŸºæœ¬ä¸€è‡´æ€§æ£€æŸ¥</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(img_feats) == <span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>è¦æ±‚è¾“å…¥çš„ç‰¹å¾å±‚æ•°ï¼Œå¿…é¡»å’Œ neck é…ç½®çš„ <code>in_channels</code> å±‚æ•°ä¸€è‡´ã€‚</p>
</li>
<li>
<p>æ¯”å¦‚ä½ é…ç½® neck æ¥ 3 ä¸ªå°ºåº¦ï¼Œé‚£ <code>img_feats</code> ä¹Ÿå¿…é¡»æ˜¯é•¿åº¦ 3 çš„ listã€‚</p>
</li>
</ul>
<hr>
<h3 id="3-Reduce-é˜¶æ®µï¼šå…ˆæŠŠæ¯ä¸ªå°ºåº¦é€šé“â€œå¯¹é½-å‹ç¼©â€"><a class="header-anchor" href="#3-Reduce-é˜¶æ®µï¼šå…ˆæŠŠæ¯ä¸ªå°ºåº¦é€šé“â€œå¯¹é½-å‹ç¼©â€">ğŸ”—</a>3) Reduce é˜¶æ®µï¼šå…ˆæŠŠæ¯ä¸ªå°ºåº¦é€šé“â€œå¯¹é½/å‹ç¼©â€</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reduce layers</span></span><br><span class="line">reduce_outs = [] <span class="comment"># ç”¨äºå­˜å‚¨æ¯ä¸€å±‚çš„è¾“å‡º</span></span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels)):</span><br><span class="line">    reduce_outs.append(<span class="variable language_">self</span>.reduce_layers[idx](img_feats[idx]))</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>ç»“æœ <code>reduce_outs</code> ä»ç„¶æ˜¯ä¸€ä¸ªå¤šå°ºåº¦ listï¼Œé•¿åº¦ä¸å˜ï¼Œä½†æ¯å±‚é€šé“é€šå¸¸è¢«â€œç»Ÿä¸€/å¯¹é½â€äº†ã€‚</p>
</li>
<li>
<p>è¿™ä¸€é˜¶æ®µä¸æ¶‰åŠæ–‡æœ¬ç‰¹å¾ã€‚</p>
</li>
</ul>
<blockquote>
<p><code>range(len(self.in_channels))</code>ï¼šåœ¨å¾ªç¯ä¸­è¿­ä»£ <code>in_channels</code> çš„é•¿åº¦ï¼Œå³ <strong>éå†æ¯ä¸€å±‚çš„è¾“å…¥é€šé“æ•°</strong>ã€‚</p>
</blockquote>
<blockquote></blockquote>
<blockquote>
<ul>
<li>å‡è®¾ <code>self.in_channels = [256, 512, 1024]</code>ï¼Œé‚£ä¹ˆ <code>idx</code> ä¼šä» 0 åˆ° 2ï¼ˆå…± 3 æ¬¡ï¼‰ã€‚</li>
</ul>
</blockquote>
<blockquote></blockquote>
<blockquote>
<hr>
</blockquote>
<blockquote></blockquote>
<blockquote>
<p><code>img_feats[idx]</code>ï¼šè¿™æ˜¯ä¼ é€’åˆ°æ¨¡å‹ä¸­çš„è¾“å…¥ç‰¹å¾å›¾åˆ—è¡¨ï¼ˆ<code>img_feats</code>ï¼‰ã€‚æ¯ä¸€é¡¹ <code>img_feats[idx]</code> æ˜¯ä¸€ä¸ªå¼ é‡ï¼Œè¡¨ç¤ºæŸä¸€å±‚çš„ç‰¹å¾å›¾ï¼Œå°ºå¯¸ä¸º <code>(batch_size, channels, height, width)</code>ã€‚</p>
</blockquote>
<blockquote></blockquote>
<blockquote>
<hr>
</blockquote>
<blockquote></blockquote>
<blockquote>
<p><code>self.reduce_layers[idx](img_feats[idx])</code>ï¼š<strong>å¯¹æ¯ä¸€å±‚ç‰¹å¾å›¾åº”ç”¨ reduce layer</strong>ï¼Œè¿›è¡Œé™ç»´ï¼ˆé€šå¸¸æ˜¯å‡å°é€šé“æ•°ï¼‰ã€‚æ­¤æ“ä½œé€šå¸¸æ˜¯ä¸€ä¸ªå·ç§¯å±‚ï¼Œ<strong>å°† <code>img_feats[idx]</code> çš„é€šé“æ•°å‡å°</strong>ï¼Œå¹¶ä¸”ä¿ç•™ç‰¹å¾å›¾çš„ç©ºé—´åˆ†è¾¨ç‡ï¼ˆ<code>height</code> å’Œ <code>width</code> ä¸å˜ï¼‰ã€‚</p>
</blockquote>
<blockquote></blockquote>
<blockquote>
<hr>
</blockquote>
<blockquote></blockquote>
<blockquote>
<p><strong>ä¾‹å­</strong></p>
</blockquote>
<blockquote></blockquote>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;<span class="variable language_">self</span>.in_channels = [<span class="number">256</span>, <span class="number">512</span>, <span class="number">1024</span>]</span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#self.reduce_layers åŒ…å«äº† 3 ä¸ªä¸åŒçš„ å·ç§¯å±‚ï¼Œåˆ†åˆ«å¯¹åº”äºæ¯ä¸€å±‚è¾“å…¥é€šé“æ•°</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="variable language_">self</span>.reduce_layers = [conv1, conv2, conv3]</span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#conv1 å¯èƒ½æ˜¯ä¸€ä¸ª Conv2d å±‚ï¼Œæ¥æ”¶ 256 é€šé“çš„è¾“å…¥å¹¶å°†è¾“å‡ºé€šé“æ•°å‡å°ï¼ˆä¾‹å¦‚é™åˆ° 128ï¼‰ã€‚åŒç†ï¼Œconv2 ä¼šå°† 512 é€šé“çš„ç‰¹å¾å›¾å‡å°é€šé“æ•°ï¼Œconv3 å°† 1024 é€šé“çš„ç‰¹å¾å›¾å‡å°ã€‚</span></span><br><span class="line"></span><br><span class="line">&gt;img_feats = [feat1, feat2, feat3]</span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#feat1 çš„å½¢çŠ¶æ˜¯ (batch_size, 256, height, width)</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#feat2 çš„å½¢çŠ¶æ˜¯ (batch_size, 512, height // 2, width // 2)</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#feat3 çš„å½¢çŠ¶æ˜¯ (batch_size, 1024, height // 4, width // 4)</span></span><br><span class="line"></span><br><span class="line">&gt;reduce_outs.append(conv1(feat1))  <span class="comment"># è¾“å‡ºå½¢çŠ¶: (batch_size, 128, height, width)</span></span><br><span class="line"></span><br><span class="line">&gt;reduce_outs.append(conv2(feat2))  <span class="comment"># è¾“å‡ºå½¢çŠ¶: (batch_size, 256, height//2, width//2)</span></span><br><span class="line"></span><br><span class="line">&gt;reduce_outs.append(conv3(feat3))  <span class="comment"># è¾“å‡ºå½¢çŠ¶: (batch_size, 512, height//4, width//4)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote></blockquote>
<blockquote></blockquote>
<hr>
<h3 id="4-Top-down-è·¯å¾„ï¼šé«˜å±‚è¯­ä¹‰å‘ä½å±‚ä¼ æ’­ï¼ˆä¸Šé‡‡æ ·-concat-èåˆå—ï¼‰"><a class="header-anchor" href="#4-Top-down-è·¯å¾„ï¼šé«˜å±‚è¯­ä¹‰å‘ä½å±‚ä¼ æ’­ï¼ˆä¸Šé‡‡æ ·-concat-èåˆå—ï¼‰">ğŸ”—</a>4) Top-down è·¯å¾„ï¼šé«˜å±‚è¯­ä¹‰å‘ä½å±‚ä¼ æ’­ï¼ˆä¸Šé‡‡æ · + concat + èåˆå—ï¼‰</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># top-down path</span></span><br><span class="line">inner_outs = [reduce_outs[-<span class="number">1</span>]]</span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">    feat_high = inner_outs[<span class="number">0</span>]</span><br><span class="line">    feat_low = reduce_outs[idx - <span class="number">1</span>]</span><br><span class="line">    upsample_feat = <span class="variable language_">self</span>.upsample_layers[<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels) - <span class="number">1</span> - idx](feat_high)</span><br></pre></td></tr></table></figure>
<p>é€è¡Œè§£é‡Šï¼š</p>
<ul>
<li>
<p><code>inner_outs = [reduce_outs[-1]]</code></p>
<ul>
<li>ä»<strong>æœ€æ·±å±‚/åˆ†è¾¨ç‡æœ€ä½/è¯­ä¹‰æœ€å¼º</strong>çš„é‚£å±‚å¼€å§‹ï¼ˆlist æœ€åä¸€ä¸ªï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><code>for idx in range(len(self.in_channels) - 1, 0, -1):</code></p>
</li>
<li>
<p>è‹¥<code>len(self.in_channels)=3</code>ï¼Œåˆ™<code>idx=2,1</code></p>
</li>
<li>
<p><code>feat_high = inner_outs[0]</code></p>
</li>
<li>
<p>å½“å‰å·²ç»å¾—åˆ°çš„â€œæ›´é«˜è¯­ä¹‰â€çš„ç‰¹å¾ï¼ˆä¸€å¼€å§‹å°±æ˜¯æœ€æ·±å±‚ï¼‰ã€‚</p>
</li>
<li>
<p><code>feat_low = reduce_outs[idx - 1]</code></p>
<ul>
<li>å½“å‰è¦èåˆçš„â€œæ›´é«˜åˆ†è¾¨ç‡â€çš„é‚£ä¸€å±‚ã€‚</li>
</ul>
</li>
<li>
<p><code>upsample_feat = self.upsample_layers[...] (feat_high)</code></p>
<ul>
<li>æŠŠé«˜å±‚ç‰¹å¾ä¸Šé‡‡æ ·åˆ°ä¸ <code>feat_low</code> ç›¸åŒçš„ç©ºé—´å°ºå¯¸ï¼Œå‡†å¤‡ concatã€‚</li>
</ul>
</li>
</ul>
<p>æ¥ç€æ˜¯ concat çš„é¡ºåºæ§åˆ¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="variable language_">self</span>.upsample_feats_cat_first:</span><br><span class="line">    top_down_layer_inputs = torch.cat([upsample_feat, feat_low], <span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    top_down_layer_inputs = torch.cat([feat_low, upsample_feat], <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>torch.cat(..., 1)</code> è¡¨ç¤ºåœ¨ <strong>channel ç»´åº¦</strong>æ‹¼æ¥ã€‚</p>
</li>
<li>
<p><code>self.upsample_feats_cat_first</code> å†³å®šæ‹¼æ¥é¡ºåºï¼š</p>
<ul>
<li>
<p><code>True</code>ï¼š<code>[ä¸Šé‡‡æ ·é«˜å±‚, ä½å±‚]</code></p>
</li>
<li>
<p><code>False</code>ï¼š<code>[ä½å±‚, ä¸Šé‡‡æ ·é«˜å±‚]</code></p>
</li>
</ul>
</li>
<li>
<p>ä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªå¼€å…³ï¼Ÿæœ‰äº›å®ç°/æƒé‡çº¦å®šé‡Œï¼Œconcat é¡ºåºä¼šå½±å“åç»­å·ç§¯å±‚â€œçœ‹åˆ°çš„é€šé“æ’åˆ—â€ï¼Œä¸ºäº†å…¼å®¹ä¸åŒç‰ˆæœ¬/é¢„è®­ç»ƒæƒé‡å°±ä¼šä¿ç•™è¿™ä¸ªé€‰é¡¹ã€‚</p>
</li>
</ul>
<p>ç„¶åè¿›å…¥èåˆå—ï¼ˆè¿™é‡Œå°±æ˜¯ YOLO-World çš„å…³é”®å·®å¼‚ï¼šæŠŠ <code>txt_feats</code> ä¼ è¿›å»ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">inner_out = <span class="variable language_">self</span>.top_down_layers[<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels) - <span class="number">1</span> - idx](</span><br><span class="line">    top_down_layer_inputs, txt_feats)</span><br><span class="line">inner_outs.insert(<span class="number">0</span>, inner_out)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>self.top_down_layers[...]</code> æ˜¯åœ¨ <code>build_top_down_layer</code> é‡Œæ„å»ºå‡ºæ¥çš„æ¨¡å—ã€‚</p>
</li>
<li>
<p>å®ƒçš„ forward å½¢å¼æ˜¯ <code>(x, txt_feats)</code>ï¼Œè¯´æ˜è¿™ä¸ª block <strong>å†…éƒ¨ä¼šç”¨æ–‡æœ¬ç‰¹å¾å¼•å¯¼/äº¤äº’</strong>ï¼ˆæ¯”å¦‚æ³¨æ„åŠ›ã€ç›¸ä¼¼åº¦è°ƒåˆ¶ã€é—¨æ§ç­‰â€”â€”å…·ä½“ç»†èŠ‚å–å†³äºä½  <code>block_cfg[&quot;type&quot;]</code> çš„å®ç°ï¼‰ã€‚</p>
</li>
<li>
<p><code>inner_outs.insert(0, inner_out)</code>ï¼š</p>
<ul>
<li>æŠŠæ–°å¾—åˆ°çš„æ›´ä½å±‚ç»“æœæ’åˆ°æœ€å‰é¢ï¼Œä¿è¯ <code>inner_outs</code> å§‹ç»ˆä»â€œé«˜åˆ†è¾¨ç‡â†’ä½åˆ†è¾¨ç‡â€é¡ºåºæ’åˆ—ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>èµ°å®Œ top-down åï¼Œ<code>inner_outs</code> å°±æ˜¯ä¸€å¥—å·²ç»èåˆè¿‡çš„å¤šå°ºåº¦ç‰¹å¾ï¼ˆä½†è¿˜æ²¡èµ° PAN çš„ bottom-up å›ä¼ ï¼‰ã€‚</p>
</blockquote>
<hr>
<blockquote>
<p><span style="color:#FF0000"><strong>å…¨æµç¨‹ä¾‹å­</strong></span></p>
</blockquote>
<blockquote></blockquote>
<blockquote>
<p><strong>å‡è®¾</strong></p>
</blockquote>
<blockquote></blockquote>
<blockquote>
<ul>
<li><code>reduce_outs = [feat1, feat2, feat3]</code>ï¼Œå…¶ä¸­ï¼š</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><code>feat1</code> æ˜¯æœ€æµ…å±‚çš„ç‰¹å¾å›¾ï¼Œå‡è®¾å®ƒçš„å½¢çŠ¶ä¸º <code>(batch_size, 256, 128, 128)</code>ã€‚</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><code>feat2</code> æ˜¯ä¸­é—´å±‚çš„ç‰¹å¾å›¾ï¼Œå‡è®¾å®ƒçš„å½¢çŠ¶ä¸º <code>(batch_size, 512, 64, 64)</code>ã€‚</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><code>feat3</code> æ˜¯æœ€æ·±å±‚çš„ç‰¹å¾å›¾ï¼Œå‡è®¾å®ƒçš„å½¢çŠ¶ä¸º <code>(batch_size, 1024, 32, 32)</code>ã€‚</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><code>self.in_channels = [256, 512, 1024]</code>ï¼Œè¡¨ç¤ºæ¯ä¸€å±‚è¾“å…¥ç‰¹å¾å›¾çš„é€šé“æ•°ã€‚</li>
</ul>
</blockquote>
<blockquote></blockquote>
<blockquote>
<p>å‡è®¾ <code>self.upsample_layers</code> æ˜¯ä¸€ä¸ªåŒ…å«ä¸Šé‡‡æ ·å±‚çš„åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸€é¡¹å¯¹åº”ä¸€ä¸ªä¸Šé‡‡æ ·æ“ä½œï¼Œå‡è®¾æœ‰ä¸‰ä¸ªä¸Šé‡‡æ ·å±‚ï¼Œæ¯ä¸ªä¸Šé‡‡æ ·å±‚è´Ÿè´£å°†ç‰¹å¾å›¾çš„ç©ºé—´å°ºå¯¸ä¸Šé‡‡æ ·åˆ°è¾ƒä½å±‚ç‰¹å¾å›¾çš„åˆ†è¾¨ç‡ã€‚</p>
</blockquote>
<blockquote></blockquote>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;inner_outs = [reduce_outs[-<span class="number">1</span>]] <span class="comment">#reduce_outs[-1] å–çš„æ˜¯æœ€æ·±å±‚çš„ç‰¹å¾å›¾ï¼Œå³ feat3</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#inner_outs = [feat3]ï¼Œè®°ä¸ºinner_outs =[inner_out3]</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#len(self.in_channels) = 3 --&gt;for idx in range(2, 0, -1): --&gt;idx çš„å€¼ä¾æ¬¡ä¸º 2 å’Œ 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#---------------ç¬¬ä¸€æ¬¡å¾ªç¯ (idx = 2)------------------------</span></span><br><span class="line"></span><br><span class="line">&gt;feat_high = inner_outs[<span class="number">0</span>] <span class="comment">#inner_outs[0] æ˜¯ feat3</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#feat_high = feat3  shape: (batch_size, 1024, 32, 32)</span></span><br><span class="line"></span><br><span class="line">&gt;feat_low = reduce_outs[idx - <span class="number">1</span>]  <span class="comment"># =reduce_outs[1] ; å³ feat2ï¼Œshape: (batch_size, 512, 64, 64)</span></span><br><span class="line"></span><br><span class="line">&gt;upsample_feat = <span class="variable language_">self</span>.upsample_layers[<span class="number">0</span>](feat_high)  <span class="comment"># shape: (batch_size, 1024, 64, 64)</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#å‡è®¾ self.upsample_feats_cat_first = True</span></span><br><span class="line"></span><br><span class="line">&gt;top_down_layer_inputs = torch.cat([upsample_feat, feat_low], <span class="number">1</span>)  <span class="comment"># shape: (batch_size, 1024+512, 64, 64)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#å‡è®¾ top_down_layers[0] æ˜¯ä¸€ä¸ªå·ç§¯å±‚</span></span><br><span class="line"></span><br><span class="line">&gt;inner_out = <span class="variable language_">self</span>.top_down_layers[<span class="number">0</span>](top_down_layer_inputs, txt_feats)  <span class="comment"># shape: (batch_size, out_channels, 64, 64)</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#æ›´æ–° inner_outs:inner_outs åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼ˆinner_outs[0]ï¼‰æ’å…¥å½“å‰çš„è¾“å‡º inner_out</span></span><br><span class="line"></span><br><span class="line">&gt;inner_outs.insert(<span class="number">0</span>, inner_out)  <span class="comment"># æ›´æ–° inner_outs = [inner_out, inner_out3] = [inner_out2, inner_out3]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#---------------ç¬¬äºŒæ¬¡å¾ªç¯ (idx = 1)------------------------</span></span><br><span class="line"></span><br><span class="line">&gt;feat_high = inner_outs[<span class="number">0</span>] <span class="comment">#ç°åœ¨ inner_outs[0] æ˜¯åˆšåˆšè®¡ç®—çš„ inner_outï¼Œå®ƒçš„å½¢çŠ¶æ˜¯ (batch_size, out_channels, 64, 64)ï¼Œå‡è®¾ out_channels = 256</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#feat_high = inner_out  shape: (batch_size, 256, 64, 64)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;feat_low = reduce_outs[idx - <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">&gt;feat_low = reduce_outs[<span class="number">0</span>]  <span class="comment"># å³ feat1ï¼Œshape: (batch_size, 256, 128, 128)</span></span><br><span class="line"></span><br><span class="line">&gt;<span class="comment">#å‡è®¾ self.upsample_layers[1] ä¼šå°†å…¶ä¸Šé‡‡æ ·åˆ° (batch_size, 256, 128, 128)</span></span><br><span class="line"></span><br><span class="line">&gt;upsample_feat = <span class="variable language_">self</span>.upsample_layers[<span class="number">1</span>](feat_high)  <span class="comment"># shape: (batch_size, 256, 128, 128)</span></span><br><span class="line"></span><br><span class="line">&gt;top_down_layer_inputs = torch.cat([upsample_feat, feat_low], <span class="number">1</span>)  <span class="comment"># shape: (batch_size, 256+256, 128, 128)</span></span><br><span class="line"></span><br><span class="line">&gt;inner_out = <span class="variable language_">self</span>.top_down_layers[<span class="number">1</span>](top_down_layer_inputs, txt_feats)  <span class="comment"># shape: (batch_size, out_channels, 128, 128)</span></span><br><span class="line"></span><br><span class="line">&gt;inner_outs.insert(<span class="number">0</span>, inner_out)  <span class="comment"># æ›´æ–° inner_outs = [inner_out1, inner_out2, inner_out3]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote></blockquote>
<blockquote></blockquote>
<h3 id="5-Bottom-up-è·¯å¾„ï¼šä½å±‚ä¿¡æ¯å‘é«˜å±‚å†èšåˆï¼ˆä¸‹é‡‡æ ·-concat-èåˆå—ï¼‰"><a class="header-anchor" href="#5-Bottom-up-è·¯å¾„ï¼šä½å±‚ä¿¡æ¯å‘é«˜å±‚å†èšåˆï¼ˆä¸‹é‡‡æ ·-concat-èåˆå—ï¼‰">ğŸ”—</a>5) Bottom-up è·¯å¾„ï¼šä½å±‚ä¿¡æ¯å‘é«˜å±‚å†èšåˆï¼ˆä¸‹é‡‡æ · + concat + èåˆå—ï¼‰</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bottom-up path</span></span><br><span class="line">outs = [inner_outs[<span class="number">0</span>]]</span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels) - <span class="number">1</span>):</span><br><span class="line">    feat_low = outs[-<span class="number">1</span>]</span><br><span class="line">    feat_high = inner_outs[idx + <span class="number">1</span>]</span><br><span class="line">    downsample_feat = <span class="variable language_">self</span>.downsample_layers[idx](feat_low)</span><br><span class="line">    out = <span class="variable language_">self</span>.bottom_up_layers[idx](torch.cat([downsample_feat, feat_high], <span class="number">1</span>), txt_feats)</span><br><span class="line">    outs.append(out)</span><br></pre></td></tr></table></figure>
<p>é€è¡Œè§£é‡Šï¼š</p>
<ul>
<li>
<p><code>outs = [inner_outs[0]]</code></p>
<ul>
<li>å‡è®¾ <code>inner_outs = [inner_out1, inner_out2, inner_out3]</code>ï¼Œé‚£ä¹ˆ <code>inner_outs[0]</code> å°±æ˜¯æˆ‘ä»¬æœ€å¼€å§‹çš„é«˜å±‚ç‰¹å¾å›¾ <code>inner_out1</code>ï¼ˆ<strong>æœ€é«˜åˆ†è¾¨ç‡å±‚</strong>ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><code>for idx in range(len(self.in_channels) - 1):</code></p>
<ul>
<li>è‹¥len(self.in_channels) = 3ï¼Œ<code>idx</code> ä¸º 0 å’Œ 1</li>
</ul>
</li>
<li>
<p><code>feat_low = outs[-1]</code></p>
</li>
<li>
<p>å·²çŸ¥<code>outs = [inner_outs[0]]=[inner_out1]</code>--&gt;ç¬¬ä¸€æ¬¡è¿­ä»£æ—¶<code>feat_low = outs[-1]=inner_out1</code>ï¼ˆ<strong>æœ€é«˜åˆ†è¾¨ç‡å±‚</strong>ï¼‰ã€‚</p>
</li>
<li>
<p><code>feat_high = inner_outs[idx + 1]</code></p>
<ul>
<li><code>idx + 1</code> ç¡®ä¿æˆ‘ä»¬è·å–çš„<code>feat_low </code><strong>æ›´é«˜å±‚çš„ç‰¹å¾å›¾</strong>(æ›´é«˜æŒ‡çš„æ˜¯ï¼šå·ç§¯åçš„ï¼Œé€šé“æ•°æ›´å¤šï¼Œåˆ†è¾¨ç‡æ›´å°)</li>
</ul>
</li>
<li>
<p><code>downsample_feat = self.downsample_layers[idx](feat_low)</code></p>
<ul>
<li>
<p>æŠŠé«˜åˆ†è¾¨ç‡ç‰¹å¾ä¸‹é‡‡æ ·åˆ°ä¸ <code>feat_high</code> åŒå°ºå¯¸ã€‚</p>
</li>
<li>
<p><code>self.downsample_layers[idx]</code> æ˜¯ä¸€ä¸ªä¸‹é‡‡æ ·å±‚ï¼Œå®ƒå°† <code>feat_low</code>ï¼ˆå½“å‰åº•å±‚ç‰¹å¾å›¾ï¼‰è¿›è¡Œä¸‹é‡‡æ ·ï¼ˆä¾‹å¦‚é€šè¿‡æ± åŒ–æˆ–å·ç§¯å®ç°ä¸‹é‡‡æ ·ï¼‰ï¼Œå‡å°‘å…¶ç©ºé—´åˆ†è¾¨ç‡ã€‚</p>
</li>
</ul>
</li>
<li>
<p><code>torch.cat([downsample_feat, feat_high], 1)</code></p>
<ul>
<li>æŒ‰ channel æ‹¼æ¥ï¼ˆè¿™é‡Œæ²¡æœ‰åšé¡ºåºå¼€å…³ï¼Œå›ºå®šæ˜¯ <code>[downsample, higher_level]</code>ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><code>self.bottom_up_layers[idx](..., txt_feats)</code></p>
<ul>
<li>bottom-up èåˆå—åŒæ ·æ¥æ”¶ <code>txt_feats</code>ï¼Œç»§ç»­è®©æ–‡æœ¬å¼•å¯¼å‚ä¸ç‰¹å¾èšåˆã€‚</li>
</ul>
</li>
<li>
<p><code>outs.append(out)</code></p>
<ul>
<li>
<p>å°†å½“å‰å±‚çš„è¾“å‡º <code>out</code> æ’å…¥åˆ° <code>outs</code> åˆ—è¡¨ä¸­ï¼Œä¾›ä¸‹ä¸€æ¬¡å¾ªç¯ä½¿ç”¨ã€‚</p>
</li>
<li>
<p><code>outs = [out1,out2,out3]</code>ï¼ˆç‰¹å¾å›¾åˆ†è¾¨ç‡ä»å¤§åˆ°å°ï¼‰</p>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="6-Out-layersï¼šæœ€åå†åšä¸€å±‚è¾“å‡ºæ•´å½¢ï¼ˆé€šå¸¸æ˜¯-1x1-3x3-convï¼‰"><a class="header-anchor" href="#6-Out-layersï¼šæœ€åå†åšä¸€å±‚è¾“å‡ºæ•´å½¢ï¼ˆé€šå¸¸æ˜¯-1x1-3x3-convï¼‰">ğŸ”—</a>6) Out layersï¼šæœ€åå†åšä¸€å±‚è¾“å‡ºæ•´å½¢ï¼ˆé€šå¸¸æ˜¯ 1x1/3x3 convï¼‰</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># out_layers</span></span><br><span class="line">results = []</span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels)):</span><br><span class="line">    results.append(<span class="variable language_">self</span>.out_layers[idx](outs[idx]))</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">tuple</span>(results)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>self.out_layers[idx]</code>ï¼šé€šå¸¸ç”¨äºæŠŠ <code>outs[idx]</code> çš„é€šé“/å½¢å¼å˜æˆ head æœŸæœ›çš„è¾“å…¥å½¢å¼ï¼ˆä¾‹å¦‚å†åšä¸€æ¬¡å·ç§¯æ•´å½¢/å¯¹é½ï¼‰ã€‚</p>
</li>
<li>
<p>æœ€ç»ˆè¿”å› <code>tuple(results)</code>ï¼šä¸€ä¸ªå¤šå°ºåº¦è¾“å‡ºå…ƒç»„ï¼ˆç»™æ£€æµ‹å¤´/åˆ†å‰²å¤´ç»§ç»­ç”¨ï¼‰ã€‚</p>
</li>
</ul>
<hr>
<h1 id="class-YOLOWorldDualPAFPN-YOLOWorldPAFPN"><a class="header-anchor" href="#class-YOLOWorldDualPAFPN-YOLOWorldPAFPN">ğŸ”—</a>class YOLOWorldDualPAFPN(YOLOWorldPAFPN)</h1>
<h2 id="def-init-2"><a class="header-anchor" href="#def-init-2">ğŸ”—</a>def <strong>init</strong></h2>
<p>è¿™ä»½å®ç°é‡Œ Dual çš„æ ¸å¿ƒæ–°å¢ç‚¹æ˜¯ï¼šåœ¨ç»§æ‰¿ <code>YOLOWorldPAFPN</code> åŸæœ¬â€œå›¾åƒ-æ–‡æœ¬å¼•å¯¼çš„ PAFPNâ€åŸºç¡€ä¸Šï¼Œåˆé¢å¤–åŠ äº†ä¸€ä¸ª <code>text_enhancer</code>ï¼Œç”¨å¤šå°ºåº¦å›¾åƒç‰¹å¾å»<strong>å¢å¼º/æ›´æ–°æ–‡æœ¬ç‰¹å¾</strong>ï¼Œä»è€Œå½¢æˆæ›´â€œimage-awareâ€çš„ text embeddingã€‚</p>
<h3 id="1-å‡½æ•°ç­¾åï¼šæŠŠ-Dual-ç‰ˆæœ¬éœ€è¦çš„è¶…å‚éƒ½æ”¶è¿›æ¥"><a class="header-anchor" href="#1-å‡½æ•°ç­¾åï¼šæŠŠ-Dual-ç‰ˆæœ¬éœ€è¦çš„è¶…å‚éƒ½æ”¶è¿›æ¥">ğŸ”—</a>1) å‡½æ•°ç­¾åï¼šæŠŠ Dual ç‰ˆæœ¬éœ€è¦çš„è¶…å‚éƒ½æ”¶è¿›æ¥</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MODELS.register_module()</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YOLOWorldDualPAFPN</span>(<span class="title class_ inherited__">YOLOWorldPAFPN</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Path Aggregation Network used in YOLO World v8.&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>è§£æ</strong>ï¼šè¯¥ç±»ç»§æ‰¿è‡ª <code>YOLOWorldPAFPN</code>ã€‚è¿™æ„å‘³ç€å®ƒç»§æ‰¿äº†æ„å»º Top-down å’Œ Bottom-up å±‚çš„åŸºæœ¬èƒ½åŠ›ï¼Œä½†ä¼šé€šè¿‡é¢å¤–çš„ç»„ä»¶æ¥å¢å¼ºäº¤äº’é€»è¾‘ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,</span></span><br><span class="line"><span class="params">             in_channels: <span class="type">List</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             out_channels: <span class="type">Union</span>[<span class="type">List</span>[<span class="built_in">int</span>], <span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             guide_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">             embed_channels: <span class="type">List</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             num_heads: <span class="type">List</span>[<span class="built_in">int</span>],</span></span><br><span class="line"><span class="params">             deepen_factor: <span class="built_in">float</span> = <span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">             widen_factor: <span class="built_in">float</span> = <span class="number">1.0</span>,</span></span><br><span class="line"><span class="params">             num_csp_blocks: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">             freeze_all: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">             text_enhancder: ConfigType = <span class="built_in">dict</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="params">                 <span class="built_in">type</span>=<span class="string">&#x27;ImagePoolingAttentionModule&#x27;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                 embed_channels=<span class="number">256</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                 num_heads=<span class="number">8</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                 pool_size=<span class="number">3</span></span>),</span></span><br><span class="line"><span class="params">             block_cfg: ConfigType = <span class="built_in">dict</span>(<span class="params"><span class="built_in">type</span>=<span class="string">&#x27;CSPLayerWithTwoConv&#x27;</span></span>),</span></span><br><span class="line"><span class="params">             norm_cfg: ConfigType = <span class="built_in">dict</span>(<span class="params"><span class="built_in">type</span>=<span class="string">&#x27;BN&#x27;</span>, momentum=<span class="number">0.03</span>, eps=<span class="number">0.001</span></span>),</span></span><br><span class="line"><span class="params">             act_cfg: ConfigType = <span class="built_in">dict</span>(<span class="params"><span class="built_in">type</span>=<span class="string">&#x27;SiLU&#x27;</span>, inplace=<span class="literal">True</span></span>),</span></span><br><span class="line"><span class="params">             init_cfg: OptMultiConfig = <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br></pre></td></tr></table></figure>
<p>é€ä¸ªå‚æ•°è®²æ¸…æ¥šï¼š</p>
<ul>
<li>
<p><code>in_channels: List[int]</code></p>
<p>backbone è¾“å‡ºç»™ neck çš„å¤šå°ºåº¦é€šé“æ•°åˆ—è¡¨ï¼Œä¾‹å¦‚ <code>[C3, C4, C5]</code> çš„é€šé“ã€‚</p>
</li>
<li>
<p><code>out_channels: Union[List[int], int]</code></p>
<p>neck æœŸæœ›è¾“å‡ºçš„é€šé“é…ç½®ã€‚å…è®¸ä½ ä¼ ä¸€ä¸ª <code>int</code>ï¼ˆå†…éƒ¨å¯èƒ½ä¼š broadcast æˆ listï¼‰ï¼Œæˆ–è€…ç›´æ¥ä¼  listï¼ˆå¦‚ <code>[256, 512, 1024]</code> ä¹‹ç±»ï¼‰ã€‚<strong>æ³¨æ„ï¼šè¿™ä»½ Dual ä»£ç åé¢æŠŠå®ƒå½“ list ç”¨</strong>ï¼ˆä¼š <code>for x in out_channels</code>ï¼‰ï¼Œæ‰€ä»¥é€šå¸¸ä½ çš„é…ç½®é‡Œåº”è¯¥æœ€ç»ˆæ˜¯ listï¼ˆæˆ–çˆ¶ç±»ä¼šæŠŠ int è½¬ listï¼‰ã€‚</p>
</li>
<li>
<p><code>guide_channels: int</code></p>
<p>æ–‡æœ¬ç‰¹å¾ <code>txt_feats</code> çš„é€šé“ç»´ï¼ˆDï¼‰ã€‚ä¹Ÿå°±æ˜¯ä½ å‰é¢åœ¨ <code>top_down_layers/bottom_up_layers</code> é‡Œä¼ è¿›å»çš„ <code>txt_feats(BÃ—LÃ—D)</code> çš„ <code>D</code>ã€‚</p>
</li>
<li>
<p><code>embed_channels: List[int]</code>, <code>num_heads: List[int]</code></p>
<p>ç»™æ¯ä¸ªå°ºåº¦ç”¨çš„ attention/embedding é…ç½®ï¼ˆå’Œä½ å‰é¢åœ¨ <code>build_top_down_layer / build_bottom_up_layer</code> é‡Œçœ‹åˆ°çš„ä¸€æ ·ï¼Œä¼šæŒ‰ idx å–ä¸åŒå€¼ï¼‰ã€‚</p>
</li>
<li>
<p><code>deepen_factor / widen_factor / num_csp_blocks</code></p>
<p>YOLO ç³»åˆ—å¸¸è§çš„å®½æ·±ç¼©æ”¾å› å­ï¼ˆæ§åˆ¶ block å †å æ•°ã€é€šé“å®½åº¦ç­‰ï¼‰ã€‚</p>
</li>
<li>
<p><code>freeze_all: bool</code></p>
<p>æ˜¯å¦å†»ç»“è¯¥ neck çš„å‚æ•°ï¼ˆç”±çˆ¶ç±»å®ç°å…·ä½“å†»ç»“é€»è¾‘ï¼‰ã€‚</p>
</li>
<li>
<p><code>text_enhancder: ConfigType = dict(...)</code>  â† Dual ç‰ˆæœ¬æ–°å¢çš„é‡ç‚¹</p>
<p>è¿™æ˜¯ä¸€ä¸ª <strong>â€œæ–‡æœ¬å¢å¼ºæ¨¡å—â€çš„é…ç½®å­—å…¸</strong>ï¼Œé»˜è®¤ç±»å‹æ˜¯ <code>ImagePoolingAttentionModule</code>ï¼Œå¹¶å¸¦é»˜è®¤è¶…å‚ï¼š</p>
<ul>
<li>
<p><code>embed_channels=256</code></p>
</li>
<li>
<p><code>num_heads=8</code></p>
</li>
<li>
<p><code>pool_size=3</code>ï¼ˆå¾ˆåƒ paper é‡Œ I-Pooling Attention çš„ 3Ã—3 pooling è®¾è®¡ï¼‰</p>
</li>
</ul>
</li>
<li>
<p><code>block_cfg / norm_cfg / act_cfg / init_cfg</code></p>
<p>è¿™äº›æ˜¯ neck å†…éƒ¨ CSP èåˆå—ã€BNã€æ¿€æ´»å‡½æ•°ã€åˆå§‹åŒ–é…ç½®ã€‚</p>
</li>
</ul>
<hr>
<h3 id="2-super-init-ï¼šå…ˆæŠŠâ€œåŸºç¡€-YOLOWorldPAFPNâ€å®Œæ•´æ­å‡ºæ¥"><a class="header-anchor" href="#2-super-init-ï¼šå…ˆæŠŠâ€œåŸºç¡€-YOLOWorldPAFPNâ€å®Œæ•´æ­å‡ºæ¥">ğŸ”—</a>2) <code>super().__init__(...)</code>ï¼šå…ˆæŠŠâ€œåŸºç¡€ YOLOWorldPAFPNâ€å®Œæ•´æ­å‡ºæ¥</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">super</span>().__init__(in_channels=in_channels,</span><br><span class="line">                 out_channels=out_channels,</span><br><span class="line">                 guide_channels=guide_channels,</span><br><span class="line">                 embed_channels=embed_channels,</span><br><span class="line">                 num_heads=num_heads,</span><br><span class="line">                 deepen_factor=deepen_factor,</span><br><span class="line">                 widen_factor=widen_factor,</span><br><span class="line">                 num_csp_blocks=num_csp_blocks,</span><br><span class="line">                 freeze_all=freeze_all,</span><br><span class="line">                 block_cfg=block_cfg,</span><br><span class="line">                 norm_cfg=norm_cfg,</span><br><span class="line">                 act_cfg=act_cfg,</span><br><span class="line">                 init_cfg=init_cfg)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ­¥åšçš„æ˜¯ï¼š<strong>å®Œå…¨å¤ç”¨ YOLOWorldPAFPN çš„é‚£å¥—ç»“æ„</strong>ï¼Œä¹Ÿå°±æ˜¯ä½ åˆšåˆšåˆ†æè¿‡çš„ forward é‡Œä¼šç”¨åˆ°çš„ï¼š</p>
<ul>
<li>
<p><code>reduce_layers</code></p>
</li>
<li>
<p><code>upsample_layers</code> + <code>top_down_layers(â€¦, txt_feats)</code></p>
</li>
<li>
<p><code>downsample_layers</code> + <code>bottom_up_layers(â€¦, txt_feats)</code></p>
</li>
<li>
<p><code>out_layers</code></p>
</li>
</ul>
<p>å¹¶ä¸”æŠŠï¼š</p>
<ul>
<li>
<p>æ–‡æœ¬å¼•å¯¼ç»´åº¦ï¼ˆ<code>guide_channels</code>ï¼‰</p>
</li>
<li>
<p>å¤šå°ºåº¦ embedding/head/blocks çš„é…ç½®ï¼ˆ<code>embed_channels/num_heads/num_csp_blocks</code>ï¼‰</p>
</li>
<li>
<p>å®½æ·±ç¼©æ”¾ï¼ˆ<code>widen_factor/deepen_factor</code>ï¼‰</p>
</li>
<li>
<p>å½’ä¸€åŒ–/æ¿€æ´»é…ç½®ï¼ˆ<code>norm_cfg/act_cfg</code>ï¼‰</p>
<p>éƒ½äº¤ç»™çˆ¶ç±»å»åˆå§‹åŒ–å¥½ã€‚</p>
</li>
</ul>
<blockquote>
<p>æ¢å¥è¯è¯´ï¼šDual ç‰ˆæœ¬ <strong>ä¸æ˜¯æ›¿æ¢ PAFPN ä¸»å¹²</strong>ï¼Œè€Œæ˜¯åœ¨â€œå·²æœ‰çš„å›¾åƒ-æ–‡æœ¬èåˆ PAFPNâ€åŸºç¡€ä¸Š<strong>é¢å¤–åŠ ä¸€æ¡â€œå›¾åƒâ†’æ–‡æœ¬â€çš„å¢å¼ºæ”¯è·¯</strong>ã€‚</p>
</blockquote>
<hr>
<h3 id="3-text-enhancder-update-ï¼šæŠŠè¿è¡Œæ—¶å¿…è¦çš„ç»´åº¦ä¿¡æ¯è¡¥è¿›é…ç½®"><a class="header-anchor" href="#3-text-enhancder-update-ï¼šæŠŠè¿è¡Œæ—¶å¿…è¦çš„ç»´åº¦ä¿¡æ¯è¡¥è¿›é…ç½®">ğŸ”—</a>3) <code>text_enhancder.update(...)</code>ï¼šæŠŠè¿è¡Œæ—¶å¿…è¦çš„ç»´åº¦ä¿¡æ¯è¡¥è¿›é…ç½®</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">text_enhancder.update(</span><br><span class="line">    <span class="built_in">dict</span>(</span><br><span class="line">        image_channels=[<span class="built_in">int</span>(x * widen_factor) <span class="keyword">for</span> x <span class="keyword">in</span> out_channels],</span><br><span class="line">        text_channels=guide_channels,</span><br><span class="line">        num_feats=<span class="built_in">len</span>(out_channels),</span><br><span class="line">    ))</span><br></pre></td></tr></table></figure>
<p>è¿™å‡ è¡Œéå¸¸å…³é”®ï¼šé»˜è®¤çš„ <code>text_enhancder</code> åªå†™äº†æ¨¡å—ç±»å‹å’Œä¸€äº›å†…éƒ¨è¶…å‚ï¼Œä½†å®ƒè¿˜ç¼ºå°‘â€œå®ƒåˆ°åº•è¦åƒå“ªäº›å°ºåº¦çš„å›¾åƒç‰¹å¾ã€å›¾åƒé€šé“æ˜¯å¤šå°‘ã€æ–‡æœ¬é€šé“æ˜¯å¤šå°‘â€ç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™é‡Œè¡¥é½ï¼š</p>
<ul>
<li>
<h4 id="update-æ–¹æ³•ï¼š"><a class="header-anchor" href="#update-æ–¹æ³•ï¼š">ğŸ”—</a><code>update()</code> æ–¹æ³•ï¼š</h4>
<ul>
<li><strong><code>text_enhancer</code></strong> æ˜¯ä¸€ä¸ªé…ç½®å­—å…¸ï¼ˆ<code>ConfigType</code>ï¼‰ï¼Œç”¨äºå­˜å‚¨æ–‡æœ¬å¢å¼ºæ¨¡å—çš„é…ç½®ä¿¡æ¯ã€‚<code>update()</code> æ–¹æ³•ä¼šå°†ä¼ å…¥çš„å­—å…¸æ›´æ–°åˆ° <code>text_enhancer</code> ä¸­ã€‚</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><code>image_channels=[int(x * widen_factor) for x in out_channels]</code></p>
<p>ç”Ÿæˆä¸€ä¸ª listï¼Œè¡¨ç¤ºæ¯ä¸ªå°ºåº¦å›¾åƒç‰¹å¾çš„é€šé“æ•°ã€‚</p>
<ul>
<li>
<p>è¿™ä¸€è¡Œè¡¨ç¤ºï¼šå¯¹äºæ¯ä¸ªè¾“å‡ºé€šé“æ•°ï¼ˆ<code>out_channels</code>ï¼‰ï¼Œå®ƒä¼šä¹˜ä»¥ <code>widen_factor</code> æ¥è°ƒæ•´é€šé“æ•°çš„å¤§å°ã€‚è¿™ä¸ªæ“ä½œé€šå¸¸ç”¨äºæ ¹æ®éœ€è¦ç¼©æ”¾ç½‘ç»œçš„å®½åº¦ã€‚</p>
</li>
<li>
<p>ä¾‹å¦‚ï¼Œå‡è®¾ <code>out_channels = [256, 512, 1024]</code>ï¼Œ<code>widen_factor = 1.5</code>ï¼Œé‚£ä¹ˆ <code>image_channels</code> å°†ä¼šå˜æˆ <code>[384, 768, 1536]</code>ã€‚</p>
</li>
</ul>
<ul>
<li>æ³¨æ„å®ƒç”¨çš„æ˜¯ <code>out_channels</code> è€Œä¸æ˜¯ <code>in_channels</code>ï¼šè¯´æ˜ <code>text_enhancer</code> é¢„æœŸåƒçš„æ˜¯ <strong>neck è¿‡ç¨‹ä¸­å¯¹é½åçš„å¤šå°ºåº¦ç‰¹å¾é€šé“</strong>ï¼ˆä¸ neck è¾“å‡ºå°ºåº¦ä¸€è‡´çš„é€šé“å£å¾„ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p>â€‹</p>
<ul>
<li>
<p><code>text_channels=guide_channels</code></p>
<p><code>guide_channels</code> æ˜¯ <strong>æ–‡æœ¬ç‰¹å¾çš„é€šé“æ•°</strong>ã€‚å®ƒå†³å®šäº†æ–‡æœ¬ç‰¹å¾åœ¨åç»­æ¨¡å‹ä¸­çš„ç»´åº¦ã€‚å‡è®¾ <code>guide_channels = 128</code>ï¼Œé‚£ä¹ˆæ–‡æœ¬ç‰¹å¾çš„é€šé“æ•°å°±æ˜¯ <code>128</code>ã€‚</p>
</li>
<li>
<p><code>num_feats=len(out_channels)</code></p>
<p>è¿™ä¸€è¡ŒæŒ‡å®šäº†<strong>ç‰¹å¾çš„æ•°é‡</strong>ï¼Œå³è¾“å‡ºç‰¹å¾å›¾çš„å±‚æ•°ã€‚å‡è®¾ <code>out_channels = [256, 512, 1024]</code>ï¼Œé‚£ä¹ˆ <code>num_feats = 3</code>ï¼Œè¡¨ç¤ºæœ‰ 3 ä¸ªè¾“å‡ºç‰¹å¾å±‚ã€‚</p>
</li>
</ul>
<blockquote>
<p>è¿™ä¸€æ­¥æœ¬è´¨ä¸Šæ˜¯åœ¨æŠŠ â€œç»“æ„è¶…å‚ï¼ˆtype/embed_heads/pool_sizeï¼‰â€ å’Œ â€œå½¢çŠ¶ä¿¡æ¯ï¼ˆimage_channels/text_channels/num_featsï¼‰â€ åˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„å¯ build é…ç½®ã€‚</p>
</blockquote>
<hr>
<h3 id="4-print-text-enhancder-ï¼šè°ƒè¯•è¾“å‡ºï¼ˆè®­ç»ƒ-æ„å»ºæ—¶ä¼šæ‰“å°ï¼‰"><a class="header-anchor" href="#4-print-text-enhancder-ï¼šè°ƒè¯•è¾“å‡ºï¼ˆè®­ç»ƒ-æ„å»ºæ—¶ä¼šæ‰“å°ï¼‰">ğŸ”—</a>4) <code>print(text_enhancder)</code>ï¼šè°ƒè¯•è¾“å‡ºï¼ˆè®­ç»ƒ/æ„å»ºæ—¶ä¼šæ‰“å°ï¼‰</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(text_enhancder)</span><br></pre></td></tr></table></figure>
<p>è¿™è¡Œæ²¡æœ‰åŠŸèƒ½æ€§å½±å“ï¼Œçº¯ç²¹æ˜¯ä½œè€…ç”¨æ¥ç¡®è®¤æœ€ç»ˆé…ç½®å­—å…¸é•¿ä»€ä¹ˆæ ·ï¼ˆä½ è·‘èµ·æ¥ä¼šåœ¨æ—¥å¿—é‡Œçœ‹åˆ°ï¼‰ã€‚</p>
<hr>
<h3 id="5-self-text-enhancer-MODELS-build-text-enhancder-ï¼šç”¨æ³¨å†Œè¡¨æŠŠæ¨¡å—å®ä¾‹åŒ–å‡ºæ¥"><a class="header-anchor" href="#5-self-text-enhancer-MODELS-build-text-enhancder-ï¼šç”¨æ³¨å†Œè¡¨æŠŠæ¨¡å—å®ä¾‹åŒ–å‡ºæ¥">ğŸ”—</a>5) <code>self.text_enhancer = MODELS.build(text_enhancder)</code>ï¼šç”¨æ³¨å†Œè¡¨æŠŠæ¨¡å—å®ä¾‹åŒ–å‡ºæ¥</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">self</span>.text_enhancer = MODELS.build(text_enhancder)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>MODELS.build(...)</code> æ˜¯ MMEngine/OpenMMLab çš„æ³¨å†Œè¡¨æ„å»ºæ–¹å¼ï¼šæ ¹æ® <code>text_enhancder['type']</code> æ‰¾åˆ°å¯¹åº”ç±»ï¼ˆè¿™é‡Œé»˜è®¤ <code>ImagePoolingAttentionModule</code>ï¼‰ï¼Œå¹¶æŠŠåˆšåˆš update çš„å‚æ•°ä¸€èµ·ä¼ è¿›å»æ„é€ ã€‚</p>
</li>
<li>
<p>æœ€ç»ˆå¾—åˆ° <code>self.text_enhancer</code>ï¼šDual ç‰ˆæœ¬æ–°å¢çš„æ¨¡å—å®ä¾‹ã€‚</p>
</li>
</ul>
<blockquote>
<p>ä½ åé¢çœ‹ <code>YOLOWorldDualPAFPN.forward</code> æ—¶ï¼Œå¤§æ¦‚ç‡ä¼šå‘ç°ï¼šå®ƒä¼šå…ˆç”¨è¿™ä¸ª <code>text_enhancer</code> æŠŠ <code>txt_feats</code> åšä¸€æ¬¡â€œå›¾åƒæ¡ä»¶åŒ–â€ï¼Œå†é€è¿› <code>top_down_layers/bottom_up_layers</code> å»åšâ€œæ–‡æœ¬å¼•å¯¼å›¾åƒâ€çš„èåˆï¼›ä»è€Œæ„æˆä¸€ç§æ›´â€œå¯¹ç§°â€çš„åŒå‘äº¤äº’ï¼ˆIâ†’T å† Tâ†’Iï¼‰ã€‚</p>
</blockquote>
<hr>
<h2 id="def-forward-2"><a class="header-anchor" href="#def-forward-2">ğŸ”—</a>def forward</h2>
<p>ç›¸å¯¹ <code>YOLOWorldPAFPN</code>ï¼Œ<strong>å”¯ä¸€å…³é”®æ–°å¢ç‚¹</strong>æ˜¯åœ¨ top-down å®Œæˆåæ’å…¥äº†ä¸€å¥ <code>txt_feats = self.text_enhancer(txt_feats, inner_outs)</code>ï¼šç”¨å¤šå°ºåº¦å›¾åƒç‰¹å¾å»â€œå¢å¼º/æ›´æ–°â€æ–‡æœ¬ç‰¹å¾ï¼Œç„¶åå†è¿›å…¥ bottom-upï¼‰ã€‚</p>
<h3 id="å‡½æ•°å…¥å£ä¸åŸºæœ¬æ£€æŸ¥"><a class="header-anchor" href="#å‡½æ•°å…¥å£ä¸åŸºæœ¬æ£€æŸ¥">ğŸ”—</a>å‡½æ•°å…¥å£ä¸åŸºæœ¬æ£€æŸ¥</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, img_feats: <span class="type">List</span>[Tensor], txt_feats: Tensor</span>) -&gt; <span class="built_in">tuple</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Forward function.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(img_feats) == <span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>img_feats</code>ï¼šbackbone å¤šå°ºåº¦å›¾åƒç‰¹å¾åˆ—è¡¨ï¼ˆä¾‹å¦‚ 3 ä¸ªå°ºåº¦ï¼‰ã€‚</p>
</li>
<li>
<p><code>txt_feats</code>ï¼šæ–‡æœ¬ç‰¹å¾ï¼ˆè¿™é‡Œ Dual ç‰ˆæœ¬ä¸è®¾é»˜è®¤ <code>None</code>ï¼Œè°ƒç”¨æ–¹åº”ä¿è¯ä¼ å…¥ï¼‰ã€‚</p>
</li>
<li>
<p><code>assert</code>ï¼šç¡®ä¿å°ºåº¦æ•°å¯¹é½ neck çš„ <code>in_channels</code> é…ç½®ã€‚</p>
</li>
</ul>
<hr>
<h3 id="é€šé“ç¼©å‡ï¼ˆReduce-Layersï¼‰"><a class="header-anchor" href="#é€šé“ç¼©å‡ï¼ˆReduce-Layersï¼‰">ğŸ”—</a>é€šé“ç¼©å‡ï¼ˆReduce Layersï¼‰</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reduce layers</span></span><br><span class="line">reduce_outs = []</span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels)):</span><br><span class="line">    reduce_outs.append(<span class="variable language_">self</span>.reduce_layers[idx](img_feats[idx]))</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>self.reduce_layers[idx]</code> é€šå¸¸æ˜¯ 1Ã—1 convï¼ˆæˆ–ç±»ä¼¼ï¼‰ï¼ŒæŠŠæ¯ä¸ªå°ºåº¦çš„ <code>img_feats[idx]</code> å˜æˆ neck å†…éƒ¨æœŸæœ›çš„é€šé“æ•°ã€‚</p>
</li>
<li>
<p>è¾“å‡º <code>reduce_outs</code>ï¼šä¾æ—§æ˜¯å¤šå°ºåº¦ listï¼Œä½†é€šé“å·²ç»Ÿä¸€åˆ° neck è®¾å®šã€‚</p>
</li>
</ul>
<hr>
<h3 id="è‡ªé¡¶å‘ä¸‹è·¯å¾„ï¼ˆTop-down-Pathï¼‰â€”â€”-æ–‡æœ¬å¼•å¯¼å›¾åƒ"><a class="header-anchor" href="#è‡ªé¡¶å‘ä¸‹è·¯å¾„ï¼ˆTop-down-Pathï¼‰â€”â€”-æ–‡æœ¬å¼•å¯¼å›¾åƒ">ğŸ”—</a>è‡ªé¡¶å‘ä¸‹è·¯å¾„ï¼ˆTop-down Pathï¼‰â€”â€” æ–‡æœ¬å¼•å¯¼å›¾åƒ</h3>
<p><span style="color:#FF0000">è¿™æ˜¯ <strong>Text-to-Image</strong> çš„ç¬¬ä¸€æ¬¡äº¤äº’ã€‚</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># top-down path</span></span><br><span class="line">inner_outs = [reduce_outs[-<span class="number">1</span>]]</span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">    feat_high = inner_outs[<span class="number">0</span>]</span><br><span class="line">    feat_low = reduce_outs[idx - <span class="number">1</span>]</span><br><span class="line">    upsample_feat = <span class="variable language_">self</span>.upsample_layers[<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels) - <span class="number">1</span> - idx](feat_high)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>inner_outs</code> å…ˆä»æœ€æ·±å±‚ï¼ˆæœ€ä½åˆ†è¾¨ç‡ã€æœ€é«˜è¯­ä¹‰ï¼‰å¼€å§‹ï¼š<code>reduce_outs[-1]</code>ã€‚</p>
</li>
<li>
<p>å¾ªç¯ä»é«˜å±‚èµ°å‘ä½å±‚ï¼ˆä¾‹å¦‚ idx=2â†’1ï¼‰ï¼Œæ¯æ¬¡ï¼š</p>
<ul>
<li>
<p><code>feat_high</code>ï¼šå½“å‰é«˜è¯­ä¹‰ç‰¹å¾ï¼ˆä¼šè¢«ä¸Šé‡‡æ ·ï¼‰</p>
</li>
<li>
<p><code>feat_low</code>ï¼šå¯¹åº”çš„æ›´é«˜åˆ†è¾¨ç‡ç‰¹å¾ï¼ˆæ¨ªå‘è¿æ¥ï¼‰</p>
</li>
<li>
<p><code>upsample_feat</code>ï¼šæŠŠ <code>feat_high</code> ä¸Šé‡‡æ ·åˆ°ä¸ <code>feat_low</code> åŒç©ºé—´å°ºå¯¸</p>
</li>
</ul>
</li>
</ul>
<p>æ¥ä¸‹æ¥å†³å®š concat çš„é€šé“æ‹¼æ¥é¡ºåºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="variable language_">self</span>.upsample_feats_cat_first:</span><br><span class="line">    top_down_layer_inputs = torch.cat([upsample_feat, feat_low], <span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    top_down_layer_inputs = torch.cat([feat_low, upsample_feat], <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>torch.cat(..., 1)</code>ï¼šæ²¿ channel ç»´æ‹¼æ¥ã€‚</p>
</li>
<li>
<p><code>upsample_feats_cat_first</code> æ˜¯ä¸€ä¸ªå…¼å®¹æ€§/æƒé‡å¯¹é½ç”¨çš„å¼€å…³ï¼šæ§åˆ¶æ‹¼æ¥æ—¶ä¸¤è·¯ç‰¹å¾è°åœ¨å‰ã€‚</p>
</li>
</ul>
<p>ç„¶åè¿‡ top-down èåˆå—ï¼ˆæ³¨æ„è¿™é‡ŒæŠŠ <code>txt_feats</code> ä¼ è¿›å»äº†ï¼‰<span style="color:#FF0000">ã€ç”¨æ–‡æœ¬å¢å¼ºå›¾åƒç‰¹å¾ã€‘</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">inner_out = <span class="variable language_">self</span>.top_down_layers[<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels) - <span class="number">1</span> - idx](</span><br><span class="line">    top_down_layer_inputs, txt_feats)</span><br><span class="line">inner_outs.insert(<span class="number">0</span>, inner_out)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>self.top_down_layers[...]</code>  æ–‡æœ¬å¼•å¯¼èåˆï¼šå°†æ‹¼æ¥ç‰¹å¾é€å…¥ Top-down CSP å— ï¼›<code>txt_feats</code> åœ¨è¿™é‡Œä½œä¸ºâ€œå¼•å¯¼ä¿¡å·â€ä¼ å…¥ï¼Œæ§åˆ¶å·ç§¯å—å…³æ³¨å“ªäº›è§†è§‰åŒºåŸŸ</p>
</li>
<li>
<p><code>insert(0, ...)</code>ï¼šæŠŠæ–°å¾—åˆ°çš„æ›´é«˜åˆ†è¾¨ç‡è¾“å‡ºæ’åˆ°æœ€å‰é¢ï¼Œä¿è¯ <code>inner_outs</code> é¡ºåºä»é«˜åˆ†è¾¨ç‡åˆ°ä½åˆ†è¾¨ç‡æ’åˆ—ã€‚</p>
</li>
</ul>
<blockquote>
<p>èµ°å®Œè¿™æ®µå¾ªç¯åï¼Œ<code>inner_outs</code> å°±æ˜¯ä¸€å¥—å®Œæˆ top-down èåˆåçš„å¤šå°ºåº¦ç‰¹å¾ã€‚</p>
</blockquote>
<hr>
<h3 id="Dual-çš„æ ¸å¿ƒæ–°å¢-span-style-color-FF0000-å›¾åƒå¼•å¯¼æ–‡æœ¬-span"><a class="header-anchor" href="#Dual-çš„æ ¸å¿ƒæ–°å¢-span-style-color-FF0000-å›¾åƒå¼•å¯¼æ–‡æœ¬-span">ğŸ”—</a>Dual çš„æ ¸å¿ƒæ–°å¢--<span style="color:#FF0000">å›¾åƒå¼•å¯¼æ–‡æœ¬</span></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">txt_feats = <span class="variable language_">self</span>.text_enhancer(txt_feats, inner_outs)</span><br></pre></td></tr></table></figure>
<p>è¿™å¥æ˜¯ <strong>YOLOWorldDualPAFPN ç›¸å¯¹ YOLOWorldPAFPN çš„å…³é”®å·®å¼‚</strong>ï¼š</p>
<ul>
<li>
<p><code>self.text_enhancer</code> åœ¨ <code>__init__</code> é‡Œé€šè¿‡ <code>MODELS.build(text_enhancder)</code> æ„å»ºï¼Œé»˜è®¤ <code>type='ImagePoolingAttentionModule'</code>ï¼Œå¹¶å¸¦ <code>pool_size=3</code> ç­‰è¶…å‚ã€‚</p>
</li>
<li>
<p>è°ƒç”¨å½¢æ€ï¼š<code>text_enhancer(txt_feats, inner_outs)</code></p>
<ul>
<li>
<p><code>txt_feats</code>ï¼šåŸå§‹æ–‡æœ¬ token embeddingï¼ˆBÃ—LÃ—Dï¼‰</p>
</li>
<li>
<p><code>inner_outs</code>ï¼štop-down å¾—åˆ°çš„å¤šå°ºåº¦å›¾åƒç‰¹å¾ list</p>
</li>
</ul>
</li>
<li>
<p>è¾“å‡ºï¼šæ›´æ–°åçš„ <code>txt_feats</code>ï¼ˆä»ç„¶æ˜¯ BÃ—LÃ—D è¿™ç§â€œæ–‡æœ¬ token åºåˆ—â€å½¢çŠ¶ï¼Œä½†è¢«æ³¨å…¥äº†å›¾åƒæ¡ä»¶ä¿¡æ¯ï¼Œå˜æˆæ›´ image-aware çš„æ–‡æœ¬ç‰¹å¾ï¼‰</p>
</li>
</ul>
<p>ç›´è§‚ç†è§£ï¼š</p>
<p><strong>å…ˆåšä¸€æ¬¡â€œæ–‡æœ¬å¼•å¯¼å›¾åƒâ€çš„ top-downï¼ˆTâ†’Iï¼‰ï¼Œå†åšä¸€æ¬¡â€œå›¾åƒåå“ºæ–‡æœ¬â€çš„å¢å¼ºï¼ˆIâ†’Tï¼‰ï¼Œç„¶åå†ç”¨æ›´æ–°åçš„æ–‡æœ¬ç»§ç»­å¼•å¯¼ bottom-upï¼ˆå† Tâ†’Iï¼‰ã€‚</strong></p>
<hr>
<h3 id="è‡ªåº•å‘ä¸Šè·¯å¾„ï¼ˆBottom-up-Pathï¼‰â€”â€”-å¢å¼ºæ–‡æœ¬å†æ¬¡å¼•å¯¼å›¾åƒ"><a class="header-anchor" href="#è‡ªåº•å‘ä¸Šè·¯å¾„ï¼ˆBottom-up-Pathï¼‰â€”â€”-å¢å¼ºæ–‡æœ¬å†æ¬¡å¼•å¯¼å›¾åƒ">ğŸ”—</a>è‡ªåº•å‘ä¸Šè·¯å¾„ï¼ˆBottom-up Pathï¼‰â€”â€” å¢å¼ºæ–‡æœ¬å†æ¬¡å¼•å¯¼å›¾åƒ</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bottom-up path</span></span><br><span class="line">outs = [inner_outs[<span class="number">0</span>]]</span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels) - <span class="number">1</span>):</span><br><span class="line">    feat_low = outs[-<span class="number">1</span>]</span><br><span class="line">    feat_high = inner_outs[idx + <span class="number">1</span>]</span><br><span class="line">    downsample_feat = <span class="variable language_">self</span>.downsample_layers[idx](feat_low)</span><br><span class="line">    out = <span class="variable language_">self</span>.bottom_up_layers[idx](torch.cat(</span><br><span class="line">        [downsample_feat, feat_high], <span class="number">1</span>), txt_feats)</span><br><span class="line">    outs.append(out)</span><br></pre></td></tr></table></figure>
<p>é€è¡Œè¦ç‚¹ï¼š</p>
<ul>
<li>
<p><code>outs</code> ä»æœ€é«˜åˆ†è¾¨ç‡é‚£å±‚å¼€å§‹ï¼ˆ<code>inner_outs[0]</code>ï¼‰ã€‚</p>
</li>
<li>
<p>æ¯æ¬¡å¾ªç¯ï¼š</p>
<ul>
<li>
<p><code>feat_low</code>ï¼šå½“å‰é«˜åˆ†è¾¨ç‡è¾“å‡º</p>
</li>
<li>
<p><code>downsample_feat</code>ï¼šæŠŠ <code>feat_low</code> ä¸‹é‡‡æ ·åˆ°ä¸‹ä¸€å±‚åˆ†è¾¨ç‡</p>
</li>
<li>
<p><code>feat_high</code>ï¼štop-down é‡Œå¯¹åº”çš„ä¸‹ä¸€å±‚ç‰¹å¾ï¼ˆä½œä¸º concat çš„å¦ä¸€æ”¯ï¼‰</p>
</li>
<li>
<p>æ‹¼æ¥åå–‚ç»™ <code>bottom_up_layers[idx](..., txt_feats)</code></p>
<p><span style="color:#FF0000">$ \bigstar \bigstar \bigstar$</span>æ­¤æ—¶çš„ <code>txt_feats</code> å·²ç»æ˜¯ <strong>è¢« <code>text_enhancer</code> æ›´æ–°è¿‡çš„ç‰ˆæœ¬</strong>ï¼Œæ‰€ä»¥ bottom-up çš„èåˆæ˜¯â€œæ›´å¼ºçš„æ–‡æœ¬å¼•å¯¼â€ã€‚</p>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="Out-layersï¼šè¾“å‡ºæ•´å½¢å¹¶è¿”å›"><a class="header-anchor" href="#Out-layersï¼šè¾“å‡ºæ•´å½¢å¹¶è¿”å›">ğŸ”—</a>Out layersï¼šè¾“å‡ºæ•´å½¢å¹¶è¿”å›</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># out_layers</span></span><br><span class="line">results = []</span><br><span class="line"><span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.in_channels)):</span><br><span class="line">    results.append(<span class="variable language_">self</span>.out_layers[idx](outs[idx]))</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">tuple</span>(results)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>self.out_layers[idx]</code>ï¼šæŠŠæ¯ä¸ªå°ºåº¦çš„ <code>outs[idx]</code> åšæœ€åä¸€æ¬¡é€šé“/å½¢å¼æ•´å½¢ï¼Œä½¿å…¶ç¬¦åˆ detection head çš„è¾“å…¥å£å¾„ã€‚</p>
</li>
<li>
<p>è¿”å› <code>tuple(results)</code>ï¼šå¤šå°ºåº¦ neck è¾“å‡ºã€‚</p>
</li>
</ul>
<hr>
<p>å¦‚æœä½ è¦ç»§ç»­â€œæ›´è½åœ°â€ä¸€ç‚¹ï¼Œæˆ‘å»ºè®®ä¸‹ä¸€æ­¥æŠŠ <code>ImagePoolingAttentionModule</code>ï¼ˆä¹Ÿå°±æ˜¯é»˜è®¤çš„ <code>text_enhancer</code>ï¼‰é‚£æ®µå®ç°æºç è´´å‡ºæ¥/æŒ‡å‡ºå®ƒåœ¨ä½ å·¥ç¨‹é‡Œçš„æ–‡ä»¶ä½ç½®ï¼Œæˆ‘å°±èƒ½æŠŠ <strong>å®ƒåˆ°åº•å¦‚ä½•æŠŠ <code>inner_outs</code> æ± åŒ–æˆ tokenï¼Œå†å¯¹ <code>txt_feats</code> åš attention æ›´æ–°</strong>é€è¡Œæ‹†å¼€è®²ã€‚</p>
<h1 id="æ€»ç»“1"><a class="header-anchor" href="#æ€»ç»“1">ğŸ”—</a>æ€»ç»“1</h1>
<p>åœ¨æ·±å…¥å­¦ä¹  <strong>Head</strong>ï¼ˆæ£€æµ‹å¤´ï¼‰ä¹‹å‰ï¼Œå¯¹ <code>yolo_world_pafpn.py</code> è¿›è¡Œå…¨é¢æ€»ç»“æ˜¯éå¸¸å¿…è¦çš„ã€‚è¿™ä¸ªæ–‡ä»¶å®ç°äº† YOLO-World è®ºæ–‡ä¸­æœ€æ ¸å¿ƒçš„ç»“æ„åˆ›æ–°ï¼š<strong>RepVL-PAN</strong> (Re-parameterizable Vision-Language Path Aggregation Network)ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä»åŠŸèƒ½ã€ä»£ç ç»“æ„ã€é¡¹ç›®åœ°ä½ä»¥åŠè®ºæ–‡å¯¹åº”å…³ç³»å››ä¸ªç»´åº¦çš„æ·±åº¦æ€»ç»“ã€‚</p>
<hr>
<h3 id="1-æ ¸å¿ƒä»»åŠ¡ï¼šRepVL-PAN-çš„å®ç°"><a class="header-anchor" href="#1-æ ¸å¿ƒä»»åŠ¡ï¼šRepVL-PAN-çš„å®ç°">ğŸ”—</a>1. æ ¸å¿ƒä»»åŠ¡ï¼šRepVL-PAN çš„å®ç°</h3>
<p>è¯¥æ–‡ä»¶çš„å”¯ä¸€ç›®æ ‡æ˜¯æ‰“ç ´è§†è§‰å’Œè¯­è¨€çš„ç•Œé™ã€‚ä¼ ç»Ÿçš„ YOLO Neckï¼ˆå¦‚ PAFPNï¼‰åªè´Ÿè´£å›¾åƒç‰¹å¾çš„å°ºåº¦èåˆï¼Œè€Œè¿™é‡Œçš„ <strong>RepVL-PAN</strong> å°† <strong>Text Embedding</strong> æ³¨å…¥åˆ°ç‰¹å¾èåˆçš„è¿‡ç¨‹ä¸­ï¼Œä½¿å¾—è¾“å‡ºçš„ç‰¹å¾å›¾ä¸å†æ˜¯çº¯ç²¹çš„è§†è§‰åƒç´ èšåˆï¼Œè€Œæ˜¯åŒ…å«äº†è¯­ä¹‰ä¿¡æ¯çš„â€œå¤šæ¨¡æ€ç‰¹å¾â€ã€‚</p>
<h3 id="2-ç±»å…³ç³»ä¸åŒºåˆ«ï¼šä»å•å‘åˆ°åŒå‘"><a class="header-anchor" href="#2-ç±»å…³ç³»ä¸åŒºåˆ«ï¼šä»å•å‘åˆ°åŒå‘">ğŸ”—</a>2. ç±»å…³ç³»ä¸åŒºåˆ«ï¼šä»å•å‘åˆ°åŒå‘</h3>
<p>æ–‡ä»¶å®šä¹‰äº†ä¸¤ä¸ªä¸»è¦çš„ç±»ï¼Œå®ƒä»¬æ„æˆäº†ä»åŸºç¡€åˆ°å®Œå…¨ä½“çš„æ¼”è¿›ï¼š</p>
<p>| ç‰¹æ€§         | <code>YOLOWorldPAFPN</code> (åŸºç¡€ç‰ˆ)                    | <code>YOLOWorldDualPAFPN</code> (å®Œå…¨ä½“)              |</p>
<p>| ------------ | -------------------------------------------- | ------------------------------------------ |</p>
<p>| <strong>ç»§æ‰¿å…³ç³»</strong> | ç»§æ‰¿è‡ª <code>YOLOv8PAFPN</code>                         | ç»§æ‰¿è‡ª <code>YOLOWorldPAFPN</code>                    |</p>
<p>| <strong>äº¤äº’é€»è¾‘</strong> | <strong>å•å‘å¼•å¯¼</strong>ï¼šText â†’ Image                   | <strong>åŒå‘å¼•å¯¼</strong>ï¼šText â†” Image                 |</p>
<p>| <strong>æ ¸å¿ƒç»„ä»¶</strong> | å¸¦æœ‰ <code>guide_channels</code> çš„ CSP æ¨¡å—            | CSP æ¨¡å— + <code>text_enhancer</code> (æ–‡æœ¬å¢å¼ºå™¨)    |</p>
<p>| <strong>è®ºæ–‡å¯¹åº”</strong> | RepVL-PAN çš„åŸºæœ¬ç»“æ„                         | å®Œæ•´çš„ RepVL-PANï¼ŒåŒ…å«å›¾åƒæ± åŒ–æ³¨æ„åŠ›       |</p>
<p>| <strong>æ•°æ®æµ</strong>   | æ–‡æœ¬ç‰¹å¾åœ¨ Top-down/Bottom-up ä¸­ä½œä¸ºè¾…åŠ©è¾“å…¥ | åœ¨ Top-down ååˆ©ç”¨å›¾åƒç‰¹å¾åŠ¨æ€æ›´æ–°æ–‡æœ¬ç‰¹å¾ |</p>
<hr>
<h3 id="3-æ¨¡å—é—´çš„å‰åè”ç³»ï¼ˆæ¢çº½åœ°ä½ï¼‰"><a class="header-anchor" href="#3-æ¨¡å—é—´çš„å‰åè”ç³»ï¼ˆæ¢çº½åœ°ä½ï¼‰">ğŸ”—</a>3. æ¨¡å—é—´çš„å‰åè”ç³»ï¼ˆæ¢çº½åœ°ä½ï¼‰</h3>
<p>åœ¨ YOLO-World çš„æ•´ä¸ªå·¥ä½œæµä¸­ï¼ŒPAFPN èµ·åˆ°äº†æ‰¿ä¸Šå¯ä¸‹çš„æ¢çº½ä½œç”¨ï¼š</p>
<ul>
<li>
<p><strong>ä¸Šæ¸¸ (Input)</strong>ï¼š</p>
</li>
<li>
<p>ä» <strong>Backbone</strong> æ¥æ”¶ 3 ä¸ªå°ºåº¦çš„åŸå§‹å›¾åƒç‰¹å¾å›¾ï¼ˆP3, P4, P5ï¼‰ã€‚</p>
</li>
<li>
<p>ä» <strong>Text Encoder</strong> æ¥æ”¶å¤„ç†å¥½çš„æ–‡æœ¬ Embedding (<code>txt_feats</code>)ã€‚</p>
</li>
<li>
<p><strong>ä¸­æ¸¸ (Processing)</strong>ï¼š</p>
</li>
<li>
<p>åœ¨ <code>forward</code> è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å·ç§¯å’Œæ³¨æ„åŠ›æœºåˆ¶ï¼Œå°†æ–‡æœ¬è¯­ä¹‰â€œç‚¹å¯¹ç‚¹â€åœ°èåˆè¿›å›¾åƒç‰¹å¾å›¾ä¸­ã€‚</p>
</li>
<li>
<p><strong>ä¸‹æ¸¸ (Output)</strong>ï¼š</p>
</li>
<li>
<p>è¾“å‡ºèåˆåçš„ 3 å°ºåº¦ç‰¹å¾å›¾ç»™ <strong>Head</strong>ã€‚æ­¤æ—¶çš„ç‰¹å¾å›¾å·²ç»èƒ½å¤ŸåŒºåˆ†â€œå“ªä¸ªåŒºåŸŸæ›´åƒæ–‡æœ¬æè¿°çš„ç‰©ä½“â€äº†ã€‚</p>
</li>
</ul>
<hr>
<h3 id="4-è®ºæ–‡ä¸­çš„ç®—æ³•å¯¹åº”"><a class="header-anchor" href="#4-è®ºæ–‡ä¸­çš„ç®—æ³•å¯¹åº”">ğŸ”—</a>4. è®ºæ–‡ä¸­çš„ç®—æ³•å¯¹åº”</h3>
<p>å¦‚æœä½ å¯¹ç€ YOLO-World çš„è®ºæ–‡çœ‹ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªæ–‡ä»¶ç²¾ç¡®å®ç°äº†ä»¥ä¸‹æ¦‚å¿µï¼š</p>
<ul>
<li>
<p><strong>Text-guided CSPLayers</strong>ï¼šå¯¹åº” <code>build_top_down_layer</code> å’Œ <code>build_bottom_up_layer</code> ä¸­é€šè¿‡ <code>block_cfg</code> å®ä¾‹åŒ–çš„æ¨¡å—ã€‚è¿™äº›æ¨¡å—å†…éƒ¨å®ç°äº†è§†è§‰ç‰¹å¾ä¸æ–‡æœ¬ç‰¹å¾çš„çº¿æ€§äº¤äº’ã€‚</p>
</li>
<li>
<p><strong>Image-Pooling Attention</strong>ï¼šå¯¹åº” <code>YOLOWorldDualPAFPN</code> ä¸­çš„ <code>self.text_enhancer</code>ã€‚è®ºæ–‡æŒ‡å‡ºï¼Œç”±äºæ–‡æœ¬ Embedding é€šå¸¸æ˜¯ç¦»çº¿ç”Ÿæˆçš„ï¼Œç¼ºä¹å¯¹å½“å‰å›¾ç‰‡çš„æ„ŸçŸ¥ï¼Œå› æ­¤éœ€è¦åˆ©ç”¨å›¾åƒç‰¹å¾é€šè¿‡ Max-Pooling å’Œ Attention æ¥å¢å¼ºæ–‡æœ¬çš„åˆ¤åˆ«åŠ›ã€‚</p>
</li>
<li>
<p><strong>Re-parameterization (é‡å‚æ•°åŒ–)</strong>ï¼šè™½ç„¶ä»£ç ä¸­ä½“ç°çš„æ˜¯åŠ¨æ€è®¡ç®—ï¼Œä½†å…¶è®¾è®¡å…è®¸åœ¨æ¨ç†æ—¶å°†æ–‡æœ¬ç‰¹å¾ä¸å·ç§¯å±‚æƒé‡åˆå¹¶ã€‚è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ <code>YOLOWorldDetector</code> ä¸­æœ‰ä¸€ä¸ª <code>reparameterize</code> æ–¹æ³•ã€‚</p>
</li>
</ul>
<hr>
<h3 id="5-æ€»ç»“ï¼šä½ åº”è¯¥æŒæ¡çš„ä¸‰ä¸ªå…³é”®ç‚¹"><a class="header-anchor" href="#5-æ€»ç»“ï¼šä½ åº”è¯¥æŒæ¡çš„ä¸‰ä¸ªå…³é”®ç‚¹">ğŸ”—</a>5. æ€»ç»“ï¼šä½ åº”è¯¥æŒæ¡çš„ä¸‰ä¸ªå…³é”®ç‚¹</h3>
<ol>
<li>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæ–‡ä»¶ï¼Ÿ</strong> å› ä¸ºè¦è®©æ¨¡å‹åœ¨æ£€æµ‹ä¹‹å‰å°±â€œè¯»æ‡‚â€æˆ‘ä»¬è¦æ‰¾çš„æ˜¯ä»€ä¹ˆã€‚</p>
</li>
<li>
<p><strong><code>Dual</code> å¼ºåœ¨å“ªï¼Ÿ</strong> å®ƒä¸ä»…ç”¨æ–‡æœ¬æ‰¾å›¾åƒï¼Œè¿˜ç”¨å›¾åƒä¸­å‘ç°çš„çº¿ç´¢å»ä¿®æ­£æ–‡æœ¬çš„ç†è§£ï¼ˆé€šè¿‡ <code>text_enhancer</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä»£ç çš„å·§å¦™ä¹‹å¤„ï¼š</strong> å®ƒé€šè¿‡ç»§æ‰¿å’Œé…ç½®é©±åŠ¨ (<code>block_cfg</code>)ï¼Œä»…ç”¨å°‘é‡çš„æ”¹åŠ¨å°±å°†æˆç†Ÿçš„ YOLOv8 ç»“æ„å‡çº§ä¸ºäº†å¼€æ”¾è¯æ±‡æ£€æµ‹å™¨ã€‚</p>
</li>
</ol>
<h1 id="æ€»ç»“2"><a class="header-anchor" href="#æ€»ç»“2">ğŸ”—</a>æ€»ç»“2</h1>
<p>ä¸‹é¢ç»™ä½ ä¸€ä»½å¯¹ <strong><code>yolo_world/models/necks/yolo_world_pafpn.py</code></strong> çš„â€œå…¨æ™¯å¼æŒæ¡â€æ€»ç»“ï¼šå®ƒå®ç°äº†ä»€ä¹ˆã€ä¸¤ä¸ª class çš„è”ç³»ä¸åŒºåˆ«ã€åœ¨æ•´ä¸ªé¡¹ç›®ä¸­çš„å‰åå…³ç³»ã€ä»¥åŠå’Œè®ºæ–‡ï¼ˆRepVL-PAN / I-Pooling Attention / Tâ†’I &amp; Iâ†’Tï¼‰ä¹‹é—´çš„å¯¹åº”ã€‚</p>
<hr>
<h2 id="1-è¿™ä»½æ–‡ä»¶æ•´ä½“åœ¨å®ç°ä»€ä¹ˆ"><a class="header-anchor" href="#1-è¿™ä»½æ–‡ä»¶æ•´ä½“åœ¨å®ç°ä»€ä¹ˆ">ğŸ”—</a>1) è¿™ä»½æ–‡ä»¶æ•´ä½“åœ¨å®ç°ä»€ä¹ˆ</h2>
<p><strong>ä¸€å¥è¯ï¼š<strong>å®ƒå®ç° YOLO-World çš„ â€œè§†è§‰-è¯­è¨€ PAFPN/RepVL-PANâ€ neckï¼ŒæŠŠ backbone çš„å¤šå°ºåº¦å›¾åƒç‰¹å¾ï¼ˆ<code>img_feats</code>ï¼‰åš <strong>Reduce â†’ Top-down â†’ Bottom-up â†’ Out</strong> çš„ PAN-FPN èšåˆï¼Œå¹¶ä¸”åœ¨èšåˆè¿‡ç¨‹ä¸­</strong>ç”¨æ–‡æœ¬ç‰¹å¾ <code>txt_feats</code> å¼•å¯¼/è°ƒåˆ¶ç‰¹å¾èåˆ</strong>ï¼›Dual ç‰ˆæœ¬é¢å¤–åŠ å…¥ <strong>å›¾åƒâ†’æ–‡æœ¬ï¼ˆIâ†’Tï¼‰å¢å¼º</strong>ï¼Œå½¢æˆæ›´â€œå¯¹ç§°â€çš„åŒå‘äº¤äº’ã€‚</p>
<p>å®ƒè§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼š<strong>åœ¨ YOLOv8 é£æ ¼çš„è½»é‡ PAN-FPN ä¸­æ’å…¥è·¨æ¨¡æ€äº¤äº’ï¼Œä½¿å¾—å¤šå°ºåº¦å›¾åƒç‰¹å¾æºå¸¦æ–‡æœ¬è¯­ä¹‰ï¼Œä»è€Œæ”¯æŒ open-vocabulary detection/segmentationã€‚</strong></p>
<hr>
<h2 id="2-æ–‡ä»¶é‡Œçš„ä¸¤ä¸ª-classï¼šè”ç³»ä¸åŒºåˆ«"><a class="header-anchor" href="#2-æ–‡ä»¶é‡Œçš„ä¸¤ä¸ª-classï¼šè”ç³»ä¸åŒºåˆ«">ğŸ”—</a>2) æ–‡ä»¶é‡Œçš„ä¸¤ä¸ª classï¼šè”ç³»ä¸åŒºåˆ«</h2>
<h3 id="A-YOLOWorldPAFPNï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼‰"><a class="header-anchor" href="#A-YOLOWorldPAFPNï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼‰">ğŸ”—</a>A. <code>YOLOWorldPAFPN</code>ï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼‰</h3>
<p><strong>å®šä½ï¼š</strong>â€œæ–‡æœ¬å¼•å¯¼çš„ YOLOv8-PAN é¢ˆéƒ¨ç½‘ç»œâ€ã€‚</p>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>
<p>ç»§æ‰¿è‡ª <code>YOLOv8PAFPN</code>ï¼ˆæˆ–å…¶æ€æƒ³ï¼‰ï¼Œä½†å®ƒæ„é€ çš„ <code>top_down_layers / bottom_up_layers</code> çš„ block <strong>æ”¯æŒ <code>(x, txt_feats)</code> è¾“å…¥</strong>ï¼Œå³èåˆå—å†…éƒ¨å¯ä»¥åšæ–‡æœ¬è°ƒåˆ¶/æ³¨æ„åŠ›ã€‚</p>
</li>
<li>
<p><code>forward(img_feats, txt_feats=None)</code>ï¼šå…è®¸æ¨ç†æ—¶ä¼ /ä¸ä¼ æ–‡æœ¬ï¼ˆæœ‰äº›æ¨¡å¼å¯èƒ½ä¼šèµ°ç¦»çº¿ vocab / re-parameterizationï¼‰ã€‚</p>
</li>
</ul>
<p><strong>å®ƒçš„äº¤äº’æ–¹å‘ä¸»è¦æ˜¯ï¼šTâ†’Iï¼ˆæ–‡æœ¬å¼•å¯¼å›¾åƒç‰¹å¾èåˆï¼‰</strong>ï¼š</p>
<ul>
<li>
<p>Top-downï¼š<code>top_down_layers(..., txt_feats)</code></p>
</li>
<li>
<p>Bottom-upï¼š<code>bottom_up_layers(..., txt_feats)</code></p>
</li>
</ul>
<h3 id="B-YOLOWorldDualPAFPNï¼ˆDual-ç‰ˆæœ¬ï¼‰"><a class="header-anchor" href="#B-YOLOWorldDualPAFPNï¼ˆDual-ç‰ˆæœ¬ï¼‰">ğŸ”—</a>B. <code>YOLOWorldDualPAFPN</code>ï¼ˆDual ç‰ˆæœ¬ï¼‰</h3>
<p>**å®šä½ï¼š**åœ¨ <code>YOLOWorldPAFPN</code> åŸºç¡€ä¸Šé¢å¤–å¼•å…¥ä¸€ä¸ª <code>text_enhancer</code>ï¼ˆé»˜è®¤ <code>ImagePoolingAttentionModule</code>ï¼‰ï¼Œå®ç° <strong>Iâ†’Tï¼ˆå›¾åƒå¢å¼ºæ–‡æœ¬ï¼‰</strong>ã€‚</p>
<p><strong>å·®å¼‚ç‚¹ï¼š</strong></p>
<ul>
<li>
<p><code>__init__</code> é‡Œæ„å»º <code>self.text_enhancer = MODELS.build(text_enhancder)</code>ï¼Œå¹¶æŠŠ <code>image_channels / text_channels / num_feats</code> ç­‰å½¢çŠ¶ä¿¡æ¯è¡¥é½ã€‚</p>
</li>
<li>
<p><code>forward</code> ä¸­çš„å…³é”®æ–°å¢ä¸€è¡Œï¼š</p>
<p><strong>åœ¨ top-down å¾—åˆ° <code>inner_outs</code> åï¼Œå…ˆåšï¼š<code>txt_feats = self.text_enhancer(txt_feats, inner_outs)</code></strong></p>
<p>è®©æ–‡æœ¬ embedding å˜å¾— <em>image-aware</em>ï¼Œå†è¿›å…¥ bottom-upã€‚</p>
</li>
</ul>
<p><strong>å®ƒçš„äº¤äº’å˜æˆï¼šTâ†’Iï¼ˆtop-downï¼‰â†’ Iâ†’Tï¼ˆtext_enhancerï¼‰â†’ Tâ†’Iï¼ˆbottom-upï¼‰</strong>ã€‚</p>
<p>è¿™æ¯”åŸºç¡€ç‰ˆæ›´æ¥è¿‘è®ºæ–‡å›¾ç¤ºé‡Œçš„â€œåŒå‘èåˆâ€å‘³é“ã€‚</p>
<hr>
<h2 id="3-YOLOWorldPAFPN-forward-çš„ä¿¡æ¯æµï¼šä½ éœ€è¦åœ¨è„‘ä¸­å›ºå®šçš„â€œéª¨æ¶â€"><a class="header-anchor" href="#3-YOLOWorldPAFPN-forward-çš„ä¿¡æ¯æµï¼šä½ éœ€è¦åœ¨è„‘ä¸­å›ºå®šçš„â€œéª¨æ¶â€">ğŸ”—</a>3) <code>YOLOWorldPAFPN.forward</code> çš„ä¿¡æ¯æµï¼šä½ éœ€è¦åœ¨è„‘ä¸­å›ºå®šçš„â€œéª¨æ¶â€</h2>
<p>æ— è®ºåŸºç¡€ç‰ˆè¿˜æ˜¯ Dual ç‰ˆï¼Œå›¾åƒç‰¹å¾ä¸»å¹²æµç¨‹ä¸å˜ï¼š</p>
<ol>
<li>
<p><strong>Reduce</strong>ï¼š<code>reduce_layers[idx](img_feats[idx])</code></p>
<p>æŠŠ backbone å¤šå°ºåº¦è¾“å‡ºé€šé“å¯¹é½åˆ° neck æœŸæœ›ç»´åº¦ã€‚</p>
</li>
<li>
<p><strong>Top-down</strong>ï¼ˆFPN éƒ¨åˆ†ï¼‰ï¼š</p>
<p>é«˜å±‚ç‰¹å¾ä¸Šé‡‡æ · â†’ ä¸ä½å±‚ç‰¹å¾ concat â†’ <code>top_down_layers(..., txt_feats)</code> èåˆ</p>
<p>äº§ç‰©ï¼š<code>inner_outs</code>ï¼ˆå®Œæˆ top-down çš„å¤šå°ºåº¦ç‰¹å¾ï¼‰</p>
</li>
<li>
<p><strong>Bottom-up</strong>ï¼ˆPAN éƒ¨åˆ†ï¼‰ï¼š</p>
<p>é«˜åˆ†è¾¨ç‡ç‰¹å¾ä¸‹é‡‡æ · â†’ ä¸æ›´ä½åˆ†è¾¨ç‡ç‰¹å¾ concat â†’ <code>bottom_up_layers(..., txt_feats)</code> èåˆ</p>
<p>äº§ç‰©ï¼š<code>outs</code></p>
</li>
<li>
<p><strong>Out layers</strong>ï¼š<code>out_layers[idx](outs[idx])</code></p>
<p>è¾“å‡ºæ•´å½¢ç»™ head ä½¿ç”¨ï¼ˆæ£€æµ‹å¤´/åˆ†å‰²å¤´ï¼‰ã€‚</p>
</li>
</ol>
<p><strong>Dual ç‰ˆåªæ˜¯åœ¨ 2) å’Œ 3) ä¹‹é—´æ’å…¥äº†ä¸€æ­¥ Iâ†’Tï¼šæ›´æ–° txt_featsã€‚</strong></p>
<hr>
<h2 id="4-è¿™ä¸ªæ–‡ä»¶åœ¨é¡¹ç›®é‡Œå¤„åœ¨ä»€ä¹ˆä½ç½®ï¼šå‰åæ¨¡å—å…³ç³»"><a class="header-anchor" href="#4-è¿™ä¸ªæ–‡ä»¶åœ¨é¡¹ç›®é‡Œå¤„åœ¨ä»€ä¹ˆä½ç½®ï¼šå‰åæ¨¡å—å…³ç³»">ğŸ”—</a>4) è¿™ä¸ªæ–‡ä»¶åœ¨é¡¹ç›®é‡Œå¤„åœ¨ä»€ä¹ˆä½ç½®ï¼šå‰åæ¨¡å—å…³ç³»</h2>
<p>æŠŠ YOLO-World æŒ‰â€œæ•°æ®æµâ€ä¸²èµ·æ¥ï¼Œä½ ä¼šæ›´ç¨³ï¼š</p>
<h3 id="å‰ï¼šData-â†’-Backbone"><a class="header-anchor" href="#å‰ï¼šData-â†’-Backbone">ğŸ”—</a>å‰ï¼šData â†’ Backbone</h3>
<ul>
<li>
<p>æ•°æ®ç»è¿‡ data_preprocessorï¼ˆä½ è´´çš„ <code>YOLOWDetDataPreprocessor</code>ï¼‰åšå½’ä¸€åŒ–/å¢å¼ºï¼Œå¹¶æŠŠ <code>data_samples</code> ç»„ç»‡æˆæ¨¡å‹éœ€è¦çš„å­—å…¸æ ¼å¼ï¼ˆå« <code>texts</code> ç­‰å­—æ®µï¼‰ã€‚</p>
</li>
<li>
<p>Backboneï¼ˆåœ¨ä½ çš„å·¥ç¨‹é‡Œæ˜¯ YOLOv8/Darknet ç±»æˆ–å¤šæ¨¡æ€ backboneï¼‰è¾“å‡º <code>img_feats = [C3, C4, C5]</code> è¿™ç§å¤šå°ºåº¦ç‰¹å¾ã€‚</p>
</li>
</ul>
<h3 id="ä¸­ï¼šNeckï¼ˆå°±æ˜¯æœ¬æ–‡ä»¶ï¼‰"><a class="header-anchor" href="#ä¸­ï¼šNeckï¼ˆå°±æ˜¯æœ¬æ–‡ä»¶ï¼‰">ğŸ”—</a>ä¸­ï¼šNeckï¼ˆå°±æ˜¯æœ¬æ–‡ä»¶ï¼‰</h3>
<ul>
<li>æœ¬æ–‡ä»¶çš„ PAFPN æŠŠ <code>img_feats</code> èšåˆæˆæ›´å¼ºçš„å¤šå°ºåº¦ <code>neck_feats</code>ï¼ˆåŒæ—¶æ³¨å…¥/èåˆäº†æ–‡æœ¬æ¡ä»¶ï¼‰ã€‚</li>
</ul>
<h3 id="åï¼šHeadï¼ˆæ£€æµ‹-åˆ†å‰²ï¼‰"><a class="header-anchor" href="#åï¼šHeadï¼ˆæ£€æµ‹-åˆ†å‰²ï¼‰">ğŸ”—</a>åï¼šHeadï¼ˆæ£€æµ‹/åˆ†å‰²ï¼‰</h3>
<ul>
<li>
<p>Head ä¼šæ‹¿ <code>neck_feats</code> åšï¼š</p>
<ul>
<li>
<p>bbox regression</p>
</li>
<li>
<p>object embedding / similarityï¼ˆä¸æ–‡æœ¬ embedding åš region-text matching / contrastiveï¼‰</p>
</li>
</ul>
</li>
<li>
<p>å¦‚æœä½ åœ¨åš segmentationï¼Œåé¢è¿˜ä¼šè¿ segmentation headï¼ˆä½ å·¥ç¨‹é‡Œæœ‰ <code>yolo_world_seg_head.py</code>ï¼‰ã€‚</p>
</li>
</ul>
<h3 id="è®­ç»ƒæ—¶çš„-Assign-Loss"><a class="header-anchor" href="#è®­ç»ƒæ—¶çš„-Assign-Loss">ğŸ”—</a>è®­ç»ƒæ—¶çš„ Assign / Loss</h3>
<ul>
<li>åˆ†é…ç­–ç•¥ï¼ˆä½ è´´çš„ <code>YOLOWorldSegAssigner</code>ï¼‰å±äº task-aligned assigner çš„å˜ä½“ï¼Œç”¨äºè®­ç»ƒé˜¶æ®µæŠŠé¢„æµ‹å’Œ GT åŒ¹é…ï¼Œå¹¶ç”Ÿæˆ <code>assigned_scores/labels/...</code>ã€‚å®ƒå¹¶ä¸æ”¹ neckï¼Œä½†å†³å®šäº†â€œå“ªäº›é¢„æµ‹è¢«å½“ä½œæ­£æ ·æœ¬â€ï¼Œè¿›è€Œå½±å“ region-text loss çš„å­¦ä¹ ä¿¡å·ã€‚</li>
</ul>
<hr>
<h2 id="5-è¿™ä»½æ–‡ä»¶å’Œè®ºæ–‡å„éƒ¨åˆ†çš„å¯¹åº”å…³ç³»"><a class="header-anchor" href="#5-è¿™ä»½æ–‡ä»¶å’Œè®ºæ–‡å„éƒ¨åˆ†çš„å¯¹åº”å…³ç³»">ğŸ”—</a>5) è¿™ä»½æ–‡ä»¶å’Œè®ºæ–‡å„éƒ¨åˆ†çš„å¯¹åº”å…³ç³»</h2>
<p>è®ºæ–‡çš„æ ¸å¿ƒåœ¨ RepVL-PANï¼š<strong>T-CSPLayerï¼ˆæ–‡æœ¬å¼•å¯¼æ³¨å…¥åˆ°å›¾åƒï¼‰ + I-Pooling Attentionï¼ˆå›¾åƒå¢å¼ºæ–‡æœ¬ï¼‰ + å¯ re-parameterize</strong>ã€‚</p>
<h3 id="å¯¹åº”-1ï¼šT-CSPLayer-Tâ†’I-æ³¨å…¥"><a class="header-anchor" href="#å¯¹åº”-1ï¼šT-CSPLayer-Tâ†’I-æ³¨å…¥">ğŸ”—</a>å¯¹åº” 1ï¼šT-CSPLayer / Tâ†’I æ³¨å…¥</h3>
<ul>
<li>
<p>åœ¨è¿™ä»½ <code>yolo_world_pafpn.py</code> é‡Œï¼Œä½“ç°ä¸ºï¼š</p>
<ul>
<li>
<p><code>top_down_layers(..., txt_feats)</code></p>
</li>
<li>
<p><code>bottom_up_layers(..., txt_feats)</code></p>
</li>
</ul>
</li>
<li>
<p>å…·ä½“ â€œæ€ä¹ˆæ³¨å…¥â€ ä¸åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå±•å¼€ï¼ˆå®ƒæŠŠ <code>txt_feats</code> ä½œä¸ºå‚æ•°ä¼ ç»™ blockï¼‰ï¼Œè€Œæ˜¯åœ¨ä½ é…ç½®çš„ <code>block_cfg[&quot;type&quot;]</code> å¯¹åº”çš„æ¨¡å—å®ç°é‡Œï¼ˆä¾‹å¦‚æŸç§ text-guided CSP/attention blockï¼‰ã€‚</p>
</li>
</ul>
<h3 id="å¯¹åº”-2ï¼šI-Pooling-Attention-Iâ†’T-æ›´æ–°ï¼ˆDual-ç‰ˆï¼‰"><a class="header-anchor" href="#å¯¹åº”-2ï¼šI-Pooling-Attention-Iâ†’T-æ›´æ–°ï¼ˆDual-ç‰ˆï¼‰">ğŸ”—</a>å¯¹åº” 2ï¼šI-Pooling Attention / Iâ†’T æ›´æ–°ï¼ˆDual ç‰ˆï¼‰</h3>
<ul>
<li>
<p><code>YOLOWorldDualPAFPN</code> çš„ <code>text_enhancer</code> é»˜è®¤å°±æ˜¯ <code>ImagePoolingAttentionModule</code>ï¼š</p>
<ul>
<li>
<p>å¤šå°ºåº¦ç‰¹å¾æ± åŒ–ä¸ºå›ºå®šæ•°é‡çš„ patch tokensï¼ˆ<code>pool_size=3</code> â†’ æ¯å°ºåº¦ 9 tokensï¼Œ3 å°ºåº¦å…± 27 tokensï¼‰</p>
</li>
<li>
<p>ç”¨ cross-attentionï¼š<code>Q=æ–‡æœ¬ï¼ŒK/V=å›¾åƒ tokens</code> æ›´æ–°æ–‡æœ¬</p>
</li>
</ul>
</li>
<li>
<p>è¿™å°±å¯¹åº”è®ºæ–‡å›¾ 4 çš„ I-Pooling Attention æ€è·¯ã€‚</p>
</li>
</ul>
<h3 id="å¯¹åº”-3ï¼šRepVL-PAN-çš„â€œç»“æ„å¤–è§‚â€"><a class="header-anchor" href="#å¯¹åº”-3ï¼šRepVL-PAN-çš„â€œç»“æ„å¤–è§‚â€">ğŸ”—</a>å¯¹åº” 3ï¼šRepVL-PAN çš„â€œç»“æ„å¤–è§‚â€</h3>
<ul>
<li>
<p>è®ºæ–‡å›¾ 4 å±•ç¤ºçš„æ˜¯åœ¨ PAN ç»“æ„çš„å¤šä¸ªä½ç½®æ’å…¥ T-CSPLayer å’Œ I-Pooling Attentionã€‚</p>
</li>
<li>
<p>è¿™ä»½ä»£ç åœ¨â€œç»“æ„å±‚é¢â€å¯¹åº”çš„å°±æ˜¯ï¼š</p>
<ul>
<li>
<p>PAN çš„ top-down/bottom-up éª¨æ¶ï¼ˆYOLOv8 é£æ ¼ï¼‰</p>
</li>
<li>
<p>åœ¨èåˆå—é‡Œåšè·¨æ¨¡æ€ï¼ˆTâ†’Iï¼‰</p>
</li>
<li>
<p>Dual ç‰ˆé¢å¤–åœ¨ top-down ç»“æŸåæ˜¾å¼åš Iâ†’Tï¼ˆtext_enhancerï¼‰</p>
</li>
</ul>
</li>
</ul>
<h3 id="å¯¹åº”-4ï¼šre-parameterizationï¼ˆéƒ¨ç½²æ—¶ç¦»çº¿-vocabï¼‰"><a class="header-anchor" href="#å¯¹åº”-4ï¼šre-parameterizationï¼ˆéƒ¨ç½²æ—¶ç¦»çº¿-vocabï¼‰">ğŸ”—</a>å¯¹åº” 4ï¼šre-parameterizationï¼ˆéƒ¨ç½²æ—¶ç¦»çº¿ vocabï¼‰</h3>
<ul>
<li>
<p>è®ºæ–‡å¼ºè°ƒ inference æ—¶å¯ä»¥æŠŠ text encoder ç§»é™¤ï¼Œé¢„ç¼–ç  promptsï¼Œåšç¦»çº¿ vocabã€‚</p>
</li>
<li>
<p>è¿™ä»½æ–‡ä»¶æœ¬èº«ä¸å®ç°â€œæŠŠæ–‡æœ¬ embedding å†™è¿›å·ç§¯æƒé‡â€çš„ reparam ç»†èŠ‚ï¼Œä½†å®ƒçš„æ¥å£è®¾è®¡ï¼ˆ<code>txt_feats</code> ä½œä¸ºå¤–éƒ¨è¾“å…¥ï¼‰å¤©ç„¶æ”¯æŒï¼š</p>
<ul>
<li>
<p>åœ¨çº¿ vocabï¼šæ¯æ¬¡ forward ä¼ å…¥å½“å‰ prompts çš„ embedding</p>
</li>
<li>
<p>ç¦»çº¿ vocabï¼šé¢„å…ˆç®—å¥½ embeddingï¼Œæ¨ç†æ—¶ç›´æ¥å–‚ç»™ <code>txt_feats</code></p>
</li>
</ul>
</li>
<li>
<p>çœŸæ­£çš„â€œæƒé‡é‡å‚æ•°åŒ–â€é€šå¸¸åœ¨å…·ä½“ blockï¼ˆT-CSPLayerï¼‰å®ç°æˆ–éƒ¨ç½²è„šæœ¬é‡Œå®Œæˆã€‚</p>
</li>
</ul>
<hr>
<h2 id="6-ä½ æŒæ¡è¿™ä»½æ–‡ä»¶éœ€è¦æŠ“ä½çš„â€œå…³é”®æŠ½è±¡â€"><a class="header-anchor" href="#6-ä½ æŒæ¡è¿™ä»½æ–‡ä»¶éœ€è¦æŠ“ä½çš„â€œå…³é”®æŠ½è±¡â€">ğŸ”—</a>6) ä½ æŒæ¡è¿™ä»½æ–‡ä»¶éœ€è¦æŠ“ä½çš„â€œå…³é”®æŠ½è±¡â€</h2>
<ol>
<li>
<p><strong>å®ƒæ˜¯ neckï¼Œä¸è´Ÿè´£äº§ç”Ÿæ–‡æœ¬ embedding</strong>ï¼š<code>txt_feats</code> æ¥è‡ªå¤–éƒ¨ï¼ˆtext encoder / offline vocabï¼‰ã€‚</p>
</li>
<li>
<p><strong>å®ƒåªç®¡å¤šå°ºåº¦ç‰¹å¾èšåˆ</strong>ï¼šreduce/top-down/bottom-up/out æ˜¯å›ºå®šéª¨æ¶ã€‚</p>
</li>
<li>
<p><strong>è·¨æ¨¡æ€å‘ç”Ÿåœ¨å“ªé‡Œ</strong>ï¼š</p>
<ul>
<li>
<p>åŸºç¡€ç‰ˆï¼šå‘ç”Ÿåœ¨ <code>top_down_layers</code> / <code>bottom_up_layers</code> çš„ block å†…éƒ¨ï¼ˆTâ†’Iï¼‰ã€‚</p>
</li>
<li>
<p>Dual ç‰ˆï¼šé¢å¤–æ˜¾å¼åšä¸€æ¬¡ Iâ†’Tï¼ˆ<code>text_enhancer</code>ï¼‰ã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong>å®ƒä¸ç›´æ¥å†³å®šåˆ†ç±»/åŒ¹é… loss</strong>ï¼šloss/assign åœ¨ head/assignerï¼›neck åªæä¾›â€œæ›´è¯­ä¹‰åŒ–ã€å¸¦æ–‡æœ¬æ¡ä»¶â€çš„ç‰¹å¾ã€‚</p>
</li>
</ol>
<hr>
<h2 id="7-å»ºè®®ä½ ä¸‹ä¸€æ­¥æ€ä¹ˆâ€œå½»åº•åƒé€â€å®ƒï¼ˆä¸å­¦æ–°çŸ¥è¯†ï¼Œåªæ˜¯æŠŠé“¾è·¯é—­ç¯ï¼‰"><a class="header-anchor" href="#7-å»ºè®®ä½ ä¸‹ä¸€æ­¥æ€ä¹ˆâ€œå½»åº•åƒé€â€å®ƒï¼ˆä¸å­¦æ–°çŸ¥è¯†ï¼Œåªæ˜¯æŠŠé“¾è·¯é—­ç¯ï¼‰">ğŸ”—</a>7) å»ºè®®ä½ ä¸‹ä¸€æ­¥æ€ä¹ˆâ€œå½»åº•åƒé€â€å®ƒï¼ˆä¸å­¦æ–°çŸ¥è¯†ï¼Œåªæ˜¯æŠŠé“¾è·¯é—­ç¯ï¼‰</h2>
<p>å¦‚æœä½ æƒ³æŠŠè¿™ä»½æ–‡ä»¶çœŸæ­£åšåˆ°â€œé—­çœ¼èƒ½å¤è¿°â€ï¼Œä¸‹ä¸€æ­¥æœ€å…³é”®çš„æ˜¯ç¡®è®¤ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>
<p><code>block_cfg[&quot;type&quot;]</code> å…·ä½“æ˜¯ä»€ä¹ˆç±»ï¼Ÿï¼ˆåœ¨å“ªä¸ªæ–‡ä»¶å®ç°ï¼‰</p>
<ul>
<li>å› ä¸ºå®ƒå†³å®šäº† <code>top_down_layers/bottom_up_layers</code> å¦‚ä½•ä½¿ç”¨ <code>txt_feats</code>ï¼ˆæ˜¯é—¨æ§ï¼Ÿæ˜¯æ³¨æ„åŠ›ï¼Ÿæ˜¯ max-sigmoidï¼Ÿï¼‰</li>
</ul>
</li>
<li>
<p>Dual ç‰ˆçš„ <code>ImagePoolingAttentionModule</code> çš„è¾“å…¥è¾“å‡º shape åœ¨ä½ çš„è®­ç»ƒé…ç½®ä¸‹æ˜¯å¦å®Œå…¨ä¸€è‡´ï¼ˆå°¤å…¶æ˜¯ <code>image_channels</code> æ˜¯å¦ä¸ <code>inner_outs</code> çš„ C å¯¹é½ï¼‰ã€‚</p>
</li>
</ol>
<p>ä½ æŠŠ <strong><code>block_cfg</code> å¯¹åº”æ¨¡å—çš„æºç æ–‡ä»¶å/ç±»å</strong>è´´ä¸€ä¸‹ï¼Œæˆ‘å°±èƒ½æŠŠâ€œtxt_feats åœ¨ block å†…éƒ¨åˆ°åº•æ€ä¹ˆæ³¨å…¥ï¼ˆé€è¡Œ + shape æ¨å¯¼ï¼‰â€ä¹Ÿè¡¥é½ï¼Œè¿™æ ·ä½ å¯¹æ•´ä¸ª RepVL-PAN çš„ä»£ç é—­ç¯å°±å®Œæˆäº†ã€‚</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/blog/tags/Yolo-World/">Yolo-World</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/blog/2025/12/18/%E6%9D%82%E8%AE%B0/python%E8%AF%AD%E6%B3%95%E5%8F%8A%E5%87%BD%E6%95%B0%E7%A7%AF%E7%B4%AF/" title="pythonè¯­æ³•åŠå‡½æ•°ç§¯ç´¯"><img class="cover" src="/blog/image/q4SynOBjcxn5gA6.jpeg" onerror="onerror=null;src='/blog/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">pythonè¯­æ³•åŠå‡½æ•°ç§¯ç´¯</div></div><div class="info-2"><div class="info-item-1">   ç³»åˆ—æ–‡ç«    /   æ‚è®°  ğŸ”—isinstance isinstance(variable, type):  è¿™æ˜¯ Python ç”¨æ¥æ£€æŸ¥ç±»å‹çš„ã€‚æ¯”å¦‚ isinstance(a, dict) å°±æ˜¯é—®ï¼šå˜é‡ a æ˜¯ä¸æ˜¯ä¸€ä¸ªå­—å…¸ï¼Ÿ è¿™æ®µé€»è¾‘å°±æ˜¯ä¸ºäº†å…¼å®¹å„ç§ä¸åŒçš„è¾“å…¥æ ¼å¼ï¼ˆè®­ç»ƒæ—¶ã€æµ‹è¯•æ—¶ã€å¯¼å‡ºæ¨¡å‹æ—¶è¾“å…¥æ ¼å¼éƒ½ä¸å¤ªä¸€æ ·ï¼‰ã€‚  1234567891011121314151617def extract_feat(       ...</div></div></div></a><a class="pagination-related" href="/blog/2025/12/18/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-detectors-yolo_world.py/" title="ä»£ç è§£è¯»ï¼šyolo_world-models-detectors-yolo_world.py"><img class="cover" src="/blog/image/q4SynOBjcxn5gA6.jpeg" onerror="onerror=null;src='/blog/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">ä»£ç è§£è¯»ï¼šyolo_world-models-detectors-yolo_world.py</div></div><div class="info-2"><div class="info-item-1">   ç³»åˆ—æ–‡ç«    /   å¼€æ”¾è¯æ±‡æ£€æµ‹ / yolo-world  ğŸ”—yolo_world ğŸ”—yolo_world/models/detectors/yolo_world.py è¿™ä»½åˆ†æå°†ç»“åˆ YOLO-World è®ºæ–‡ï¼ˆCheng et al., 2024ï¼‰çš„æ ¸å¿ƒæ¦‚å¿µï¼Œé€è¡Œè§£è¯» yolo_world/models/detectors/yolo_world.py ä»£ç ã€‚ è¿™ä»½ä»£ç å®ç°äº†è®ºæ–‡ä¸­æå‡ºçš„ YOLO-World...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/blog/2025/12/18/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-detectors-yolo_world.py/" title="ä»£ç è§£è¯»ï¼šyolo_world-models-detectors-yolo_world.py"><img class="cover" src="/blog/image/q4SynOBjcxn5gA6.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-18</div><div class="info-item-2">ä»£ç è§£è¯»ï¼šyolo_world-models-detectors-yolo_world.py</div></div><div class="info-2"><div class="info-item-1">   ç³»åˆ—æ–‡ç«    /   å¼€æ”¾è¯æ±‡æ£€æµ‹ / yolo-world  ğŸ”—yolo_world ğŸ”—yolo_world/models/detectors/yolo_world.py è¿™ä»½åˆ†æå°†ç»“åˆ YOLO-World è®ºæ–‡ï¼ˆCheng et al., 2024ï¼‰çš„æ ¸å¿ƒæ¦‚å¿µï¼Œé€è¡Œè§£è¯» yolo_world/models/detectors/yolo_world.py ä»£ç ã€‚ è¿™ä»½ä»£ç å®ç°äº†è®ºæ–‡ä¸­æå‡ºçš„ YOLO-World...</div></div></div></a><a class="pagination-related" href="/blog/2025/10/24/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9AYOLO-World-Real-Time-Open-Vocabulary-Object-Detection/" title="è®ºæ–‡é˜…è¯»ï¼šYOLO-World: Real-Time Open-Vocabulary Object Detection"><img class="cover" src="/blog/image/A1-2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-24</div><div class="info-item-2">è®ºæ–‡é˜…è¯»ï¼šYOLO-World: Real-Time Open-Vocabulary Object Detection</div></div><div class="info-2"><div class="info-item-1">   ç³»åˆ—æ–‡ç«    /   å¼€æ”¾è¯æ±‡æ£€æµ‹ / yolo-world  ğŸ”—1 Introduction ğŸ”—1. è¿™èŠ‚åœ¨å›ç­”ä»€ä¹ˆé—®é¢˜ï¼Ÿ  ç°å®åŠ¨æœºï¼šä¼ ç»Ÿæ£€æµ‹å™¨ï¼ˆä¾‹å¦‚åœ¨ COCO ä¸Šè®­ç»ƒçš„æ¨¡å‹ï¼‰åªèƒ½è¯†åˆ«å›ºå®šè¯è¡¨ä¸­çš„ç±»åˆ«ï¼ˆCOCO åªæœ‰80ç±»ï¼‰ã€‚ä¸€æ—¦è®­ç»ƒå¥½çš„ç±»åˆ«è¢«å®šæ­»ï¼Œæ¨¡å‹å°±æ— æ³•è¯†åˆ«ä¸åœ¨è¯è¡¨é‡Œçš„ç›®æ ‡ï¼Œè¿™åœ¨å¼€æ”¾åœºæ™¯é‡Œå¾ˆå—é™ã€‚ä½œè€…å…ˆæ˜ç¡®äº†è¿™ä¸ªâ€œå›ºå®šè¯è¡¨çš„å¤©èŠ±æ¿â€é—®é¢˜ã€‚ éœ€æ±‚ä¸æŒ‘æˆ˜ï¼šæˆ‘ä»¬éœ€è¦çš„æ˜¯å¼€æ”¾è¯æ±‡æ£€æµ‹ï¼ˆOpen-Vocabulary...</div></div></div></a><a class="pagination-related" href="/blog/2025/12/01/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-dense_heads-yolo_world_head.py/" title="ä»£ç è§£è¯»ï¼šyolo_world-models-dense_heads-yolo_world_head.py"><img class="cover" src="/blog/image/A1-2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-01</div><div class="info-item-2">ä»£ç è§£è¯»ï¼šyolo_world-models-dense_heads-yolo_world_head.py</div></div><div class="info-2"><div class="info-item-1">   ç³»åˆ—æ–‡ç«    /   å¼€æ”¾è¯æ±‡æ£€æµ‹ / yolo-world  ğŸ”—class ContrastiveHead(BaseModule) ğŸ”—æ€»ç»“ ğŸ”—ContrastiveHeadçš„ä½œç”¨  æŠŠæ¯ä¸ªä½ç½®çš„å›¾åƒç‰¹å¾å‘é‡ x[:, :, h, w] ä¸æ¯ä¸ªæ–‡æœ¬ç±»åˆ«å‘é‡ w[:, k, :] åšç‚¹ç§¯ç›¸ä¼¼åº¦ï¼Œå¾—åˆ°è¯¥ä½ç½®å¯¹æ¯ä¸ªç±»åˆ«çš„ logitã€‚ åœ¨è®ºæ–‡è¯­è¨€é‡Œï¼Œè¿™å°±æ˜¯ region-text matching / text...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/blog/image/IMG_20250131_155849.jpg" onerror="this.onerror=null;this.src='/blog/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">lian</div><div class="author-info-description">é•¿æœŸä¸»ä¹‰å­¦ä¹ è€…ï¼Œè®°å½•æŠ€æœ¯ã€è®ºæ–‡ä¸ç”Ÿæ´»ã€‚</div><div class="site-data"><a href="/blog/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">43</div></a><a href="/blog/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">21</div></a><a href="/blog/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/qieliqiean"><i class="fab fa-github"></i><span>è®¿é—® GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/qieliqiean" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2895014608@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ¬¢è¿äº¤æµï¼š2895014608@qq.com</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#class-YOLOWorldPAFPN-YOLOv8PAFPN"><span class="toc-text">ğŸ”—class YOLOWorldPAFPN(YOLOv8PAFPN)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#def-init"><span class="toc-text">ğŸ”—def init</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#def-build-top-down-layer"><span class="toc-text">ğŸ”—def build_top_down_layer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%8E%9F%E6%96%87"><span class="toc-text">ğŸ”—ä»£ç åŸæ–‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%87%BD%E6%95%B0%E5%A4%B4"><span class="toc-text">ğŸ”—1) å‡½æ•°å¤´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B7%B1%E6%8B%B7%E8%B4%9D-block-%E9%85%8D%E7%BD%AE%EF%BC%8C%E9%81%BF%E5%85%8D%E6%B1%A1%E6%9F%93%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE"><span class="toc-text">ğŸ”—2) æ·±æ‹·è´ block é…ç½®ï¼Œé¿å…æ±¡æŸ“å…¨å±€é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%94%A8-update-%E6%8A%8A%E2%80%9C%E8%BF%99%E4%B8%80%E5%B1%82%E2%80%9D%E9%9C%80%E8%A6%81%E7%9A%84%E5%85%B3%E9%94%AE%E8%B6%85%E5%8F%82%E6%95%B0%E8%A1%A5%E9%BD%90"><span class="toc-text">ğŸ”—3) ç”¨ update() æŠŠâ€œè¿™ä¸€å±‚â€éœ€è¦çš„å…³é”®è¶…å‚æ•°è¡¥é½</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E8%AE%A1%E7%AE%97-in-channels%EF%BC%9A%E6%9D%A5%E8%87%AA-concat-%E7%9A%84%E9%80%9A%E9%81%93%E6%95%B0"><span class="toc-text">ğŸ”—3.1 è®¡ç®— in_channelsï¼šæ¥è‡ª concat çš„é€šé“æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AE%A1%E7%AE%97-out-channels%EF%BC%9A%E8%BE%93%E5%87%BA%E5%88%B0-idx-1-%E5%B0%BA%E5%BA%A6%E7%9A%84%E9%80%9A%E9%81%93"><span class="toc-text">ğŸ”—3.2 è®¡ç®— out_channelsï¼šè¾“å‡ºåˆ° idx-1 å°ºåº¦çš„é€šé“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-YOLO-World-%E7%89%B9%E6%9C%89%EF%BC%9Aguide-channels%EF%BC%88%E6%96%87%E6%9C%AC-%E5%BC%95%E5%AF%BC%E7%89%B9%E5%BE%81%E7%BB%B4%E5%BA%A6%EF%BC%89"><span class="toc-text">ğŸ”—3.3 YOLO-World ç‰¹æœ‰ï¼šguide_channelsï¼ˆæ–‡æœ¬&#x2F;å¼•å¯¼ç‰¹å¾ç»´åº¦ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-embedding-%E7%BB%B4%E5%BA%A6%EF%BC%9A%E6%AF%8F%E4%B8%AA%E5%B0%BA%E5%BA%A6%E4%B8%80%E4%B8%AA"><span class="toc-text">ğŸ”—3.4 embedding ç»´åº¦ï¼šæ¯ä¸ªå°ºåº¦ä¸€ä¸ª</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E5%A4%9A%E5%A4%B4%E6%95%B0%EF%BC%9A%E6%AF%8F%E4%B8%AA%E5%B0%BA%E5%BA%A6%E4%B8%80%E4%B8%AA"><span class="toc-text">ğŸ”—3.5 å¤šå¤´æ•°ï¼šæ¯ä¸ªå°ºåº¦ä¸€ä¸ª</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-CSP-%E5%86%85%E9%83%A8%E5%A0%86%E5%8F%A0%E6%AC%A1%E6%95%B0%EF%BC%9A%E5%8F%97-deepen-factor-%E5%BD%B1%E5%93%8D"><span class="toc-text">ğŸ”—3.6 CSP å†…éƒ¨å †å æ¬¡æ•°ï¼šå— deepen_factor å½±å“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-add-identity-False%EF%BC%9A%E5%85%B3%E9%97%AD%E6%AE%8B%E5%B7%AE%E6%8D%B7%E5%BE%84"><span class="toc-text">ğŸ”—3.7 add_identity&#x3D;Falseï¼šå…³é—­æ®‹å·®æ·å¾„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-norm-act%EF%BC%9A%E6%8A%8A%E8%A7%84%E8%8C%83%E5%8C%96%E5%92%8C%E6%BF%80%E6%B4%BB%E9%85%8D%E7%BD%AE%E4%BC%A0%E8%BF%9B%E5%8E%BB"><span class="toc-text">ğŸ”—3.8 norm&#x2F;actï¼šæŠŠè§„èŒƒåŒ–å’Œæ¿€æ´»é…ç½®ä¼ è¿›å»</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%94%B1%E6%B3%A8%E5%86%8C%E8%A1%A8%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9D%97%E5%AE%9E%E4%BE%8B"><span class="toc-text">ğŸ”—4) ç”±æ³¨å†Œè¡¨æ„å»ºæ¨¡å—å®ä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#def-build-bottom-up-layer"><span class="toc-text">ğŸ”—def build_bottom_up_layer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%8E%9F%E6%96%87-2"><span class="toc-text">ğŸ”—ä»£ç åŸæ–‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%87%BD%E6%95%B0%E5%A4%B4-2"><span class="toc-text">ğŸ”—1) å‡½æ•°å¤´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B7%B1%E6%8B%B7%E8%B4%9D-block-%E6%A8%A1%E6%9D%BF%E9%85%8D%E7%BD%AE"><span class="toc-text">ğŸ”—2) æ·±æ‹·è´ block æ¨¡æ¿é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%B3%E9%94%AE%EF%BC%9A%E7%BB%99%E8%BF%99%E4%B8%80%E5%B1%82%E8%A1%A5%E9%BD%90%E6%9E%84%E5%BB%BA%E5%8F%82%E6%95%B0"><span class="toc-text">ğŸ”—3) å…³é”®ï¼šç»™è¿™ä¸€å±‚è¡¥é½æ„å»ºå‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-bottom-up-%E7%9A%84-in-channels%EF%BC%9A%E6%9D%A5%E8%87%AA-concat%EF%BC%88%E4%B8%A4%E4%B8%AA%E9%83%BD%E6%98%AF-out-channels%EF%BC%89"><span class="toc-text">ğŸ”—3.1 bottom-up çš„ in_channelsï¼šæ¥è‡ª concatï¼ˆä¸¤ä¸ªéƒ½æ˜¯ out_channelsï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-out-channels%EF%BC%9A%E5%AF%B9%E9%BD%90%E5%88%B0%E6%9B%B4%E4%BD%8E%E5%88%86%E8%BE%A8%E7%8E%87%E9%82%A3%E5%B1%82%EF%BC%88idx-1%EF%BC%89"><span class="toc-text">ğŸ”—3.2 out_channelsï¼šå¯¹é½åˆ°æ›´ä½åˆ†è¾¨ç‡é‚£å±‚ï¼ˆidx+1ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-YOLO-World-%E7%89%B9%E6%9C%89%EF%BC%9A%E6%96%87%E6%9C%AC%E5%BC%95%E5%AF%BC%E7%BB%B4%E5%BA%A6"><span class="toc-text">ğŸ”—3.3 YOLO-World ç‰¹æœ‰ï¼šæ–‡æœ¬å¼•å¯¼ç»´åº¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-embed-channels%EF%BC%9A%E6%B3%A8%E6%84%8F%E8%BF%99%E9%87%8C%E7%94%A8%E7%9A%84%E6%98%AF-embed-channels-idx"><span class="toc-text">ğŸ”—3.4 embed_channelsï¼šæ³¨æ„è¿™é‡Œç”¨çš„æ˜¯ embed_channels[idx]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-num-heads%EF%BC%9A%E5%90%8C%E6%A0%B7%E6%8C%89-idx-%E5%8F%96"><span class="toc-text">ğŸ”—3.5 num_headsï¼šåŒæ ·æŒ‰ idx å–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-num-blocks%EF%BC%9ACSP-%E5%A0%86%E5%8F%A0%E6%95%B0%E6%8C%89-deepen-factor-%E7%BC%A9%E6%94%BE"><span class="toc-text">ğŸ”—3.6 num_blocksï¼šCSP å †å æ•°æŒ‰ deepen_factor ç¼©æ”¾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-add-identity-False"><span class="toc-text">ğŸ”—3.7 add_identity&#x3D;False</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-%E8%A7%84%E8%8C%83%E5%8C%96%E4%B8%8E%E6%BF%80%E6%B4%BB%E9%85%8D%E7%BD%AE"><span class="toc-text">ğŸ”—3.8 è§„èŒƒåŒ–ä¸æ¿€æ´»é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%94%A8%E6%B3%A8%E5%86%8C%E8%A1%A8%E7%9C%9F%E6%AD%A3%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%A8%A1%E5%9D%97"><span class="toc-text">ğŸ”—4) ç”¨æ³¨å†Œè¡¨çœŸæ­£å®ä¾‹åŒ–æ¨¡å—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bottom-up-vs-top-down-%E7%9A%84%E6%A0%B8%E5%BF%83%E5%B7%AE%E5%BC%82"><span class="toc-text">ğŸ”—bottom-up vs top-down çš„æ ¸å¿ƒå·®å¼‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#def-forward"><span class="toc-text">ğŸ”—def forward</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%87%BD%E6%95%B0%E5%A4%B4%E4%B8%8E%E6%B3%A8%E9%87%8A"><span class="toc-text">ğŸ”—1) å‡½æ•°å¤´ä¸æ³¨é‡Š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9F%BA%E6%9C%AC%E4%B8%80%E8%87%B4%E6%80%A7%E6%A3%80%E6%9F%A5"><span class="toc-text">ğŸ”—2) åŸºæœ¬ä¸€è‡´æ€§æ£€æŸ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Reduce-%E9%98%B6%E6%AE%B5%EF%BC%9A%E5%85%88%E6%8A%8A%E6%AF%8F%E4%B8%AA%E5%B0%BA%E5%BA%A6%E9%80%9A%E9%81%93%E2%80%9C%E5%AF%B9%E9%BD%90-%E5%8E%8B%E7%BC%A9%E2%80%9D"><span class="toc-text">ğŸ”—3) Reduce é˜¶æ®µï¼šå…ˆæŠŠæ¯ä¸ªå°ºåº¦é€šé“â€œå¯¹é½&#x2F;å‹ç¼©â€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Top-down-%E8%B7%AF%E5%BE%84%EF%BC%9A%E9%AB%98%E5%B1%82%E8%AF%AD%E4%B9%89%E5%90%91%E4%BD%8E%E5%B1%82%E4%BC%A0%E6%92%AD%EF%BC%88%E4%B8%8A%E9%87%87%E6%A0%B7-concat-%E8%9E%8D%E5%90%88%E5%9D%97%EF%BC%89"><span class="toc-text">ğŸ”—4) Top-down è·¯å¾„ï¼šé«˜å±‚è¯­ä¹‰å‘ä½å±‚ä¼ æ’­ï¼ˆä¸Šé‡‡æ · + concat + èåˆå—ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Bottom-up-%E8%B7%AF%E5%BE%84%EF%BC%9A%E4%BD%8E%E5%B1%82%E4%BF%A1%E6%81%AF%E5%90%91%E9%AB%98%E5%B1%82%E5%86%8D%E8%81%9A%E5%90%88%EF%BC%88%E4%B8%8B%E9%87%87%E6%A0%B7-concat-%E8%9E%8D%E5%90%88%E5%9D%97%EF%BC%89"><span class="toc-text">ğŸ”—5) Bottom-up è·¯å¾„ï¼šä½å±‚ä¿¡æ¯å‘é«˜å±‚å†èšåˆï¼ˆä¸‹é‡‡æ · + concat + èåˆå—ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Out-layers%EF%BC%9A%E6%9C%80%E5%90%8E%E5%86%8D%E5%81%9A%E4%B8%80%E5%B1%82%E8%BE%93%E5%87%BA%E6%95%B4%E5%BD%A2%EF%BC%88%E9%80%9A%E5%B8%B8%E6%98%AF-1x1-3x3-conv%EF%BC%89"><span class="toc-text">ğŸ”—6) Out layersï¼šæœ€åå†åšä¸€å±‚è¾“å‡ºæ•´å½¢ï¼ˆé€šå¸¸æ˜¯ 1x1&#x2F;3x3 convï¼‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#class-YOLOWorldDualPAFPN-YOLOWorldPAFPN"><span class="toc-text">ğŸ”—class YOLOWorldDualPAFPN(YOLOWorldPAFPN)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#def-init-2"><span class="toc-text">ğŸ”—def init</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%87%BD%E6%95%B0%E7%AD%BE%E5%90%8D%EF%BC%9A%E6%8A%8A-Dual-%E7%89%88%E6%9C%AC%E9%9C%80%E8%A6%81%E7%9A%84%E8%B6%85%E5%8F%82%E9%83%BD%E6%94%B6%E8%BF%9B%E6%9D%A5"><span class="toc-text">ğŸ”—1) å‡½æ•°ç­¾åï¼šæŠŠ Dual ç‰ˆæœ¬éœ€è¦çš„è¶…å‚éƒ½æ”¶è¿›æ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-super-init-%EF%BC%9A%E5%85%88%E6%8A%8A%E2%80%9C%E5%9F%BA%E7%A1%80-YOLOWorldPAFPN%E2%80%9D%E5%AE%8C%E6%95%B4%E6%90%AD%E5%87%BA%E6%9D%A5"><span class="toc-text">ğŸ”—2) super().__init__(...)ï¼šå…ˆæŠŠâ€œåŸºç¡€ YOLOWorldPAFPNâ€å®Œæ•´æ­å‡ºæ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-text-enhancder-update-%EF%BC%9A%E6%8A%8A%E8%BF%90%E8%A1%8C%E6%97%B6%E5%BF%85%E8%A6%81%E7%9A%84%E7%BB%B4%E5%BA%A6%E4%BF%A1%E6%81%AF%E8%A1%A5%E8%BF%9B%E9%85%8D%E7%BD%AE"><span class="toc-text">ğŸ”—3) text_enhancder.update(...)ï¼šæŠŠè¿è¡Œæ—¶å¿…è¦çš„ç»´åº¦ä¿¡æ¯è¡¥è¿›é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#update-%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-text">ğŸ”—update() æ–¹æ³•ï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-print-text-enhancder-%EF%BC%9A%E8%B0%83%E8%AF%95%E8%BE%93%E5%87%BA%EF%BC%88%E8%AE%AD%E7%BB%83-%E6%9E%84%E5%BB%BA%E6%97%B6%E4%BC%9A%E6%89%93%E5%8D%B0%EF%BC%89"><span class="toc-text">ğŸ”—4) print(text_enhancder)ï¼šè°ƒè¯•è¾“å‡ºï¼ˆè®­ç»ƒ&#x2F;æ„å»ºæ—¶ä¼šæ‰“å°ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-self-text-enhancer-MODELS-build-text-enhancder-%EF%BC%9A%E7%94%A8%E6%B3%A8%E5%86%8C%E8%A1%A8%E6%8A%8A%E6%A8%A1%E5%9D%97%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%87%BA%E6%9D%A5"><span class="toc-text">ğŸ”—5) self.text_enhancer &#x3D; MODELS.build(text_enhancder)ï¼šç”¨æ³¨å†Œè¡¨æŠŠæ¨¡å—å®ä¾‹åŒ–å‡ºæ¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#def-forward-2"><span class="toc-text">ğŸ”—def forward</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%85%A5%E5%8F%A3%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%A3%80%E6%9F%A5"><span class="toc-text">ğŸ”—å‡½æ•°å…¥å£ä¸åŸºæœ¬æ£€æŸ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E9%81%93%E7%BC%A9%E5%87%8F%EF%BC%88Reduce-Layers%EF%BC%89"><span class="toc-text">ğŸ”—é€šé“ç¼©å‡ï¼ˆReduce Layersï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B%E8%B7%AF%E5%BE%84%EF%BC%88Top-down-Path%EF%BC%89%E2%80%94%E2%80%94-%E6%96%87%E6%9C%AC%E5%BC%95%E5%AF%BC%E5%9B%BE%E5%83%8F"><span class="toc-text">ğŸ”—è‡ªé¡¶å‘ä¸‹è·¯å¾„ï¼ˆTop-down Pathï¼‰â€”â€” æ–‡æœ¬å¼•å¯¼å›¾åƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dual-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%96%B0%E5%A2%9E-span-style-color-FF0000-%E5%9B%BE%E5%83%8F%E5%BC%95%E5%AF%BC%E6%96%87%E6%9C%AC-span"><span class="toc-text">ğŸ”—Dual çš„æ ¸å¿ƒæ–°å¢--å›¾åƒå¼•å¯¼æ–‡æœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%BA%95%E5%90%91%E4%B8%8A%E8%B7%AF%E5%BE%84%EF%BC%88Bottom-up-Path%EF%BC%89%E2%80%94%E2%80%94-%E5%A2%9E%E5%BC%BA%E6%96%87%E6%9C%AC%E5%86%8D%E6%AC%A1%E5%BC%95%E5%AF%BC%E5%9B%BE%E5%83%8F"><span class="toc-text">ğŸ”—è‡ªåº•å‘ä¸Šè·¯å¾„ï¼ˆBottom-up Pathï¼‰â€”â€” å¢å¼ºæ–‡æœ¬å†æ¬¡å¼•å¯¼å›¾åƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Out-layers%EF%BC%9A%E8%BE%93%E5%87%BA%E6%95%B4%E5%BD%A2%E5%B9%B6%E8%BF%94%E5%9B%9E"><span class="toc-text">ğŸ”—Out layersï¼šè¾“å‡ºæ•´å½¢å¹¶è¿”å›</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%931"><span class="toc-text">ğŸ”—æ€»ç»“1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E4%BB%BB%E5%8A%A1%EF%BC%9ARepVL-PAN-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">ğŸ”—1. æ ¸å¿ƒä»»åŠ¡ï¼šRepVL-PAN çš„å®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%B1%BB%E5%85%B3%E7%B3%BB%E4%B8%8E%E5%8C%BA%E5%88%AB%EF%BC%9A%E4%BB%8E%E5%8D%95%E5%90%91%E5%88%B0%E5%8F%8C%E5%90%91"><span class="toc-text">ğŸ”—2. ç±»å…³ç³»ä¸åŒºåˆ«ï¼šä»å•å‘åˆ°åŒå‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%A8%A1%E5%9D%97%E9%97%B4%E7%9A%84%E5%89%8D%E5%90%8E%E8%81%94%E7%B3%BB%EF%BC%88%E6%9E%A2%E7%BA%BD%E5%9C%B0%E4%BD%8D%EF%BC%89"><span class="toc-text">ğŸ”—3. æ¨¡å—é—´çš„å‰åè”ç³»ï¼ˆæ¢çº½åœ°ä½ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%AE%BA%E6%96%87%E4%B8%AD%E7%9A%84%E7%AE%97%E6%B3%95%E5%AF%B9%E5%BA%94"><span class="toc-text">ğŸ”—4. è®ºæ–‡ä¸­çš„ç®—æ³•å¯¹åº”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%80%BB%E7%BB%93%EF%BC%9A%E4%BD%A0%E5%BA%94%E8%AF%A5%E6%8E%8C%E6%8F%A1%E7%9A%84%E4%B8%89%E4%B8%AA%E5%85%B3%E9%94%AE%E7%82%B9"><span class="toc-text">ğŸ”—5. æ€»ç»“ï¼šä½ åº”è¯¥æŒæ¡çš„ä¸‰ä¸ªå…³é”®ç‚¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%932"><span class="toc-text">ğŸ”—æ€»ç»“2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%BF%99%E4%BB%BD%E6%96%87%E4%BB%B6%E6%95%B4%E4%BD%93%E5%9C%A8%E5%AE%9E%E7%8E%B0%E4%BB%80%E4%B9%88"><span class="toc-text">ğŸ”—1) è¿™ä»½æ–‡ä»¶æ•´ä½“åœ¨å®ç°ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%96%87%E4%BB%B6%E9%87%8C%E7%9A%84%E4%B8%A4%E4%B8%AA-class%EF%BC%9A%E8%81%94%E7%B3%BB%E4%B8%8E%E5%8C%BA%E5%88%AB"><span class="toc-text">ğŸ”—2) æ–‡ä»¶é‡Œçš„ä¸¤ä¸ª classï¼šè”ç³»ä¸åŒºåˆ«</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#A-YOLOWorldPAFPN%EF%BC%88%E5%9F%BA%E7%A1%80%E7%89%88%E6%9C%AC%EF%BC%89"><span class="toc-text">ğŸ”—A. YOLOWorldPAFPNï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B-YOLOWorldDualPAFPN%EF%BC%88Dual-%E7%89%88%E6%9C%AC%EF%BC%89"><span class="toc-text">ğŸ”—B. YOLOWorldDualPAFPNï¼ˆDual ç‰ˆæœ¬ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-YOLOWorldPAFPN-forward-%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%EF%BC%9A%E4%BD%A0%E9%9C%80%E8%A6%81%E5%9C%A8%E8%84%91%E4%B8%AD%E5%9B%BA%E5%AE%9A%E7%9A%84%E2%80%9C%E9%AA%A8%E6%9E%B6%E2%80%9D"><span class="toc-text">ğŸ”—3) YOLOWorldPAFPN.forward çš„ä¿¡æ¯æµï¼šä½ éœ€è¦åœ¨è„‘ä¸­å›ºå®šçš„â€œéª¨æ¶â€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%E5%9C%A8%E9%A1%B9%E7%9B%AE%E9%87%8C%E5%A4%84%E5%9C%A8%E4%BB%80%E4%B9%88%E4%BD%8D%E7%BD%AE%EF%BC%9A%E5%89%8D%E5%90%8E%E6%A8%A1%E5%9D%97%E5%85%B3%E7%B3%BB"><span class="toc-text">ğŸ”—4) è¿™ä¸ªæ–‡ä»¶åœ¨é¡¹ç›®é‡Œå¤„åœ¨ä»€ä¹ˆä½ç½®ï¼šå‰åæ¨¡å—å…³ç³»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%EF%BC%9AData-%E2%86%92-Backbone"><span class="toc-text">ğŸ”—å‰ï¼šData â†’ Backbone</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%EF%BC%9ANeck%EF%BC%88%E5%B0%B1%E6%98%AF%E6%9C%AC%E6%96%87%E4%BB%B6%EF%BC%89"><span class="toc-text">ğŸ”—ä¸­ï¼šNeckï¼ˆå°±æ˜¯æœ¬æ–‡ä»¶ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%EF%BC%9AHead%EF%BC%88%E6%A3%80%E6%B5%8B-%E5%88%86%E5%89%B2%EF%BC%89"><span class="toc-text">ğŸ”—åï¼šHeadï¼ˆæ£€æµ‹&#x2F;åˆ†å‰²ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E6%97%B6%E7%9A%84-Assign-Loss"><span class="toc-text">ğŸ”—è®­ç»ƒæ—¶çš„ Assign &#x2F; Loss</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E8%BF%99%E4%BB%BD%E6%96%87%E4%BB%B6%E5%92%8C%E8%AE%BA%E6%96%87%E5%90%84%E9%83%A8%E5%88%86%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="toc-text">ğŸ”—5) è¿™ä»½æ–‡ä»¶å’Œè®ºæ–‡å„éƒ¨åˆ†çš„å¯¹åº”å…³ç³»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94-1%EF%BC%9AT-CSPLayer-T%E2%86%92I-%E6%B3%A8%E5%85%A5"><span class="toc-text">ğŸ”—å¯¹åº” 1ï¼šT-CSPLayer &#x2F; Tâ†’I æ³¨å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94-2%EF%BC%9AI-Pooling-Attention-I%E2%86%92T-%E6%9B%B4%E6%96%B0%EF%BC%88Dual-%E7%89%88%EF%BC%89"><span class="toc-text">ğŸ”—å¯¹åº” 2ï¼šI-Pooling Attention &#x2F; Iâ†’T æ›´æ–°ï¼ˆDual ç‰ˆï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94-3%EF%BC%9ARepVL-PAN-%E7%9A%84%E2%80%9C%E7%BB%93%E6%9E%84%E5%A4%96%E8%A7%82%E2%80%9D"><span class="toc-text">ğŸ”—å¯¹åº” 3ï¼šRepVL-PAN çš„â€œç»“æ„å¤–è§‚â€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%BA%94-4%EF%BC%9Are-parameterization%EF%BC%88%E9%83%A8%E7%BD%B2%E6%97%B6%E7%A6%BB%E7%BA%BF-vocab%EF%BC%89"><span class="toc-text">ğŸ”—å¯¹åº” 4ï¼šre-parameterizationï¼ˆéƒ¨ç½²æ—¶ç¦»çº¿ vocabï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E4%BD%A0%E6%8E%8C%E6%8F%A1%E8%BF%99%E4%BB%BD%E6%96%87%E4%BB%B6%E9%9C%80%E8%A6%81%E6%8A%93%E4%BD%8F%E7%9A%84%E2%80%9C%E5%85%B3%E9%94%AE%E6%8A%BD%E8%B1%A1%E2%80%9D"><span class="toc-text">ğŸ”—6) ä½ æŒæ¡è¿™ä»½æ–‡ä»¶éœ€è¦æŠ“ä½çš„â€œå…³é”®æŠ½è±¡â€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%BB%BA%E8%AE%AE%E4%BD%A0%E4%B8%8B%E4%B8%80%E6%AD%A5%E6%80%8E%E4%B9%88%E2%80%9C%E5%BD%BB%E5%BA%95%E5%90%83%E9%80%8F%E2%80%9D%E5%AE%83%EF%BC%88%E4%B8%8D%E5%AD%A6%E6%96%B0%E7%9F%A5%E8%AF%86%EF%BC%8C%E5%8F%AA%E6%98%AF%E6%8A%8A%E9%93%BE%E8%B7%AF%E9%97%AD%E7%8E%AF%EF%BC%89"><span class="toc-text">ğŸ”—7) å»ºè®®ä½ ä¸‹ä¸€æ­¥æ€ä¹ˆâ€œå½»åº•åƒé€â€å®ƒï¼ˆä¸å­¦æ–°çŸ¥è¯†ï¼Œåªæ˜¯æŠŠé“¾è·¯é—­ç¯ï¼‰</span></a></li></ol></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>ç³»åˆ—æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/blog/2025/12/18/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-necks-yolo_world_pafpn.py/" title="ä»£ç è§£è¯»ï¼šyolo_world-models-necks-yolo_world_pafpn.py"><img src="/blog/image/A1-2.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="ä»£ç è§£è¯»ï¼šyolo_world-models-necks-yolo_world_pafpn.py"></a><div class="content"><a class="title" href="/blog/2025/12/18/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-necks-yolo_world_pafpn.py/" title="ä»£ç è§£è¯»ï¼šyolo_world-models-necks-yolo_world_pafpn.py">ä»£ç è§£è¯»ï¼šyolo_world-models-necks-yolo_world_pafpn.py</a><time datetime="2025-12-18T02:04:06.000Z" title="å‘è¡¨äº 2025-12-18 10:04:06">2025-12-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2025/12/18/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-detectors-yolo_world.py/" title="ä»£ç è§£è¯»ï¼šyolo_world-models-detectors-yolo_world.py"><img src="/blog/image/q4SynOBjcxn5gA6.jpeg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="ä»£ç è§£è¯»ï¼šyolo_world-models-detectors-yolo_world.py"></a><div class="content"><a class="title" href="/blog/2025/12/18/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-detectors-yolo_world.py/" title="ä»£ç è§£è¯»ï¼šyolo_world-models-detectors-yolo_world.py">ä»£ç è§£è¯»ï¼šyolo_world-models-detectors-yolo_world.py</a><time datetime="2025-12-18T02:04:06.000Z" title="å‘è¡¨äº 2025-12-18 10:04:06">2025-12-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2025/12/01/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-dense_heads-yolo_world_head.py/" title="ä»£ç è§£è¯»ï¼šyolo_world-models-dense_heads-yolo_world_head.py"><img src="/blog/image/A1-2.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="ä»£ç è§£è¯»ï¼šyolo_world-models-dense_heads-yolo_world_head.py"></a><div class="content"><a class="title" href="/blog/2025/12/01/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB%EF%BC%9Ayolo_world-models-dense_heads-yolo_world_head.py/" title="ä»£ç è§£è¯»ï¼šyolo_world-models-dense_heads-yolo_world_head.py">ä»£ç è§£è¯»ï¼šyolo_world-models-dense_heads-yolo_world_head.py</a><time datetime="2025-12-01T03:04:06.000Z" title="å‘è¡¨äº 2025-12-01 11:04:06">2025-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2025/10/24/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9AYOLO-World-Real-Time-Open-Vocabulary-Object-Detection/" title="è®ºæ–‡é˜…è¯»ï¼šYOLO-World: Real-Time Open-Vocabulary Object Detection"><img src="/blog/image/A1-2.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="è®ºæ–‡é˜…è¯»ï¼šYOLO-World: Real-Time Open-Vocabulary Object Detection"></a><div class="content"><a class="title" href="/blog/2025/10/24/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/yolo-world/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9AYOLO-World-Real-Time-Open-Vocabulary-Object-Detection/" title="è®ºæ–‡é˜…è¯»ï¼šYOLO-World: Real-Time Open-Vocabulary Object Detection">è®ºæ–‡é˜…è¯»ï¼šYOLO-World: Real-Time Open-Vocabulary Object Detection</a><time datetime="2025-10-24T07:19:06.000Z" title="å‘è¡¨äº 2025-10-24 15:19:06">2025-10-24</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/blog/easter-egg/" title="å½©è›‹"><img src="/blog/image/cover/IMG_20260217_201822.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="å½©è›‹"/></a><div class="content"><a class="title" href="/blog/easter-egg/" title="å½©è›‹">å½©è›‹</a><time datetime="2026-02-18T05:09:03.000Z" title="å‘è¡¨äº 2026-02-18 13:09:03">2026-02-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2026/01/21/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/WeDetect/%E3%80%90WeDetect%E3%80%91%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" title="ã€WeDetectã€‘è®ºæ–‡é˜…è¯»"><img src="/blog/image/cover/9.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="ã€WeDetectã€‘è®ºæ–‡é˜…è¯»"/></a><div class="content"><a class="title" href="/blog/2026/01/21/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/WeDetect/%E3%80%90WeDetect%E3%80%91%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" title="ã€WeDetectã€‘è®ºæ–‡é˜…è¯»">ã€WeDetectã€‘è®ºæ–‡é˜…è¯»</a><time datetime="2026-01-21T01:41:58.000Z" title="å‘è¡¨äº 2026-01-21 09:41:58">2026-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2026/01/20/AI%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/" title="AIä½¿ç”¨æ‰‹å†Œ"><img src="/blog/image/cover/13.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="AIä½¿ç”¨æ‰‹å†Œ"/></a><div class="content"><a class="title" href="/blog/2026/01/20/AI%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/" title="AIä½¿ç”¨æ‰‹å†Œ">AIä½¿ç”¨æ‰‹å†Œ</a><time datetime="2026-01-20T01:21:48.000Z" title="å‘è¡¨äº 2026-01-20 09:21:48">2026-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2026/01/19/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/OV-DQUO/%E3%80%90OV-DQUO%E3%80%91%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" title="ã€OV-DQUOã€‘è®ºæ–‡é˜…è¯»"><img src="/blog/image/cover/2.jpg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="ã€OV-DQUOã€‘è®ºæ–‡é˜…è¯»"/></a><div class="content"><a class="title" href="/blog/2026/01/19/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/OV-DQUO/%E3%80%90OV-DQUO%E3%80%91%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" title="ã€OV-DQUOã€‘è®ºæ–‡é˜…è¯»">ã€OV-DQUOã€‘è®ºæ–‡é˜…è¯»</a><time datetime="2026-01-19T07:59:50.000Z" title="å‘è¡¨äº 2026-01-19 15:59:50">2026-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/blog/2026/01/14/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/YOLO-UniOW/%E3%80%90YOLO-UniOW%E3%80%91%E6%8C%87%E6%A0%87%E8%A7%A3%E9%87%8A/" title="YOLO-UniOW-æŒ‡æ ‡è§£é‡Š"><img src="/blog/image/cover/6.jpeg" onerror="this.onerror=null;this.src='/blog/img/404.jpg'" alt="YOLO-UniOW-æŒ‡æ ‡è§£é‡Š"/></a><div class="content"><a class="title" href="/blog/2026/01/14/%E5%BC%80%E6%94%BE%E8%AF%8D%E6%B1%87%E6%A3%80%E6%B5%8B/YOLO-UniOW/%E3%80%90YOLO-UniOW%E3%80%91%E6%8C%87%E6%A0%87%E8%A7%A3%E9%87%8A/" title="YOLO-UniOW-æŒ‡æ ‡è§£é‡Š">YOLO-UniOW-æŒ‡æ ‡è§£é‡Š</a><time datetime="2026-01-14T01:44:34.000Z" title="å‘è¡¨äº 2026-01-14 09:44:34">2026-01-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2025 - 2026 By lian</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">å²å²å¹³ï¼Œå²å²å®‰ï¼Œå²å²å¹³å®‰</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/blog/js/utils.js"></script><script src="/blog/js/main.js"></script><script src="/blog/true"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark_dimmed' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'qieliqiean/blog',
      'data-repo-id': 'R_kgDONvpdYw',
      'data-category-id': 'DIC_kwDONvpdY84C1DqB',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !true) {
    if (true) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script defer src="/blog/js/site.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/blog/js/search/local-search.js"></script></div></div></body></html>